<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Main Menu - FIT Challenge Program 10 Hari</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" >
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
body { background-color: #f8f9fa; }
/***** Judul di Navbar *****/
.brand-title { font-size: 12px; font:wide; color: #023581; line-height: 1; }
/***** Sub Judul di Navbar *****/
.brand-subtitle { font-size: 10px; color: #6c757d; line-height: 1; }

/***** Main Menu Navbar *****/
.main-menu-link { font-weight: 500; padding: 8px 12px !important; border-radius: 3px; }
.main-menu-link:hover, .main-menu-link.active { 
  color: #dc3545 !important; 
  /* background-color: #dadada; */
}

/****** Icon Medsos ******/
.social-icon { 
  display: inline-flex; 
  justify-content: center; 
  align-items: center; 
  width: 40px; 
  height: 40px; 
  border-radius: 50%; 
}
.social-icon i { color: #555; transition: color 0.3s ease-in-out; }
.social-icon:hover { background-color: #dadada; }
.social-icon:hover i { color: #dc3545; }

/***** Header Image *****/
.header-image img {
    height: 100%;
    width: 100%;
    object-fit: cover;
    /*
    border-radius: 10px 10px 0 0;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
    */
}

/***** Menu Accordian ******/
.menu-accordion { margin-bottom: 10px; }
.menu-header {
  /* background: linear-gradient(135deg, #105fff 0%, #cfdaff 100%); */
  background-color : #0077ff;
  color: #ffffff;
  border: none;
  padding: 15px 20px;
  text-align: left;
  width: 100%;
  /* border-radius: 8px; */
  font-weight: 500;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.3s ease;
}
.menu-header:hover {
  /* background: linear-gradient(135deg, #cfdaff 0%, #105fff 100%); */
  background-color :  #0056b8;
  color: #f7f7f7;
  transform: translateY(-2px); 
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
.menu-header .menu-icon { transition: transform 0.3s ease; }
.menu-header.collapsed .menu-icon { transform: rotate(0deg); }
.menu-header:not(.collapsed) .menu-icon { transform: rotate(180deg); }
.menu-content {
  background-color: white;
  /* border: 1px solid #dee2e6; */
  border-top: none;
  /* border-radius: 0 0 8px 8px; */
  padding: 0;
}
.menu-item {
  display: block;
  padding: 12px 20px;
  color: #333;      
  text-decoration: none;
  border-bottom: 1px solid #f8f9fa;
  transition: all 0.2s ease;
}
.menu-item:last-child { border-bottom: none; }
/* Warna Hover Item Text Menu */
.menu-item:hover {
  /* Warna Pointer Sub Menu */
  background-color: #e7e7e7;
  /* color: #002266; */
  color: #830000;        
  text-decoration: none;
}
/* Warna Icon Menu */
.menu-item i { width: 20px; margin-right: 10px; color: #000000; }
/* Status Icon Lock */
.status-lock { color: #002fff; margin-left: 10px; }
/* Status Icon Unlock */
.status-unlock { color: #ffffff; margin-left: 10px; }
/***** Akhir Menu Accordian *****/


/***** FIX POSITIONING UNTUK SUBMENU *****/

/* Pastikan submenu tidak keluar dari container */
.menu-accordion {
  position: relative;
  overflow: visible;
}

/***** Playlist Container di Menu Accordion *****/
.menu-content .playlist-container {
    margin: 10px 0;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    overflow: hidden;
    max-height: 400px;
    position : relative;
}

/***** Submenu Content Styles *****/
.submenu-content { 
  position: relative;
  z-index: 10 ;
  border-radius: 8px; 
  margin: 10px 0; 
  display: none;
  width:100% 
}
.submenu-trigger { cursor: pointer; }
.submenu-trigger:hover { background-color: #e7e7e7; color: #830000; }
/***** akhir Sebmenu *****/ 

/***** Footer *****/
.footer a:hover { color: #ff4d4d !important; }

/**** * About Overlay *****/
.about-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  display: none;
}
.about-form {
  width: 100%;
  max-width: 350px;
  padding: 20px;
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
  text-align: center;
}
/***** Akhir About *****/

/***** Video Player Styles *****/
.video-container {
    position: relative;
    width: 100%;
    /* max-width: 800px; */
    max-width: 780px;
    margin: 15px auto;
    display: none;
    background: #000;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    /* border: 3px solid #002266; */
    border: 3px solid #000000;
}
.video-wrapper {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
    height: 0;
}
.video-wrapper iframe,
.video-wrapper video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
.video-placeholder {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #002266 0%, #0044cc 100%);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
}
.video-placeholder:hover {
    background: linear-gradient(135deg, #0044cc 0%, #002266 100%);
    transform: scale(1.02);
}
.video-placeholder i { font-size: 48px; margin-bottom: 15px; opacity: 0.9; }
.video-placeholder-text { font-size: 16px; font-weight: 500; text-align: center; padding: 0 20px; }
/* Spinner di tengah video player */
.video-loading {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: none;
    justify-content: center;
    align-items: center;
    background: #000;
    z-index: 5;
}
.video-loading .spinner-border { width: 3rem; height: 3rem; color: #dc3545; }
.close-video {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.7);
    color: white;
    border: none;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 20;
    transition: all 0.3s ease;
    font-size: 14px;
}
.close-video:hover { background: rgba(220, 53, 69, 0.9); transform: scale(1.1); }
/***** Akhir Video Player Styles *****/

/***** Playlist Container Styles Video Youtube *****/
.playlist-container {
    display: none;
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 0 0 8px 8px;
    max-height: 400px !important;
    overflow-y: auto !important;
    scrollbar-width: thin;
    position: relative;
}

/***** Tombol Close di Playlist Header *****/
.playlist-header .btn-close-header {
    background: none;
    border: none;
    color: #666;
    font-size: 16px;
    padding: 4px;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.7;
    transition: all 0.3s ease;
    border-radius: 50%;
    cursor: pointer;
}
.playlist-header .btn-close-header:hover {
    opacity: 1;
    color: #dc3545 !important;
    background-color: rgba(220, 53, 69, 0.1);
    transform: scale(1.1);
}
.playlist-header.position-relative {
    position: relative !important;
}
/***** Pastikan tombol di posisi yang benar *****/
.playlist-header .position-absolute {
    position: absolute !important;
    top: 50% !important;
    right: 10px !important;
    transform: translateY(-50%) !important;
} 

/***** Playlist Video Items Container *****/
.playlist-container::-webkit-scrollbar { width: 8px !important; display: block !important; }
.playlist-container::-webkit-scrollbar-track { background: #f8f9fa !important; display: block !important;}
.playlist-container::-webkit-scrollbar-thumb { background: #ccc !important; border-radius: 4px !important; display: block !important;}
.playlist-container::-webkit-scrollbar-thumb:hover { background: #aaa !important;}
.playlist-item {
    display: flex;
    align-items: center;
    padding: 12px 15px;
    border-bottom: 1px solid #f8f9fa;
    transition: all 0.2s ease;
}
.playlist-item:hover { background-color: #f8f9fa;}
.playlist-item:last-child { border-bottom: none; }
.playlist-thumbnail {
    position: relative;
    width: 120px;
    height: 68px;
    margin-right: 12px;
    border-radius: 4px;
    overflow: hidden;
    background: #ddd;
    flex-shrink: 0;
}
.playlist-thumbnail img { width: 100%; height: 100%; object-fit: cover; }
.position-badge {
    position: absolute;
    bottom: 4px;
    right: 4px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 3px;
    font-weight: bold;
    min-width: 20px;
    text-align: center;
}
.playlist-info { flex: 1; min-width: 0; }
.playlist-title {
    font-weight: 500;
    margin-bottom: 4px;
    font-size: 14px;
    line-height: 1.3;
    display: -webkit-box;
    /* -webkit-line-clamp: 2; */
    line-clamp: 2;
    /*-webkit-box-orient: vertical;*/
    box-orient: vertical;
    overflow: hidden;
}
.playlist-meta {display: flex; gap: 12px; font-size: 12px; color: #666;}
.playlist-duration {color: #dc3545; font-weight: 500;}
.playlist-position {color: #6c757d; }
.playlist-loading {padding: 30px 20px; text-align: center; color: #666;}
.playlist-error { padding: 30px 20px; text-align: center; color: #dc3545;}
/***** Akhir Playlist Youtube *****/

/***** PDF Viewer Styles *****/
.pdf-viewer {
    display: none;
    position: relative;
    background: white;
    border: 1px solid #dee2e6;
    border-top: none;
}
.pdf-container { width: 100%; height: 500px; scrollbar-width: none; overflow-x: hidden; }
.pdf-container::-webkit-scrollbar { display: none; }                
.pdf-container iframe { width: 100%; height: 100%; border: none; overflow-x: hidden !important; }
.pdf-viewer::-webkit-scrollbar { width: 0px; display: none; }
.pdf-header {
    padding: 12px 15px;
    background: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    justify-content: between;
    align-items: center;
}
.pdf-title { font-weight: 600; color: #333; flex: 1; }
.pdf-actions { display: flex; gap: 10px; }
.pdf-loading {
    padding: 30px 20px;
    text-align: center;
    color: #666;
    height: 200px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
.close-pdf {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.7);
    color: white;
    border: none;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 25;
    transition: all 0.3s ease;
    font-size: 14px;
}
.close-pdf:hover { background: rgba(220, 53, 69, 0.9); transform: scale(1.1);}
/***** Akhir PDF Viewer Styles *****/

/***** PDF.js Viewer Styles *****/
.pdfjs-viewer { 
    width: 100%; 
    height: 500px; 
    border: 1px solid #ddd; 
    overflow: auto; 
    background: #f5f5f5;
}
.pdfjs-canvas { 
    display: block; 
    margin: 0 auto; 
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    max-width: 100%; /* TAMBAH INI - pastikan tidak melebihi container */
}
.pdfjs-controls {
    padding: 10px;
    background: white;
    border-bottom: 1px solid #ddd;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 10px;            /* PINDAH KE BAWAH - tambahkan margin-top dan border-top */
    border-top: 1px solid #ddd;
    border-bottom: none;
}
.pdfjs-page-info { font-size: 14px; color: #666;}
/***** Akhir PDF.js Viewer Styles *****/

/* Style untuk tombol centang video */
.complete-btn { transition: all 0.3s ease; }
.complete-btn:hover { transform: scale(1.1); background-color: #218838 !important; }

/* Style untuk modul terkunci */
.menu-header.disabled { pointer-events: none; opacity: 0.6; cursor: not-allowed; }
.status-lock { color: #000e3d; margin-left: 10px; }
.status-unlock { color: #ffffff; margin-left: 10px; }

/***** STYLING UNTUK PESAN UNIVERSAL POSISI MENU *****/
.notification-message {
    display: none;
    padding: 12px 16px;
    border-radius: 8px;
    margin-bottom: 10px;
    align-items: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border: 1px solid rgba(0,0,0,0.1);
}
.pesan-notif-icon { font-size: 18px; }
.notification-error { background-color: #d9534f; color: white; border-color: #c9302c; }
.notification-success { background-color: #0275d8; color: white; border-color: #025aa5; }
.notification-warning { background-color: #f0ad4e; color: black; border-color: #eea236; }
.notification-info { background-color: #5bc0de; color: white; border-color: #46b8da; }
/* Pesan dalam menu content */
.menu-content .notification-message { margin: 10px 0; border-radius: 6px; }
/* Toast message */
.toast-message {
    position: fixed;
    top: 20px;
    right: 20px;
    min-width: 300px;
    max-width: 400px;
    z-index: 1060;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* Styling untuk modal meal plan */
.meal-plan-modal .modal-header { background: linear-gradient(135deg, #105fff 0%, #cfdaff 100%); color: white; }
.meal-plan-modal .modal-body { padding: 20px; }
.meal-plan-preview { max-width: 100%; height: auto; border-radius: 8px; margin-top: 10px; display: none; }

/***** Tampilan Mobile ******/
@media (max-width: 591.98px) {
  .navbar-collapse .mx-auto {
      margin-left: 0 !important;
      margin-right: 0 !important;
      flex-direction: row; 
      margin-bottom: 1rem;
  }
  .navbar-nav:not(.mx-auto) .nav-item, .navbar-nav:not(.mx-auto) .main-menu-link { 
    width: 50%; 
   }
 
  /* Pastikan submenu tidak terlalu lebar */
  .submenu-content {
    margin-left: -15px;
    margin-right: -15px;
    width: calc(100% + 30px);
  }

  /* PDF Viewer untuk Mobile */
  .pdf-container { 
      height: 400px;                 /* Sedikit lebih pendek untuk mobile */
      overflow-x: hidden !important; /* Pastikan no horizontal scroll */
      overflow-y: auto;              /* Biarkan vertical scroll */
  }
    .pdf-container iframe {
      overflow-x: hidden !important;
      -webkit-overflow-scrolling: touch; /* Smooth scroll untuk iOS */
  }
}
/***** Akhir Tampilan Mobile *****/

</style>
</head>

<body>
<div class="container mt-5 mb-5">
  <div class="row justify-content-center">
    <div class="card mx-auto shadow p-0" style="max-width:789px">
      <!-- HEADER -->
      <header>
        <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #f1f1f1;">
          <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="#">
              <img src="images/logo-beratidealku.png" alt="Logo" width="199" height="38" class="me-2">
              <div class="d-md-block">
                <div class="brand-title">FIT Challenge</div>
                <div class="brand-subtitle">Program 10 Hari</div>
              </div>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mainNavbar">
              <ul class="navbar-nav mx-auto">
                <li class="nav-item"><a class="nav-link social-icon" href="https://facebook.com/beratidealku" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
                <li class="nav-item"><a class="nav-link social-icon" href="https://www.instagram.com/hestyamin" target="_blank"><i class="fab fa-instagram"></i></a></li>
                <li class="nav-item"><a class="nav-link social-icon" href="https://www.youtube.com" target="_blank"><i class="fab fa-youtube"></i></a></li>
              </ul>
              <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link main-menu-link" href="#about" onclick="showAbout()">About</a></li>
                <li class="nav-item" id="loginMenuItem">
                  <a class="nav-link main-menu-link" href="loginFC.html">
                    <i class="fas fa-sign-in-alt"></i> Login
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </nav>
      </header>
      
      <div class="card-body">
       <!-- Header Image -->
        <div class="header-image">
            <img src="images/Header-FITChallenge.jpg" alt="Header Image">
        </div>
        <div class="card-title text-white p-1 mb-0" style="text-shadow: #c6d8ff; text-align:center; background-color: #002266; border-bottom-style:solid; border-bottom-color:#830000; border-width:5px;">
          <h5>SELAMAT DATANG</h5>
          <h6 style="font-size: small;">Di kelas online <strong>FIT CHALLENGE PROGRAMME by BERATidealku</strong> merupakan tantangan</br>
          bagi anda yang ingin meningkatkan level kebugaran. Dengan mengikuti kelas ini selama <strong>10 Hari</strong></br>
          anda akan di bimbing secara terstruktur dengan kurikulum yang disusun sedemikian rupa </br>
          dengan panduan video tutorial yang lengkap serta didampingi seorang coach berpengalaman</h6>
        </div>
        
        <!------------------------------->
        <!-- MENU UTAMA FIT CHALLENGE  -->
        <!------------------------------->
        <div class="menu-accordion" id="menuAccordion">
          <!--------------------------->
          <!-- MENU PANDUAN APLIKASI -->
          <!---------------------------> 
          <div class="menu-accordion-item">
            <button class="menu-header collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panduanContent">
              <span>
                <i class="fas fa-angle-double-right me-2"></i>Panduan Penggunaan Aplikasi
              </span>
              <i class="fas fa-angle-down menu-icon"></i>
            </button>

            <!-- SUBMENU PANDUAN APLIKASI -->
            <div class="collapse" id="panduanContent" data-bs-parent="#menuAccordion">
              <div class="menu-content">
                <!-- Video Tutorial -->
                <a href="https://www.youtube.com/watch?v=Zg_badTE2Ec" 
                  class="menu-item video-link" data-section="panduan" data-type="youtube" data-url="https://www.youtube.com/watch?v=Zg_badTE2Ec">
                  <i class="fas fa-file-video"></i>Video Tutorial Panduan Penggunaan Aplikasi
                </a>

                <!-- PDF Panduan Penggunaan Aplikasi -->
                <a href="pdf/Panduan_Penggunaan_Aplikasi.pdf" 
                  class="menu-item" id="pdfPanduanLink">
                  <i class="fas fa-file-pdf"></i>PDF Panduan Penggunaan Aplikasi
                </a>
                
                <!-- PDF Viewer untuk Panduan -->
                <div class="pdf-viewer" id="pdfViewerPanduan" style="display: none;">
                  <button class="close-pdf" onclick="closePDF('panduan')">
                    <i class="fas fa-times"></i>
                  </button>
                  <div class="pdf-container" id="pdfContainerPanduan">
                    <!-- PDF akan dimuat di sini -->
                  </div>
                </div>
               
                <!-- Video Player untuk Panduan -->
                <div class="video-container" id="videoContainerPanduan" style="display: none;">
                  <button class="close-video" onclick="closeVideo('panduan')">
                    <i class="fas fa-times"></i>
                  </button>
                  <div class="video-wrapper">
                    <div class="video-placeholder" onclick="playVideo('panduan')">
                      <i class="fas fa-play-circle"></i>
                      <div class="video-placeholder-text">Klik untuk memuat video</div>
                    </div>
                    <div class="video-loading" id="videoLoadingPanduan">
                      <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading video...</span>
                      </div>
                    </div>
                    <div id="videoPlayerPanduan"></div>
                  </div>
                </div>

              </div>
            </div>
          </div>

          <!--------------------->
          <!-- MENU PERKENALAN --> 
          <!--------------------->
          <div class="menu-accordion-item">
            <button class="menu-header collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#perkenalanContent">
              <span>
                <i class="fas fa-angle-double-right me-2"></i>Perkenalan
              </span>
              <i class="fas fa-angle-down menu-icon"></i>
            </button>
            
            <div class="collapse" id="perkenalanContent" data-bs-parent="#menuAccordion">
              <div class="menu-content">
                <!-- Canva Link - Buka di tab baru -->
                <a href="https://www.canva.com/design/DAGqjXWcl6o/ylVUgMbZ8it0TXN0dqCKzQ/view?utm_content=DAGqjXWcl6o&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=h1feb0aca2a" 
                  class="menu-item" target="_blank">
                  <i class="fas fa-video"></i>1. Perkenalan dengan Personal Diet Partner
                </a>
                
                <!-- YouTube Video -->
                <a href="https://www.youtube.com/watch?v=9DoHhx9jlGM" 
                  class="menu-item video-link" data-section="perkenalan" data-type="youtube" data-url="https://www.youtube.com/watch?v=9DoHhx9jlGM">
                  <i class="fas fa-video"></i>2. Alasan Mengapa Herbalife
                </a>

                <!-- Local Video -->
                <a href="video/Live Best Your Best Life ! - 360.mp4" 
                  class="menu-item video-link" data-section="perkenalan" data-type="local" data-url="video/Live Best Your Best Life ! - 360.mp4">
                  <i class="fas fa-video"></i>3. Live Best Your Best Life !
                </a>
                
                <!-- Video Player untuk Perkenalan -->
                <div class="video-container" id="videoContainerPerkenalan" style="display: none;">
                  <button class="close-video" onclick="closeVideo('perkenalan')">
                    <i class="fas fa-times"></i>
                  </button>
                  <div class="video-wrapper">
                    <div class="video-placeholder" onclick="playVideo('perkenalan')">
                      <i class="fas fa-play-circle"></i>
                      <div class="video-placeholder-text">Klik untuk memuat video</div>
                    </div>
                    <div class="video-loading" id="videoLoadingPerkenalan">
                      <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading video...</span>
                      </div>
                    </div>
                    <div id="videoPlayerPerkenalan"></div>
                  </div>
                </div>
                
                <a href="#" class="menu-item">
                  <i class="fas fa-check-double"></i>Selesai Perkenalan
                </a>      
              </div>
            </div>
          </div>
           
          <!----------------------------->
          <!-- MENU MODUL HARI PERTAMA -->
          <!-----------------------------> 
          <div class="menu-accordion-item">
            <button class="menu-header collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#pertemuan1Content" data-hari="1">
              <span>
                <i class="fas fa-angle-double-right me-2"></i>Modul Hari Pertama
                <i class="fas fa-lock status-lock"></i>
              </span>
              <i class="fas fa-angle-down menu-icon"></i>
            </button>

            <!-- SUBMENU MODUL HARI PERTAMA --> 
            <div class="collapse" id="pertemuan1Content" data-bs-parent="#menuAccordion">
              <div class="menu-content">
              
                <!-- VIDEO MATERI HARI PERTAMA -->
                <a href="https://www.youtube.com/watch?v=Zg_badTE2Ec" 
                  class="menu-item video-link" onclick="showMessage('info', `Memuat video...`, 1000, `pertemuan${hariKe}`)"
                  style="max-width: 100%;" data-section="pertemuan1" 
                  data-type="youtube" data-url="https://www.youtube.com/watch?v=Zg_badTE2Ec" id="materiLink1">
                  <i class="fas fa-video"></i>1.1 Materi Hari Pertama - Dari Mana Saja Sumber Protein Bisa Didapatkan? 
                </a>
                
                <!-- Video Player untuk Materi Hari Pertama - DITEMPATKAN DI SINI -->
                <div class="video-container" id="videoContainerPertemuan1" style="display: none;">
                  <button class="close-video" onclick="closeVideo('pertemuan1')">
                    <i class="fas fa-times"></i>
                  </button>
                
                  <div class="video-wrapper">
                    <div class="video-placeholder" onclick="playVideo('pertemuan1')">
                      <i class="fas fa-play-circle"></i>
                      <div class="video-placeholder-text">Klik untuk memuat video</div>
                    </div>
                    <div class="video-loading" id="videoLoadingPertemuan1">
                      <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading video...</span>
                      </div>
                    </div>
                    <div id="videoPlayerPertemuan1"></div>
                  </div>
                </div>
  
                <!-- MEAL PLAN HARI PERTAMA -->
                <!-- <a href="pdf/MealPlan_HariKe1.pdf" -->
                <a href="#" 
                  class="menu-item submenu-trigger" onclick="uploadMealPlan(1)" data-target="mealPlanContent1">
                  <i class="fas fa-utensils"></i>1.2 Meal Plan - Hari Pertama
                </a>

                <!-- WORKOUT HARI PERTAMA -->
                <!-- <a href="pdf/Workout_HariKe1.pdf" -->
                <a href="#"
                  class="menu-item submenu-trigger" onclick="selesaiWorkout(1)" data-target="workoutContent1">
                  <i class="fas fa-dumbbell"></i>1.3 Workout - Hari Pertama
                </a>
              
                <!-- WATER REMINDER HARI PERTAMA -->
                <!-- <a href="pdf/WaterReminder_HariKe1.pdf" --> 
                <a href="#"
                  class="menu-item submenu-trigger" onclick="waterReminder(1)" data-target="waterReminderContent1">
                  <i class="fas fa-prescription-bottle"></i>1.4 Water Reminder - Hari Pertama
                </a>
              
                <!-- WAKTU ISTIRAHAT HARI PERTAMA -->
                <!-- <a href="pdf/Istirahat_HariKe1.pdf" --> 
                <a href="#"
                  class="menu-item submenu-trigger" onclick="istirahat(1)" data-target="istirahatContent1">
                  <i class="fas fa-bed"></i>1.5 Waktu Istirahat - Hari Pertama
                </a>
                
                <!-- DATA TRACKING HARI PERTAMA -->
                <!-- <a href="/pdf/DataTracking_HariKe1.pdf" --> 
                <a href="#"
                  class="menu-item submenu-trigger" onclick="dataTracking(1)" data-target="dataTrackingContent1">
                  <i class="fas fa-user-friends"></i>1.6 Data Tracking - Hari Pertama
                </a>

                <!-- TANYA COACH HARI PERTAMA -->
                <a href="https://api.whatsapp.com/send?phone=6281241318600&text=Halo+kak%2C+saya+ingin+bertanya+materi+tentang+" 
                  class="menu-item" onclick="tanyaCoach(1)" target="_blank">
                  <i class="fa fa-whatsapp"></i>1.7 Tanya Coach? - Hari Pertama
                </a>

                <!-- SELESAI MODUL HARI PERTAMA -->
                <a href="#" class="menu-item" onclick="simpanMateri(1)">
                   <i class="fas fa-check-double"></i>Selesai Modul hari Pertama
                </a> 
              </div>
            </div>
          </div>

          <!-- KONTEN DETAIL UNTUK SUBMENU -->
          <!-- Meal Plan Content -->
          <div class="submenu-content" id="mealPlanContent1" style="display: none;">
            <div class="border p-3 bg-light mt-2 mb-2">
              <div class="card-title p-1 mb-2 position-relative" style="text-align:center; color: #ffffff; text-shadow: #bebebe; background-color:  #002266; border-bottom-style:solid; border-bottom-color:#facc00; border-width:5px;">
                <h6 class="mt-1 mb-1">Apa Yang Anda Makan Hari Ini ?</h6>
                <button type="button" class="btn-close-header position-absolute top-50 end-0 translate-middle-y me-2" onclick="hideSubmenu('mealPlanContent1')">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              
              <h6><b>PANDUAN NUTRISI</b></h6>
              <p><b>Rekomendasi Meal Plan : </b>Konsumsi makanan bergizi dalam jumlah yang tepat sesuai dengan kebutuhan nutrisi anda</br>
              <button type="button" class="btn btn-primary btn-sm mt-1" id="btnCekDisiniMealPlan">
                <i class="fas fa-utensils"></i> Cek Disini
              </button>
        
              <!-- PDF Viewer untuk Meal Plan -->
              <div class="pdf-viewer" id="pdfViewerMealplan1" style="display: none;">
                <button class="close-pdf" onclick="closePDF('mealplan1')">
                  <i class="fas fa-times"></i>
                </button>
                <div class="pdf-container" id="pdfContainerMealplan1">
                  <!-- PDF akan dimuat di sini -->
                </div>
              </div>
                  
              <div style="border-left-style:solid; border-left-color:#b1b1b1; border-width: 4px; padding-left: 10px; margin-top: 10px;">
                <p><i class="fas far fa-lightbulb mt-2 mb-2" style="color: #fa0000;"></i><b> Tips : </b>Pastikan makanan yang anda konsumsi adalah makanan yang sehat dan seimbang, yang terpenuhi unsur</p>
                <i class="far fa-check-circle"></i> Karbohidrat 40%</br>
                <i class="far fa-check-circle"></i> Protein 30%</br>
                <i class="far fa-check-circle"></i> Lemak 30%</br>
              </div>

              <!-- Jadwal Meal Plan -->
              <div class="mt-3 mb-2" id="jadwalMealplan-container">
                <h6 class="mt-2"><b>JADWAL MEAL PLAN</b></h6>
                <div id="jadwalMealplan-list">
                  <!-- Pilihan jadwal meal dimuat di sini -->  
                </div>
              </div>
             </div>
          </div>
          
          <!-- Workout Content -->
          <div class="submenu-content" id="workoutContent1" style="display: none;">
            <div class="border p-3 bg-light mt-2 mb-2">
              <div class="card-title p-1 mb-2 position-relative" style="text-align:center; color: #ffffff; text-shadow: #bebebe; background-color:  #002266; border-bottom-style:solid; border-bottom-color:#facc00; border-width:5px;">
                <h6 class="mt-1 mb-1">Apa Olahraga Anda Hari Ini ?</h6>
                 <button type="button" class="btn-close-header position-absolute top-50 end-0 translate-middle-y me-2" onclick="hideSubmenu('workoutContent1')">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              
              <h6><b>PANDUAN WORKOUT</b></h6>
              <p><b>Rekomendasi Olahraga : </b>Olahraga 3-5 hari seminggu dengan durasi 20-30 menit setiap harinya, dengan pilihan jenis olahraga yang sesuai dengan kebutuhan tubuh dan kesehatan</br>
              <button type="button" class="btn btn-primary btn-sm mt-1" id="btnCekDisiniWorkout">
                <i class="fas fa-dumbbell"></i> Cek Disini
              </button>
   
              <!-- PDF Viewer untuk Workout -->
              <div class="pdf-viewer" id="pdfViewerWorkout1" style="display: none;">
                <button class="close-pdf" onclick="closePDF('workout1')">
                  <i class="fas fa-times"></i>
                </button>
                <div class="pdf-container" id="pdfContainerWorkout1">
                  <!-- PDF akan dimuat di sini -->
                </div>
              </div>
              
              <div style="border-left-style:solid; border-left-color:#b1b1b1; border-width: 4px; padding-left: 10px; margin-top: 10px;">
                <p><i class="fas far fa-lightbulb mt-2 mb-2" style="color: #fa0000;"></i><b> Tips : </b>Bergabunglah dengan berbagai komunitas olahraga, dimana orang-orangnya saling mendukung dan memotivasi satu sama lain</p>
              </div>

              <h6><b>JENIS WORKOUT</b></h6>  
              <!-- Pilih Jenis Olahraga Kardio -->
              <div class="mt-3 mb-2" id="kardio-container">
                <h6>Olahraga Kardio :</h6>
                <div id="olahragaKardio-list">
                  <!-- Pilihan olahraga kardio dimuat di sini -->
                </div>
              </div>

              <!-- Pilih Jenis Olahraga Resistance -->
              <div class="mt-3 mb-2" id="resistance-container">
                <h6>Olahraga Resistance :</h6>
                <div id="olahragaResisten-list">
                  <!-- Pilihan olahraga resisten dimuat di sini -->
                </div>
              </div>
              <!---
              <button type="button" class="btn btn-secondary btn-sm" id="btnSelesaiWorkout" data-bs-toggle="tooltip" title="Selesai Workout"><i class="fa fa-check"></i> Selesai</button>
              --->
            </div>
          </div>
   
          <!-- Water Reminder Content -->
          <div class="submenu-content" id="waterReminderContent1" style="display: none;">
            <div class="border p-3 bg-light mt-2 mb-2">
              <div class="card-title p-1 mb-2 position-relative" style="text-align:center; color: #ffffff; text-shadow: #bebebe; background-color: #002266; border-bottom-style:solid; border-bottom-color:#facc00; border-width:5px;">
                <h6 class="mt-1 mb-1">Hari Ini Minum Air Putih Berapa ?</h6>
                <button type="button" class="btn-close-header position-absolute top-50 end-0 translate-middle-y me-2" onclick="hideSubmenu('waterReminderContent1')">
                  <i class="fas fa-times"></i>
                </button>
              </div>
             
              <h6><b>PANDUAN WATER REMINDER</b></h6>
              <p><b>Rekomendasi Asupan Air : </b>Minum air putih 8-15 gelas air perhari, dengan jumlah air putih yang cukup untuk mendukung aktivitas tubuh dan kesehatan</br>
              <button type="button" class="btn btn-primary btn-sm mt-1" id="btnCekDisiniAirMinum">
                <i class="fas fa-prescription-bottle"></i> Cek Disini
              </button>
     
              <!-- PDF Viewer untuk Water Reminder -->
              <div class="pdf-viewer" id="pdfViewerWater1" style="display: none;">
                <button class="close-pdf" onclick="closePDF('water1')">
                  <i class="fas fa-times"></i>
                </button>
                <div class="pdf-container" id="pdfContainerWater1">
                  <!-- PDF akan dimuat di sini -->
                </div>
              </div>
          
              <div style="border-left-style:solid; border-left-color:#b1b1b1; border-width: 4px; padding-left: 10px; margin-top: 10px;">
                <p><i class="fas far fa-lightbulb mt-2 mb-2" style="color: #fa0000;"></i><b> Tips : </b>Untuk mencukupi asupan air minum sehari</p>
                <i class="far fa-check-circle"></i> Belilah botol air yang dapat digunakan kembali untuk dibawa kemana-mana</br>
                <i class="far fa-check-circle"></i> Botol yang memiliki tulisan takaran air, untuk mengetahui sudah berapa banyak yang anda minum</br>
                <i class="far fa-check-circle"></i> Minumlah lebih banyak jika iklim cuaca panas dan sering berolahraga</br>
              </div>

              <!-- Asupan Air Putih dalam sehari -->
              <div class="mt-3 mb-2" id="airputih-container">
                <h6><b>ASUPAN AIR PUTIH PERHARI</b></h6> 
                <div id="airputihRadioBtn">
                  <!-- Pilihan jumlah air minum dimuat di sini -->
                </div>
              </div>
            </div>
          </div>
               
          <!-- Istirahat Content -->
          <div class="submenu-content" id="istirahatContent1" style="display: none;">
            <div class="border p-3 bg-light mt-2 mb-2">
              <div class="card-title p-1 mb-2 position-relative" style="text-align:center; color: #ffffff; text-shadow: #bebebe; background-color: #002266; border-bottom-style:solid; border-bottom-color:#facc00; border-width:5px;">
                <h6 class="mt-1 mb-1">Hari Ini Istirahatnya Berapa Lama ?</h6>
                <button type="button" class="btn-close-header position-absolute top-50 end-0 translate-middle-y me-2" onclick="hideSubmenu('istirahatContent1')">
                  <i class="fas fa-times"></i>
                </button>
              </div>

              <h6><b>PANDUAN ISTIRAHAT</b></h6>
              <p><b>Rekomendasi Istirahat : </b>Dapatkan jam istirahat anda antara 6-8 Jam per malam</br>
              <button type="button" class="btn btn-primary btn-sm mt-1" id="btnCekDisiniIstirihat">
                <i class="fas fa-bed"></i> Cek Disini
              </button>
          
              <!-- PDF Viewer untuk Istirahat -->
              <div class="pdf-viewer" id="pdfViewerIstirahat1" style="display: none;">
                <button class="close-pdf" onclick="closePDF('istirahat1')">
                  <i class="fas fa-times"></i>
                </button>
                <div class="pdf-container" id="pdfContainerIstirahat1">
                  <!-- PDF akan dimuat di sini -->
                </div>
              </div>
          
              <div style="border-left-style:solid; border-left-color:#b1b1b1; border-width: 4px; padding-left: 10px; margin-top: 10px;">
                <p><i class="fas far fa-lightbulb mt-2 mb-2" style="color: #fa0000;"></i><b> Tips : </b>Pastikan anda istirahat dalam ruangan yang pencahayaannya redup, hening dan memiliki suhu ruang yang nyaman</p>
              </div>

              <!-- Waktu Istirahat -->
              <div class="mt-3 mb-2" id="istirahat-container">
                <!-- <h6><b>BERAPA JAM ISTIRAHAT</b></h6> --> 
                <div id="istirahatBtn">
                  <!-- Pilihan jadwal istirahat dimuat di sini -->
                </div>
              </div>

            </div>
          </div>
      
          <!-- Data Tracking Content -->
          <div class="submenu-content" id="dataTrackingContent1" style="display: none;">
            <div class="border p-3 bg-light mt-2 mb-2">
              <div class="card-title p-1 mb-2 position-relative" style="text-align:center; color: #ffffff; text-shadow: #bebebe; background-color: #002266; border-bottom-style:solid; border-bottom-color:#facc00; border-width:5px;">
                <h6 class="mt-1 mb-1">Lengkapi Data Anda ! </h6>
                <button type="button" class="btn-close-header position-absolute top-50 end-0 translate-middle-y me-2" onclick="hideSubmenu('dataTrackingContent1')">
                  <i class="fas fa-times"></i>
                </button>
              </div>

              <h6><b>PANDUAN DATA TRACKING</b></h6>
              <p><b>Rekomendasi : </b>Cara melakukan pengukuran dan penimbangan yang benar</br>
              <button type="button" class="btn btn-primary btn-sm mt-1" id="btnCekDisiniDataTubuh">
                <i class="fas fa-user-friends"></i> Cek Disini
              </button>
              
              <!-- PDF Viewer untuk Data Tracking -->
              <div class="pdf-viewer" id="pdfViewerDatatracking1" style="display: none;">
                <button class="close-pdf" onclick="closePDF('datatracking1')">
                  <i class="fas fa-times"></i>
                </button>
                <div class="pdf-container" id="pdfContainerDatatracking1">
                  <!-- PDF akan dimuat di sini -->
                </div>
              </div>  

              <div style="border-left-style:solid; border-left-color:#b1b1b1; border-width: 4px; padding-left: 10px; margin-top: 10px;">
                <p><i class="fas far fa-lightbulb mt-2 mb-2" style="color: #fa0000;"></i><b> Tips : </b>Pastikan menginput data dengan lengkap dan benar, agar anda bisa mendapatkan hasil analisa yang lebih akurat dari kami</p>
              </div>  

              <!-- Data Kondisi Tubuh -->
              <div class="mt-3 mb-2" id="kondisitubuh-container">
                <h6><b>INPUT DATA ANDA</b></h6> 
                <div id="kondisiTubuh">
                  <!-- Inputan Data Kondisi Tubuh dimuat di sini -->
                </div>
              </div>
            </div>
          </div>
          
          <!-- MODUL HARI KE 2-10 (SAMA FITURE DAN STRUKTURNYA) -->
    
          <!-- TAMPILAN KREASI RESEP -->
          <div class="menu-accordion-item">
            <button class="menu-header collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#healthyRecept">
              <span>
                <i class="fas fa-angle-double-right me-2"></i>Resep Healthy Snacking
              </span>
              <i class="fas fa-angle-down menu-icon"></i>
            </button>
            <div class="collapse" id="healthyRecept" data-bs-parent="#menuAccordion">
              <div class="menu-content">
                <!-- Playlist Link - SIMPLE -->
                <a href="https://www.youtube.com/playlist?list=PLJU0P2EGDp-8Zs3cF6x84nF1wkB66hYvG" 
                  class="menu-item playlist-trigger" data-target="playlistHealthyRecept">
                  <i class="fas fa-play-circle"></i>Playlist Kreasi Resep Sehat
                </a>
                
                <!-- Playlist Container -->
                <div class="playlist-container" id="playlistHealthyRecept" style="display: none;">
                  <!-- Playlist items akan diisi oleh JavaScript -->
                </div>
                
                <!-- Video Player untuk Healthy Recept -->
                <div class="video-container" id="videoContainerHealthyRecept" style="display: none;">
                  <button class="close-video" onclick="closeVideo('healthyRecept')">
                    <i class="fas fa-times"></i>
                  </button>
                  <div class="video-wrapper">
                    <div class="video-placeholder" onclick="playVideo('healthyRecept')">
                      <i class="fas fa-play-circle"></i>
                      <div class="video-placeholder-text">Pilih video dari playlist</div>
                    </div>
                    <div class="video-loading" id="videoLoadingHealthyRecept">
                      <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading video...</span>
                      </div>
                    </div>
                    <div id="videoPlayerHealthyRecept"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- TAMPILAN DASHBOARD FIT TRACK -->
          <div class="menu-accordion-item">
            <button class="menu-header collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dasboardFitTrack">
              <span>
                <i class="fas fa-angle-double-right me-2"></i>Dashboard Fit Track
              </span>
              <i class="fas fa-angle-down menu-icon"></i>
            </button>
            <div class="collapse" id="dasboardFitTrack" data-bs-parent="#menuAccordion">
              <div class="menu-content">
                <a href="#" class="menu-item"><i class="fas fa-chart-line"></i>Fit Track1</a>
                <a href="#" class="menu-item"><i class="fas fa-heartbeat"></i>Fit Track2</a>
                <a href="#" class="menu-item"><i class="fas fa-dumbbell"></i>Fit Track3</a>
             </div>
            </div>
          </div>
        </div>

        <footer class="footer mt-3 text-white text-center p-2 rounded" style="font-size:12pt; background-color: #002266;">
          FIT Challenge Versi 1.0 Â© 2025 Power by:<a href="https://www.beratidealku.com" class="text-white"> www.beratidealku.com</a></br>
          <img src="images/Logo_Herbalife_Independent_Member_white.png" alt="Logo" width="180" height="22">
        </footer>
      </div>
    </div>
  </div>
</div>

<!-- About Overlay -->
<div class="about-overlay" id="aboutOverlay">
  <div class="about-form">
    <h5 class="mb-2">Fat Loss Challenge Versi 1.0</h5>
    <br>Copyright Â© 2025 <a href="https://www.beratidealku.com" class="text-black">www.beratidealku.com</a>
    <br>Allright Reserved
    <br>Hanya digunakan untuk kalangan internal
    <div class="d-grid mt-4">
      <button id="btnCloseAbout" class="btn btn-primary">OK</button>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
<!-- <script src="js/functions-catalog.js"></script> -->
<script>

// ************************* 
// * FUNGSI UTAMA APLIKASI *
// *************************                           

// Deklarasi Global
const URL_PROGRAM_APP   = 'https://script.google.com/macros/s/AKfycbx32-Cf6lHFPqoyv8l9GRqocukm7lgj6cvny_HN023snh2ReJ5ffPaU8sdWIoPOvP_new/exec';
const PLAYLIST_JSON_URL = './data/playlist.json';



/******************
* Show About form *
*******************/
function showAbout() {
  document.getElementById('aboutOverlay').style.display = 'flex';
}

/******************
* Hide About form *
*******************/  
function hideAbout() {
  document.getElementById('aboutOverlay').style.display = 'none';
}

/******************
* Logout function *
*******************/
function logout() {
  localStorage.removeItem('userId');
  localStorage.removeItem('namaUser');
  localStorage.removeItem('userToken');
  localStorage.removeItem('userLevel');
  sessionStorage.removeItem('aksesList');
  window.location.reload();
}

/*************************************
* SINGLE DOMContentLoaded Event     *
**************************************/
document.addEventListener('DOMContentLoaded', function() {
    console.log('ðŸš€ Aplikasi dimulai...');
    
    // ========================================
    // 1. ACCORDION TOGGLE FIX (PERTAMA)
    // ========================================
    let currentOpenMenu = null;
    
    document.querySelectorAll('.menu-header').forEach(header => {
        header.setAttribute('data-bs-toggle', '');
        
        header.addEventListener('click', function(e) {
            // CEK APAKAH DISABLED
            if (this.classList.contains('disabled')) {
                e.preventDefault();
                e.stopPropagation();
                showMessage('warning', 'Selesaikan Perkenalan terlebih dahulu!', 3000);
                return;
            }
            
            e.preventDefault();
            e.stopPropagation();
            
            const targetId = this.getAttribute('data-bs-target');
            const targetContent = document.querySelector(targetId);
            
            if (!targetContent) return;
            
            // Accordion toggle logic...
            // ... (sama seperti sebelumnya)
            console.log('ðŸ”„ Menu diklik:', targetId);
            
            // Jika klik menu yang sama yang sedang terbuka
            if (currentOpenMenu === targetId) {
                // TUTUP menu
                targetContent.style.display = 'none';
                targetContent.classList.remove('show');
                this.classList.add('collapsed');
                currentOpenMenu = null;
                console.log('âœ… Menu DITUTUP');
            } else {
                // BUKA menu baru
                // Tutup menu yang sebelumnya terbuka
                if (currentOpenMenu) {
                    const previousContent = document.querySelector(currentOpenMenu);
                    const previousHeader = document.querySelector(`[data-bs-target="${currentOpenMenu}"]`);
                    if (previousContent && previousHeader) {
                        previousContent.style.display = 'none';
                        previousContent.classList.remove('show');
                        previousHeader.classList.add('collapsed');
                    }
                }
                
                // Buka menu baru
                targetContent.style.display = 'block';
                targetContent.classList.add('show');
                this.classList.remove('collapsed');
                currentOpenMenu = targetId;
                console.log('âœ… Menu DIBUKA');
            }
        });
    });
    
    // ========================================
    // 2. CEK STATUS USER DAN APPLY LOCK
    // ========================================
    const userId = localStorage.getItem('userId');
    const progressData = localStorage.getItem('progressData');
    
    if (userId && progressData) {
        const progress = JSON.parse(progressData);
        console.log('ðŸ“Š Progress ditemukan untuk user:', userId);
        
        if (progress.success) {
            if (progress.perkenalan) {
                // User sudah selesai perkenalan
                applyExistingUserProgress(progress);
            } else {
                // User belum selesai perkenalan
                console.log('ðŸ” User belum selesai perkenalan');
                applyLockForNewUser();
            }
        }
    } else if (userId) {
        // User baru login, belum ada progress data
        console.log('ðŸ‘¤ User baru atau progress belum diambil');
        applyLockForNewUser();
        
        // Coba ambil progress dari server
        fetchProgressFromServer(userId);
    } else {
        // Tidak ada user ID (belum login)
        console.log('âš ï¸ Tidak ada user ID, mungkin redirect ke login');
    }
    
    // ========================================
    // 3. SETUP SEMUA KOMPONEN LAINNYA
    // ========================================
    setupAllComponents();
    
    console.log('âœ… Aplikasi siap');
});

/************************************
* Apply Lock System yang lebih strict*
*************************************/
function applyLockSystem(progress) {
    console.log('ðŸ”’ Menerapkan lock system STRICT');
    
    // 1. PERKENALAN
    if (progress.perkenalan) {
        console.log('âœ… Perkenalan sudah selesai');
        
        // Update UI perkenalan
        updatePerkenalanUI();
        
        // UNLOCK Modul Hari 1
        unlockModul(1);
        
        // Jika materi/mealplan sudah selesai, unlock berikutnya
        if (progress.materiHari1 || progress.mealplanHari1) {
            // User sudah progress, unlock modul yang sudah selesai
            if (progress.materiHari1) {
                updateMateriCompletionUI(1);
            }
            if (progress.mealplanHari1) {
                updateMealPlanCompletionUI(1);
            }
        }
        
    } else {
        console.log('ðŸ” Perkenalan belum selesai - LOCK SEMUA');
        
        // LOCK Modul Hari 1-10 dengan STRICT
        for (let i = 1; i <= 10; i++) {
            strictLockModul(i);
        }
        
        // Pastikan perkenalan bisa diakses
        const perkenalanHeader = document.querySelector('[data-bs-target="#perkenalanContent"]');
        if (perkenalanHeader) {
            perkenalanHeader.classList.remove('disabled');
            perkenalanHeader.style.pointerEvents = 'auto';
            perkenAnchor.style.opacity = '1';
        }
    }
}

/************************************
* Apply progress untuk user yang sudah ada progress*
*************************************/
function applyExistingUserProgress(progress) {
    console.log('ðŸ‘¤ Apply progress untuk user existing:', progress);
    
    // 1. Perkenalan sudah selesai
    updatePerkenalanUI();
    
    // 2. Modul Hari 1 UNLOCK dengan icon benar
    unlockModul(1);
    
    // 3. Update materi jika sudah selesai
    if (progress.materiHari1) {
        console.log('ðŸ“š Materi Hari 1 sudah selesai');
        const materiLink = document.getElementById('materiLink1');
        if (materiLink) {
            materiLink.innerHTML = materiLink.innerHTML.replace('Materi Hari Pertama', 'Materi Hari Pertama âœ“');
            materiLink.style.color = '#666666';
            materiLink.style.fontWeight = 'bold';
        }
    }
    
    // 4. Update meal plan jika sudah selesai
    if (progress.mealplanHari1) {
        console.log('ðŸ½ï¸ Meal Plan Hari 1 sudah selesai');
        const mealPlanLinks = document.querySelectorAll('[onclick="uploadMealPlan(1)"]');
        mealPlanLinks.forEach(link => {
            link.innerHTML = '<i class="fas fa-utensils"></i>1.2 Meal Plan - Hari Pertama âœ“';
            link.style.color = '#666666';
            link.style.fontWeight = 'bold';
        });
    }
    
    // 5. Auto-expand Modul Hari 1
    setTimeout(() => {
        const header = document.querySelector('[data-hari="1"]');
        if (header && header.classList.contains('collapsed')) {
            header.click();
        }
    }, 500);
}

/************************************
* Strict Lock Modul (benar-benar lock)*
*************************************/
function strictLockModul(hariKe) {
    const modulHeader = document.querySelector(`[data-hari="${hariKe}"]`);
    if (modulHeader) {
        // 1. Add disabled class
        modulHeader.classList.add('disabled');
        
        // 2. Remove click event listener yang ada
        const newHeader = modulHeader.cloneNode(true);
        modulHeader.parentNode.replaceChild(newHeader, modulHeader);
        
        // 3. Set style untuk benar-benar disabled
        newHeader.style.pointerEvents = 'none';
        newHeader.style.opacity = '0.5';
        newHeader.style.cursor = 'not-allowed';
        newHeader.style.backgroundColor = '#f8f9fa'; // Background abu-abu
        
        // 4. Update lock icon
        const lockIcon = newHeader.querySelector('.status-lock, .status-unlock');
        if (lockIcon) {
            lockIcon.className = 'status-lock';
            lockIcon.innerHTML = '<i class="fas fa-lock"></i>';
            lockIcon.style.color = '#dc3545'; // Warna merah untuk emphasis
        }
        
        // 5. Add tooltip "Selesaikan Perkenalan dulu"
        newHeader.title = 'Selesaikan Perkenalan terlebih dahulu!';
        newHeader.setAttribute('data-bs-toggle', 'tooltip');
        newHeader.setAttribute('data-bs-placement', 'top');
        
        console.log(`ðŸ”’ STRICT LOCK Modul Hari ${hariKe}`);
        
        // Initialize Bootstrap tooltip
        new bootstrap.Tooltip(newHeader);
    }
}

/************************************
* Unlock modul dengan icon benar   *
*************************************/
function unlockModul(hariKe) {
    const modulHeader = document.querySelector(`[data-hari="${hariKe}"]`);
    if (modulHeader) {
        // 1. Remove disabled class
        modulHeader.classList.remove('disabled');
        
        // 2. Restore style
        modulHeader.style.pointerEvents = 'auto';
        modulHeader.style.opacity = '1';
        modulHeader.style.cursor = 'pointer';
        modulHeader.style.backgroundColor = '';
        
        // 3. Update lock icon ke UNLOCK
        const lockIcon = modulHeader.querySelector('.status-lock, .status-unlock');
        if (lockIcon) {
            lockIcon.className = 'status-unlock';
            lockIcon.innerHTML = '<i class="fas fa-unlock"></i>';
            lockIcon.style.color = '#ffffff;            // #28a745'; // Warna hijau
        }
        
        // 4. Remove tooltip
        modulHeader.removeAttribute('title');
        modulHeader.removeAttribute('data-bs-toggle');
        modulHeader.removeAttribute('data-bs-placement');
        
        console.log(`ðŸ”“ Modul Hari ${hariKe} UNLOCKED dengan icon benar`);
    }
}

/************************************
* Lock semua modul untuk user baru  *
*************************************/
function applyLockForNewUser() {
    console.log('ðŸ” Lock semua modul untuk user baru');
    
    // Lock semua modul hari 1-10
    for (let i = 1; i <= 10; i++) {
        lockModul(i);
    }
    
    // Perkenalan tetap terbuka
    const perkenalanHeader = document.querySelector('[data-bs-target="#perkenalanContent"]');
    if (perkenalanHeader) {
        perkenalanHeader.classList.remove('disabled');
        perkenalanHeader.style.pointerEvents = 'auto';
        perkenalanHeader.style.opacity = '1';
    }
}

/************************************
* Lock modul tertentu              *
*************************************/
function lockModul(hariKe) {
    const modulHeader = document.querySelector(`[data-hari="${hariKe}"]`);
    if (modulHeader) {
        modulHeader.classList.add('disabled');
        modulHeader.style.pointerEvents = 'none';
        modulHeader.style.opacity = '0.6';
        modulHeader.style.cursor = 'not-allowed';
        
        // Update lock icon
        const lockIcon = modulHeader.querySelector('.status-lock');
        if (lockIcon) {
            lockIcon.className = 'status-lock';
            lockIcon.innerHTML = '<i class="fas fa-lock"></i>';
        }
        
        console.log(`ðŸ”’ Modul Hari ${hariKe} dikunci`);
    }
}

/************************************
* Update UI Perkenalan lengkap     *
*************************************/
function updatePerkenalanUI() {
    console.log('ðŸ”„ Updating Perkenalan UI...');
    
    // 1. Update link "Selesai Perkenalan"
    const perkenalanLinks = document.querySelectorAll('#perkenalanContent .menu-item');
    perkenalanLinks.forEach(link => {
        if (link.textContent.includes('Selesai Perkenalan')) {
            const newLink = link.cloneNode(true);
            newLink.innerHTML = '<i class="fas fa-check-double"></i>Selesai Perkenalan âœ“';
            newLink.style.color = '#666666';
            newLink.style.fontWeight = 'bold';
            newLink.style.pointerEvents = 'none';
            newLink.onclick = null;
            newLink.href = '#';
            link.parentNode.replaceChild(newLink, link);
        }
    });
    
    // 2. Update header perkenalan (jika ada icon)
    const perkenalanHeader = document.querySelector('[data-bs-target="#perkenalanContent"]');
    if (perkenalanHeader) {
        const lockIcon = perkenalanHeader.querySelector('.status-lock, .status-unlock');
        if (lockIcon) {
            lockIcon.className = 'status-unlock';
            lockIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
            lockIcon.style.color = '#28a745';
        }
    }
    console.log('âœ… Perkenalan UI updated');
}

/***********************
* Setup semua komponen *
************************/
function setupAllComponents() {
    console.log('ðŸ”§ Setting up all components...');

    // Submenu triggers untuk menampilkan form dari submenu
    document.querySelectorAll('.submenu-trigger').forEach(trigger => {
      trigger.addEventListener('click', function(e) {
        e.preventDefault();
        const target = this.getAttribute('data-target');
        showSubmenu(target);
      });
    });
    
    // Setup tombol close di semua submenu
    document.querySelectorAll('.btn-close-header').forEach(btn => {
      btn.addEventListener('click', function() {
        const targetId = this.closest('.submenu-content').id;
        hideSubmenu(targetId);
      });
    });

    // Setup video links
    setupAllLinks();
    
    // Setup playlist
    setupPlaylistTriggers();
    
    // Setup Materi Perkenalan
    setupPerkenalanCompletion();
    
    // Setup PDF links
    setupPanduanPDFLinks();

    // Setup tombol "Cek Disini" untuk Modul 
    setupCekDisiniButtons();
    
    // Setup materi completion
    setupMateriCompletion();
    
    // Check materi status
    for (let i = 1; i <= 10; i++) {
      checkMateriStatus(i);
    }
    
    // Setup meal plan forms
    generateMealPlanForms();
    
    // Cek status meal plan
    for (let i = 1; i <= 10; i++) {
      checkMealPlanStatus(i);
      loadMealPlanProgress(i);
    }
    
    // Setup workout forms dan resistance
    generateWorkoutForms();
    initializeAllWorkoutDays();
    
    // Setup tentang overlay
    document.getElementById('btnCloseAbout').addEventListener('click', hideAbout);
    
    // Cek login status untuk tombol logout
    const userToken = localStorage.getItem('userToken');
    if (userToken) {
        const loginMenuItem = document.getElementById('loginMenuItem');
        if (loginMenuItem) {
            loginMenuItem.innerHTML = `
                <a class="nav-link main-menu-link" href="loginFC.html" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            `;
        }
    }
    
    // Initialize video players
    initializeAllVideoPlayers();
    console.log('âœ… All components setup complete');
}

/************************************
* Load progress dari localStorage   *
*************************************/
function loadProgressFromStorage() {
  console.log('ðŸ“‚ Memuat progress dari storage...');
  
  // Ambil data progress
  const progressData = localStorage.getItem('progressData');
  const userId = localStorage.getItem('userId');
  
  if (progressData) {
    const progress = JSON.parse(progressData);
    console.log('ðŸ“Š Progress ditemukan:', progress);
    
    // APLIKASIKAN KE UI
    applyProgressToUI(progress);
  } else if (userId) {
    // Jika ada userId tapi tidak ada progress, coba ambil dari server
    console.log('ðŸ”„ Ambil progress dari server...');
    fetchProgressFromServer(userId);
  }
}

/************************************
* Ambil progress dari server        *
*************************************/
function fetchProgressFromServer(userId) {
    const callbackName = 'cb_fetch_progress_' + Date.now();
    const script = document.createElement('script');
    
    script.src = `${URL_PROGRAM_APP}?action=getLastProgress&userId=${encodeURIComponent(userId)}&callback=${callbackName}`;
    window[callbackName] = function(response) {
        console.log('ðŸ“¡ Progress dari server:', response);
        
        if (response.success) {
            // Simpan ke localStorage
            localStorage.setItem('progressData', JSON.stringify(response));
            
            // Apply ke UI berdasarkan status
            if (response.perkenalan) {
                applyExistingUserProgress(response);
            } else {
                applyLockForNewUser();
            }
        }
        document.body.removeChild(script);
        delete window[callbackName];
    };
    
    script.onerror = () => {
        console.warn('âš ï¸ Gagal ambil progress dari server');
        document.body.removeChild(script);
        delete window[callbackName];
    };
    document.body.appendChild(script);
}

/************************************
* Terapkan progress ke UI - SIMPLE  *
*************************************/
function applyProgressToUI(progress) {
  console.log('ðŸŽ¯ Menerapkan progress ke UI');
  
  // 1. PERKENALAN
  if (progress.perkenalan) {
    console.log('âœ… Perkenalan sudah selesai');
    
    // Update link "Selesai Perkenalan"
    const perkenalanLinks = document.querySelectorAll('#perkenalanContent .menu-item');
    perkenalanLinks.forEach(link => {
      if (link.textContent.includes('Selesai Perkenalan')) {
        link.innerHTML = '<i class="fas fa-check-double"></i>Selesai Perkenalan âœ“';
        link.style.color = '#666666';
        link.style.fontWeight = 'bold';
        link.style.pointerEvents = 'none';
      }
    });
    
    // Unlock Modul Hari 1
    unlockModul(1);
  }
  
  // 2. MATERI HARI 1
  if (progress.materiHari1) {
    console.log('âœ… Materi Hari 1 sudah selesai');
    
    // Update link materi
    const materiLink = document.getElementById('materiLink1');
    if (materiLink) {
      materiLink.innerHTML = materiLink.innerHTML + ' âœ“';
      materiLink.style.color = '#666666';
      materiLink.style.fontWeight = 'bold';
    }
    
    // Update tombol centang di video
    const completeBtn = document.querySelector('#videoContainerPertemuan1 .complete-btn');
    if (completeBtn) {
      completeBtn.innerHTML = '<i class="fas fa-check-double"></i>';
      completeBtn.classList.remove('btn-success');
      completeBtn.classList.add('btn-secondary');
      completeBtn.disabled = true;
    }
  }
  
  // 3. MEAL PLAN HARI 1
  if (progress.mealplanHari1) {
    console.log('âœ… Meal Plan Hari 1 sudah selesai');
    
    // Update link meal plan
    const mealPlanLinks = document.querySelectorAll('[onclick="uploadMealPlan(1)"]');
    mealPlanLinks.forEach(link => {
      link.innerHTML = '<i class="fas fa-utensils"></i>1.2 Meal Plan - Hari Pertama âœ“';
      link.style.color = '#666666';
      link.style.fontWeight = 'bold';
    });
    
    // Update tombol selesai meal plan
    const selesaiBtn = document.getElementById('btnSelesaiMealPlan1');
    if (selesaiBtn) {
      selesaiBtn.innerHTML = '<i class="fas fa-check-double"></i> Selesai Meal Plan Hari Pertama';
      selesaiBtn.classList.remove('btn-secondary');
      selesaiBtn.classList.add('btn-success');
      selesaiBtn.disabled = true;
    }
  }
  
  console.log('âœ… Progress berhasil diterapkan');
}

/**********************************
* Cek status materi dan update UI *
***********************************/
function checkMateriStatus(hariKe) {
    const status = localStorage.getItem(`materi_hari_${hariKe}`);
    if (status === 'completed') {
        updateMateriCompletionUI(hariKe);
    }
}

/**************************
* Setup Tombol Cek Disini - untuk semua hari
***************************/
function setupCekDisiniButtons() {
    console.log('ðŸ”§ Setting up Cek Disini buttons for all days...');
    
    // Setup event listeners untuk semua tombol Cek Disini yang ada
    document.querySelectorAll('[id^="btnCekDisini"]').forEach(button => {
        button.addEventListener('click', function() {
            // Deteksi jenis dan hari dari ID button
            const buttonId = this.id;
            let jenis, hariKe;
            
            // Extract informasi dari ID button
            if (buttonId.includes('MealPlan')) {
                jenis = 'MealPlan';
                hariKe = buttonId.replace('btnCekDisiniMealPlan', '') || '1';
            } else if (buttonId.includes('Workout')) {
                jenis = 'WorkOut';
                hariKe = buttonId.replace('btnCekDisiniWorkout', '') || '1';
            } else if (buttonId.includes('AirMinum')) {
                jenis = 'WaterReminder';
                hariKe = buttonId.replace('btnCekDisiniAirMinum', '') || '1';
            } else if (buttonId.includes('Istirihat')) {
                jenis = 'Istirahat';
                hariKe = buttonId.replace('btnCekDisiniIstirihat', '') || '1';
            } else if (buttonId.includes('DataTubuh')) {
                jenis = 'DataTracking';
                hariKe = buttonId.replace('btnCekDisiniDataTubuh', '') || '1';
            }
            
            if (jenis && hariKe) {
                handleCekDisiniClick(jenis, hariKe);
            }
        });
    });
    
    console.log('âœ… Cek Disini buttons setup completed for all days');
}


/**************************************
* Handle klik tombol Cek Disini untuk semua jenis dan hari
***************************************/
function handleCekDisiniClick(jenis, hariKe) {
    console.log(`ðŸ“‹ ${jenis} button clicked for day ${hariKe}`);
    
    // Mapping jenis ke section dan nama file
    const config = {
        'MealPlan': {
            section: 'mealplan',
            fileName: `MealPlan_HariKe${hariKe}.pdf`,
            title: `Meal Plan Hari ${getDayName(hariKe)}`
        },
        'WorkOut': {
            section: 'workout', 
            fileName: `WorkOut_HariKe${hariKe}.pdf`,
            title: `Workout Hari ${getDayName(hariKe)}`
        },
        'WaterReminder': {
            section: 'water',
            fileName: `WaterReminder_HariKe${hariKe}.pdf`,
            title: `Water Reminder Hari ${getDayName(hariKe)}`
        },
        'Istirahat': {
            section: 'istirahat',
            fileName: `Istirahat_HariKe${hariKe}.pdf`,
            title: `Waktu Istirahat Hari ${getDayName(hariKe)}`
        },
        'DataTracking': {
            section: 'datatracking',
            fileName: `DataTracking_HariKe${hariKe}.pdf`,
            title: `Data Tracking Hari ${getDayName(hariKe)}`
        }
    };
    
    const itemConfig = config[jenis];
    if (itemConfig) {
        const pdfUrl = `https://amihaji.github.io/beratideal/pdf/${itemConfig.fileName}`;
        const sectionId = `${itemConfig.section}${hariKe}`;
        
        loadPDF(sectionId, pdfUrl, itemConfig.title);
    }
}

/*************************
* Helper untuk nama hari *
**************************/
function getDayName(hariKe) {
    const dayNames = {
        1: 'Pertama',
        2: 'Kedua', 
        3: 'Ketiga',
        4: 'Keempat',
        5: 'Kelima',
        6: 'Keenam',
        7: 'Ketujuh',
        8: 'Kedelapan',
        9: 'Kesembilan',
        10: 'Kesepuluh'
    };
    return dayNames[hariKe] || `ke-${hariKe}`;
}

// ********************************
// ***** FUNGSI VIDEO PLAYER ******
// ********************************
let currentVideoData = {};

/************************************
* Fungsi Initialisasi Seluruh video *
*************************************/ 
function initializeAllVideoPlayers() {
  console.log('Initializing video players...');

  // Setup video placeholder click events
  document.querySelectorAll('.video-placeholder').forEach(placeholder => {
    const section = placeholder.closest('.video-container').id.replace('videoContainer', '');
    placeholder.addEventListener('click', function() {
      playVideo(section);
    });
  });
  
  // Close video dengan ESC key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && currentVideoData.section) {
      closeVideo(currentVideoData.section);
    }
  });
}

/*********************************
* Setup Semua Link Video dan PDF *
**********************************/
function setupAllLinks() {
  // Setup video links
  document.querySelectorAll('.video-link').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      
      const section = this.getAttribute('data-section');
      const videoType = this.getAttribute('data-type');
      const videoUrl = this.getAttribute('data-url');
      const title = this.textContent.trim();
      
      // Sembunyikan semua konten lain
      document.querySelectorAll('.submenu-content').forEach(content => {
        content.style.display = 'none';
      });
      document.querySelectorAll('.video-container').forEach(video => {
        video.style.display = 'none';
      });
      document.querySelectorAll('.pdf-viewer').forEach(pdf => {
        pdf.style.display = 'none';
      });
      
      // Load video
      loadVideo(section, videoType, videoUrl, title);
      
      // Tampilkan video player di posisi yang tepat
      const videoContainer = document.getElementById(`videoContainer${capitalizeFirst(section)}`);
      if (videoContainer) {
        videoContainer.style.display = 'block';
        
        // Sisipkan video container setelah link video yang diklik
        this.parentNode.insertBefore(videoContainer, this.nextSibling);
        
        // Auto play video
        setTimeout(() => {
          playVideo(section);
        }, 500);
      }
    });
  });
  
  // Setup PDF links
  setupPDFLinks();
}

/******************************************
* Fungsi Memuat Video Berdasarkan Section *
*******************************************/ 
function loadVideo(section, videoType, videoUrl, title = '') {
    console.log('ðŸŽ¬ loadVideo called:', { section, videoType, videoUrl, title });
   
    // Untuk Canva, buka di tab baru
    if (videoType === 'canva') {
        window.open(videoUrl, '_blank');
        return;
    }
    
    const videoContainer = document.getElementById(`videoContainer${capitalizeFirst(section)}`);
    if (!videoContainer) {
        console.error('âŒ Video container not found for section:', section);
        return;
    }
    
    const videoPlaceholder = videoContainer.querySelector('.video-placeholder');
    const videoLoading = document.getElementById(`videoLoading${capitalizeFirst(section)}`);
    const videoPlayer = document.getElementById(`videoPlayer${capitalizeFirst(section)}`);
    
    // Validasi URL YouTube
    if (videoType === 'youtube' && !validateYouTubeUrl(videoUrl)) {
        console.error('âŒ Invalid YouTube URL:', videoUrl);
        showMessage('error', 'URL Youtube tidak valid');
        return;
    }
    // Close video di section lain
    closeAllVideos();
    
    // Reset previous video 
    if (videoPlayer) videoPlayer.innerHTML = '';
    currentVideoData = {
        section: section,
        type: videoType,
        url: videoUrl,
        title: title
    };
    
    // Show video container
    videoContainer.style.display = 'block';
    
    // Update placeholder text
    let placeholderText = 'Klik untuk memuat video';
    if (videoType === 'youtube') {
        const youtubeId = extractYouTubeId(videoUrl);
        placeholderText = youtubeId ? 'Klik untuk memuat video dari YouTube' : 'URL YouTube tidak valid';
    } else if (videoType === 'local') {
        placeholderText = 'Klik untuk memuat video';
    }
    
    if (videoPlaceholder) {
        videoPlaceholder.querySelector('.video-placeholder-text').textContent = placeholderText;
        videoPlaceholder.style.display = 'flex';
    }
    if (videoLoading) videoLoading.style.display = 'none';
    
    // Auto play setelah ditampilkan
    setTimeout(() => {
        playVideo(section);
    }, 500);
}

/**********************************
* Memutar Video yang sudah dimuat *
***********************************/
function playVideo(section) {
    console.log('playVideo called for section:', section);
    
    const videoContainer   = document.getElementById(`videoContainer${capitalizeFirst(section)}`);
    const videoPlaceholder = videoContainer?.querySelector('.video-placeholder');
    const videoLoading     = document.getElementById(`videoLoading${capitalizeFirst(section)}`);
    const videoPlayer      = document.getElementById(`videoPlayer${capitalizeFirst(section)}`);
    
    if (!videoContainer || !videoPlayer) {
        console.error('Video elements not found for section:', section);
        return;
    }
    
    // Hide placeholder, show loading
    if (videoPlaceholder) videoPlaceholder.style.display = 'none';
    if (videoLoading) videoLoading.style.display = 'flex';
    
    // Load video based on type
    setTimeout(() => {
        if (videoLoading) videoLoading.style.display = 'none';
        
        if (currentVideoData.type === 'youtube') {
            console.log('Loading YouTube video:', currentVideoData.url);
            loadYouTubeVideo(videoPlayer, currentVideoData.url);
        } else if (currentVideoData.type === 'local') {
            console.log('Loading local video:', currentVideoData.url);
            loadLocalVideo(videoPlayer, currentVideoData.url);
        }
    }, 1000);
}

/***********************
* Memuat Video Youtube *
************************/
function loadYouTubeVideo(videoPlayer, url) {
    const videoId = extractYouTubeId(url);
    console.log('YouTube ID extracted:', videoId);
    
    if (videoId) {
        videoPlayer.innerHTML = `
            <iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
            </iframe>
        `;
        console.log('YouTube iframe created');
    } else {
        console.error('Could not extract YouTube ID from URL:', url);
        // Fallback: buka di tab baru
        window.open(url, '_blank');
        if (currentVideoData.section) {
            closeVideo(currentVideoData.section);
        }
    }
}

/*********************
* Memuat Video Local *
**********************/
function loadLocalVideo(videoPlayer, url) {
    console.log('Creating local video element for:', url);
    videoPlayer.innerHTML = `
        <video controls autoplay style="width:100%; height:100%">
            <source src="${url}" type="video/mp4">
            Browser Anda tidak mendukung pemutaran video.
        </video>
    `;
    
    // Handle error loading local video
    const videoElement = videoPlayer.querySelector('video');
    if (videoElement) {
        videoElement.onerror = function() {
            console.error('Error loading local video:', url);
            showMessage('error', 'Video tidak dapat dimuat');
            if (currentVideoData.section) {
                closeVideo(currentVideoData.section);
            }
        };
    }
}

/******************************
* Ekstrak ID dari URL YouTube *
*******************************/
function extractYouTubeId(url) {
    console.log('ðŸ” Extracting YouTube ID from:', url);
    
    if (!url) {
        console.log('âŒ URL is empty');
        return null;
    }
    
    // Support semua format URL YouTube
    const patterns = [
        /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&?#]+)/,
        /youtube\.com\/watch\?.*v=([^&?#]+)/,
        /youtu\.be\/([^&?#]+)/,
        /youtube\.com\/v\/([^&?#]+)/,
        /youtube\.com\/watch\?.*vi?=([^&?#]+)/,
        /youtube\.com\/user\/.*\/[^#]+\?.*v=([^&?#]+)/
    ];
    
    for (const pattern of patterns) {
        const match = url.match(pattern);
        if (match && match[1]) {
            const videoId = match[1];
            console.log('âœ… YouTube ID found:', videoId);
            return videoId;
        }
    }
    
    // Fallback: coba ekstrak dengan metode split
    try {
        if (url.includes('youtube.com/watch?v=')) {
            const videoId = url.split('v=')[1]?.split('&')[0];
            if (videoId && videoId.length === 11) {
                console.log('âœ… YouTube ID found (fallback):', videoId);
                return videoId;
            }
        } else if (url.includes('youtu.be/')) {
            const videoId = url.split('youtu.be/')[1]?.split('?')[0];
            if (videoId && videoId.length === 11) {
                console.log('âœ… YouTube ID found (fallback):', videoId);
                return videoId;
            }
        }
    } catch (error) {
        console.error('Error in fallback extraction:', error);
    }
    
    console.log('âŒ No YouTube ID found in URL:', url);
    return null;
}

/**********************************
* Tutup Video di Section Tertentu *
***********************************/
function closeVideo(section) {
    console.log('Closing video for section:', section);
    
    const videoContainer = document.getElementById(`videoContainer${capitalizeFirst(section)}`);
    if (!videoContainer) return;
    
    const videoPlayer = document.getElementById(`videoPlayer${capitalizeFirst(section)}`);
    const videoPlaceholder = videoContainer.querySelector('.video-placeholder');
    const videoLoading = document.getElementById(`videoLoading${capitalizeFirst(section)}`);
    
    // Stop video playback
    const iframe = videoPlayer.querySelector('iframe');
    const localVideo = videoPlayer.querySelector('video');
    
    if (iframe) iframe.src = '';
    if (localVideo) {
        localVideo.pause();
        localVideo.currentTime = 0;
    }
    
    videoPlayer.innerHTML = '';
    videoContainer.style.display = 'none';
    if (videoPlaceholder) videoPlaceholder.style.display = 'flex';
    if (videoLoading) videoLoading.style.display = 'none';
    
    currentVideoData = {};
}

/****************************************
* Tutup Semua Video yang sedang diputar *
*****************************************/
function closeAllVideos() {
    console.log('Closing all videos and submenus');
    
    // Tutup semua video
    const videoContainers = document.querySelectorAll('.video-container');
    videoContainers.forEach(container => {
        const section = container.id.replace('videoContainer', '');
        if (section) {
            closeVideo(section);
        }
    });
    
    // Tutup semua submenu
    document.querySelectorAll('.submenu-content').forEach(content => {
        content.style.display = 'none';
        
        // Kembalikan ke posisi semula
        const menuAccordion = document.getElementById('menuAccordion');
        if (menuAccordion && menuAccordion.parentNode) {
            menuAccordion.parentNode.insertBefore(content, menuAccordion.nextSibling);
        }
    });
    
    // Tutup semua PDF
    closeAllPDFs();
}

/***********************
* Validasi URL YouTube *
************************/
function validateYouTubeUrl(url) {
    console.log('ðŸ” Validating YouTube URL:', url);
    
    const youtubeRegex = /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+/;
    const isValid = youtubeRegex.test(url);
    
    console.log('âœ… YouTube URL validation:', isValid);
    return isValid;
}

// ****************************
// ***** FUNGSI PLAYLIST ******
/******************************
 
/************************************
* Memuat data playlist dari File JSon
*************************************/
async function loadPlaylistData() {
    try {
        console.log('ðŸ“¥ Loading playlist data from JSON...');
        const response = await fetch(PLAYLIST_JSON_URL);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log(`âœ… Loaded ${data.length} videos from JSON`);
        return data;
        
    } catch (error) {
        console.error('âŒ Error loading playlist data:', error);
        // Fallback ke proven videos
        return getProvenVideos();
    }
}

/*********************************
* Fallback Video Jika JSon Error *
**********************************/
function getProvenVideos() {
    return [
        {
            id: '1',
            videoId: '9DoHhx9jlGM',
            title: 'Alasan Mengapa Herbalife',
            thumbnail: 'https://i.ytimg.com/vi/9DoHhx9jlGM/mqdefault.jpg',
            duration: '15:30',
            position: 1
        },
        {
            id: '2', 
            videoId: 'Zg_badTE2Ec',
            title: 'Dari Mana Saja Sumber Protein Bisa Didapatkan?',
            thumbnail: 'https://i.ytimg.com/vi/Zg_badTE2Ec/mqdefault.jpg',
            duration: '12:45',
            position: 2
        }
    ];
}

/*************************
* Setup Trigger Playlist *
**************************/
function setupPlaylistTriggers() {
  document.querySelectorAll('.playlist-trigger').forEach(trigger => {
    trigger.addEventListener('click', function(e) {
      e.preventDefault();
      const target = this.getAttribute('data-target');
      const playlistUrl = this.getAttribute('href');
      showPlaylistInSection(target, playlistUrl, this);
    });
  });
}

/********************************
* Tampilkan Playlist di Section *
*********************************/
async function showPlaylistInSection(targetId, playlistUrl, triggerElement) {
  const playlistContainer = document.getElementById(targetId);
  if (!playlistContainer) {
    console.error('Playlist container not found:', targetId);
    return;
  }
  
  // Sembunyikan semua konten lain
  document.querySelectorAll('.submenu-content').forEach(content => {
    content.style.display = 'none';
  });
  document.querySelectorAll('.video-container').forEach(video => {
    video.style.display = 'none';
  });
  document.querySelectorAll('.pdf-viewer').forEach(pdf => {
    pdf.style.display = 'none';
  });
  document.querySelectorAll('.playlist-container').forEach(playlist => {
    playlist.style.display = 'none';
  });
  
  // Tampilkan loading
  playlistContainer.innerHTML = `
    <div class="playlist-loading">
      <div class="spinner-border spinner-border-sm" role="status"></div>
      <div class="mt-2">Memuat daftar video...</div>
    </div>
  `;
  playlistContainer.style.display = 'block';
  
  // Tempatkan playlist container setelah trigger element
  if (triggerElement && triggerElement.parentNode) {
    triggerElement.parentNode.insertBefore(playlistContainer, triggerElement.nextSibling);
  }
  
  try {
    const playlistItems = await loadPlaylistData();
    if (!playlistItems || playlistItems.length === 0) {
      throw new Error('Tidak ada data video');
    }
    renderPlaylist(playlistContainer, playlistItems, 'healthyRecept');
  } catch (error) {
    console.error('Error showing playlist:', error);
    // Fallback ke proven videos
    const provenVideos = getProvenVideos();
    renderPlaylist(playlistContainer, provenVideos, 'healthyRecept');
  }
}

/********************************************
* Render Playlist items dengan tombol close *
*********************************************/
function renderPlaylist(container, items, section) {
  container.innerHTML = '';
  
  // Header dengan tombol close
  const header = document.createElement('div');
  header.className = 'playlist-header position-relative';
  header.style.padding = '12px 15px';
  header.style.borderBottom = '1px solid #dee2e6';
  header.style.background = '#f8f9fa';
  header.style.fontWeight = '600';
  header.innerHTML = `
    <div>
      <i class="fas fa-list-ul me-2"></i>Playlist Healthy Snacking
      <div style="font-size: 12px; color: #666; font-weight: normal; margin-top: 2px;">
        ${items.length} video tersedia
      </div>
    </div>
    <button type="button" class="btn-close-header position-absolute top-50 end-0 translate-middle-y me-2" 
            onclick="hidePlaylist('${container.id}')">
      <i class="fas fa-times"></i>
    </button>
  `;
  container.appendChild(header);
  
  // Render playlist items
  items.forEach((item, index) => {
    const playlistItem = document.createElement('div');
    playlistItem.className = 'playlist-item';
    playlistItem.style.cursor = 'pointer';
    playlistItem.innerHTML = `
      <div class="playlist-thumbnail">
        <img src="${item.thumbnail}" alt="${item.title}" 
             loading="lazy"
             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjY4IiB2aWV3Qm94PSIwIDAgMTIwIDY4IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iNjgiIGZpbGw9IiNlZGVkZWQiLz48dGV4dCB4PSI2MCIgeT0iMzQiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMCIgZmlsbD0iIzk5OTk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+VGh1bWJuYWlsPC90ZXh0Pjwvc3ZnPg=='">
        <div class="position-badge">${index + 1}</div>
      </div>
      <div class="playlist-info">
        <div class="playlist-title">${item.title}</div>
        <div class="playlist-meta">
          ${item.duration ? `<span class="playlist-duration"><i class="fas fa-clock me-1"></i>${item.duration}</span>` : ''}
          <span class="playlist-position">Video ${index + 1}</span>
        </div>
      </div>
    `;
    
    playlistItem.onclick = function() {
      playVideoFromPlaylist(section, item.videoId, item.title);
    };
    
    container.appendChild(playlistItem);
  });
  
  // Footer
  const footer = document.createElement('div');
  footer.className = 'playlist-footer';
  footer.style.padding = '10px 15px';
  footer.style.borderTop = '1px solid #dee2e6';
  footer.style.fontSize = '12px';
  footer.style.color = '#666';
  footer.style.textAlign = 'center';
  footer.style.background = '#f8f9fa';
  footer.innerHTML = `
    <div><i class="fas fa-database me-1"></i>Data update â€¢ ${new Date().toLocaleDateString('id-ID')}</div>
  `;
  container.appendChild(footer);
}

/***********************
* Fungsi Hide Playlist *
************************/
function hidePlaylist(playlistId) {
  const playlistContainer = document.getElementById(playlistId);
  
  if (playlistContainer) {
    playlistContainer.style.display = 'none';
  }
  
  // Kembalikan ke posisi semula jika perlu
  const healthyReceptContent = document.getElementById('healthyRecept');
  if (healthyReceptContent && playlistId === 'playlistHealthyRecept') {
    const menuContent = healthyReceptContent.querySelector('.menu-content');
    if (menuContent) {
      menuContent.appendChild(playlistContainer);
    }
  }
}

/****************************
* Putar Video dari Playlist *
*****************************/
function playVideoFromPlaylist(section, videoId, title) {
    console.log('ðŸŽ¬ Playing video from playlist:', { section, videoId, title });
    
    const videoContainer = document.getElementById(`videoContainer${capitalizeFirst(section)}`);
    if (!videoContainer) {
        console.error('Video container not found for section:', section);
        return;
    }
    
    // Sembunyikan playlist
    const playlistContainer = document.getElementById(`playlist${capitalizeFirst(section)}`);
    if (playlistContainer) {
        playlistContainer.style.display = 'none';
    }
    // Show video container
    videoContainer.style.display = 'block';
    // Set current video data
    currentVideoData = {
        section: section,
        type: 'youtube',
        url: `https://www.youtube.com/watch?v=${videoId}`,
        title: title
    };
    
    // Auto play video setelah delay
    setTimeout(() => { playVideo(section);}, 500);
    
    // Scroll ke video player
    setTimeout(() => { videoContainer.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 600);
}

// *****************************
// ***** FUNGSI PDF VIEWER *****
// *****************************
let currentPDFData = {};

/************************
* Fungsi Setup PDF Link *
*************************/
function setupPDFLinks() {
  document.querySelectorAll('.pdf-link').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      
      const section = this.getAttribute('data-section');
      const pdfUrl = this.getAttribute('data-url');
      const title = this.textContent.trim();
      
      // Sembunyikan semua video container
      document.querySelectorAll('.video-container').forEach(video => {
        video.style.display = 'none';
      });
      
      // Sembunyikan semua submenu content
      document.querySelectorAll('.submenu-content').forEach(content => {
        content.style.display = 'none';
      });
      
      // Sembunyikan semua PDF viewer terlebih dahulu
      document.querySelectorAll('.pdf-viewer').forEach(pdf => {
        pdf.style.display = 'none';
      });
      
      // Load PDF
      loadPDF(section, pdfUrl, title);
      
      // Tampilkan PDF viewer di posisi yang tepat
      const pdfViewer = document.getElementById(`pdfViewer${capitalizeFirst(section)}`);
      if (pdfViewer) {
        pdfViewer.style.display = 'block';
        
        // Sisipkan PDF viewer setelah link PDF yang diklik
        this.parentNode.insertBefore(pdfViewer, this.nextSibling);
      }
    });
  });
}

/*****************************
* Memuat dan Menampilkan PDF *
******************************/ 
function loadPDF(section, pdfUrl, title = '') {
    console.log('loadPDF called:', { section, pdfUrl, title });
    
    const pdfViewer = document.getElementById(`pdfViewer${capitalizeFirst(section)}`);
    const pdfContainer = document.getElementById(`pdfContainer${capitalizeFirst(section)}`);
    
    if (!pdfViewer || !pdfContainer) {
        console.error('âŒ PDF Viewer or Container not found for section:', section);
        return;
    }
    
    // Close video dan PDF lain
    closeAllVideos();
    closeAllPDFs();
    
    // Reset previous PDF
    pdfContainer.innerHTML = '';
    currentPDFData = {
        section: section,
        url: pdfUrl,
        title: title
    };
    
    // Show loading
    pdfContainer.innerHTML = `
        <div class="pdf-loading">
            <div class="spinner-border spinner-border-sm" role="status"></div>
            <div class="mt-2">Memuat PDF, tunggu...</div>
        </div>
    `;
    
    // Show PDF viewer
    pdfViewer.style.display = 'block';
    
    // Tempatkan PDF viewer di posisi yang tepat
    if (section === 'panduan') {
        // Untuk menu Panduan: tempatkan setelah link PDF yang diklik
        const pdfLink = document.getElementById('pdfPanduanLink');
        if (pdfLink && pdfLink.parentNode) {
            pdfLink.parentNode.insertBefore(pdfViewer, pdfLink.nextSibling);
            console.log('âœ… PDF Panduan placed after link');
        }
    } else {
        // Untuk tombol "Cek Disini": tempatkan setelah tombol yang diklik
        const cekDisiniBtn = document.getElementById(`btnCekDisini${capitalizeFirst(section)}`);
        if (cekDisiniBtn && cekDisiniBtn.parentNode) {
            // Tempatkan PDF viewer setelah parent paragraph dari tombol
            const parentParagraph = cekDisiniBtn.closest('p');
            if (parentParagraph && parentParagraph.parentNode) {
                parentParagraph.parentNode.insertBefore(pdfViewer, parentParagraph.nextSibling);
                console.log('âœ… PDF placed after button paragraph');
            } else {
                // Fallback: tempatkan setelah tombol langsung
                cekDisiniBtn.parentNode.insertBefore(pdfViewer, cekDisiniBtn.nextSibling);
                console.log('âœ… PDF placed after button');
            }
        } else {
            console.error('âŒ Cek Disini button not found for section:', section);
        }
    }
    // Load PDF setelah ditampilkan
    setTimeout(() => { displayPDF(section, pdfUrl, title); }, 500);
}

/***************************************
* Setup link PDF - khusus Menu Panduan *
****************************************/
function setupPanduanPDFLinks() {
    const panduanPDFLink = document.getElementById('pdfPanduanLink');
    if (panduanPDFLink) {
        // Hapus href yang menyebabkan navigasi
        panduanPDFLink.href = "#";
        // Tambahkan event listener baru
        panduanPDFLink.addEventListener('click', function(e) {
            e.preventDefault();
            loadPDF('panduan', 'pdf/Panduan_Penggunaan_Aplikasi.pdf', 'PDF Panduan Penggunaan Aplikasi');
        });
        
        console.log('âœ… PDF Panduan link setup completed');
    } else {
        console.error('âŒ PDF Panduan link not found');
    }
}

/******************
* Menampilkan PDF *
*******************/
function displayPDF(section, pdfUrl, title) {
    console.log('Displaying PDF with PDF.js:', pdfUrl);
    const pdfContainer = document.getElementById(`pdfContainer${capitalizeFirst(section)}`);
    if (!pdfContainer) return;
    
    // Set up PDF.js
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
    
    let pdfDoc = null;
    let pageNum = 1;
    let pageRendering = false;
    let pageNumPending = null;
    const scale = 1.5;
    function renderPage(num) {
        pageRendering = true;
        pdfDoc.getPage(num).then(function(page) {
            const viewport = page.getViewport({ scale: scale });
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            canvas.className = 'pdfjs-canvas';
            const renderContext = {
                canvasContext: ctx,
                viewport: viewport
            };
            const renderTask = page.render(renderContext);
            renderTask.promise.then(function() {
                pageRendering = false;
                if (pageNumPending !== null) {
                    renderPage(pageNumPending);
                    pageNumPending = null;
                }
            });
            
            // Clear container dan tambahkan canvas DULUAN
            const viewer = document.getElementById(`pdfjsViewer${capitalizeFirst(section)}`);
            viewer.innerHTML = '';
            viewer.appendChild(canvas);
            
            // Update page info
            document.getElementById(`pdfjsPageInfo${capitalizeFirst(section)}`).textContent = 
                `Hal: ${num} dari ${pdfDoc.numPages}`;
                
        }).catch(function(error) {
            console.error('Error rendering page:', error);
            // handlePDFError(section);
        });
    }
    // Antrian render halaman
    function queueRenderPage(num) {
        if (pageRendering) {
            pageNumPending = num;
        } else {
            renderPage(num);
        }
    }
    // Ke halaman sebelumnya 
    function onPrevPage() {
        if (pageNum <= 1) return;
        pageNum--;
        queueRenderPage(pageNum);
    }
    // ke halaman berikutnya
    function onNextPage() {
        if (pageNum >= pdfDoc.numPages) return;
        pageNum++;
        queueRenderPage(pageNum);
    }
    
    // Load the PDF
    pdfjsLib.getDocument(pdfUrl).promise.then(function(pdfDoc_) {
        pdfDoc = pdfDoc_;
        
        // Update container - CONTROLS DIBAWAH SETELAH CANVAS
        pdfContainer.innerHTML = `
            <div class="pdfjs-viewer" id="pdfjsViewer${capitalizeFirst(section)}"></div>
            <div class="pdfjs-controls">
                <button class="btn btn-sm btn-outline-primary" onclick="onPrevPage${capitalizeFirst(section)}()">
                    <!-- <i class="fas fa-chevron-left"></i> Sebelumnya -->
                    <i class="fas fa-chevron-left"></i> Sebelum
                </button>
                <span class="pdfjs-page-info" id="pdfjsPageInfo${capitalizeFirst(section)}">
                    Hal: 1 dari ${pdfDoc.numPages}
                </span>
                <button class="btn btn-sm btn-outline-primary" onclick="onNextPage${capitalizeFirst(section)}()">
                    Berikut <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        `;
        // Render first page
        renderPage(1);
        // Store functions globally for button access
        window[`onPrevPage${capitalizeFirst(section)}`] = onPrevPage;
        window[`onNextPage${capitalizeFirst(section)}`] = onNextPage;
    }).catch(function(error) {
        console.error('Error loading PDF with PDF.js:', error);
        // Fallback ke iframe
        fallbackToIframe(section, pdfUrl);
    });
}

/***************************************
* Fallback ke Iframe Jika PDF.js Gagal *
****************************************/
function fallbackToIframe(section, pdfUrl) {
    const pdfContainer = document.getElementById(`pdfContainer${capitalizeFirst(section)}`);
    pdfContainer.innerHTML = `
        <iframe 
            src="${pdfUrl}#toolbar=0&navpanes=0&scrollbar=1&view=FitH" 
            width="100%" 
            height="500" 
            style="border: none;"
            <!-- onerror="handlePDFError('${section}')"-->
        >
        </iframe>
    `;
}

/***********************
* Buka PDF di Tab Baru *
************************/
function openPDFInNewTab(section) {
    if (currentPDFData.url) {
        window.open(currentPDFData.url, '_blank');
    }
}

/*******************
* Tutup PDF Viewer *
********************/
function closePDF(section) {
    console.log('Closing PDF for section:', section);
    const pdfViewer = document.getElementById(`pdfViewer${capitalizeFirst(section)}`);
    const pdfContainer = document.getElementById(`pdfContainer${capitalizeFirst(section)}`);
    if (!pdfViewer || !pdfContainer) return;
    // Clear PDF content
    pdfContainer.innerHTML = '';
    pdfViewer.style.display = 'none';
    currentPDFData = {};
}

/*************************
* Tutup Semua PDF Viewer *
**************************/
function closeAllPDFs() {
    console.log('Closing all PDFs');
    const pdfViewers = document.querySelectorAll('.pdf-viewer');
    pdfViewers.forEach(viewer => {
        const section = viewer.id.replace('pdfViewer', '');
        if (section) {
            closePDF(section.toLowerCase());
        }
    });
    
    // Untuk panduan kembalikan pdf viewer ke posisi semula
    const panduanPDFViewer = document.getElementById('pdfViewerPanduan');
    const panduanContent = document.getElementById('panduanContent');
    if (panduanPDFViewer && panduanContent) {
        const menuContent = panduanContent.querySelector('.menu-content');
        if (menuContent) {
            // Tempatkan sebelum "Selesai Panduan"
            const selesaiLink = menuContent.querySelector('a[href="#"]:last-child');
            if (selesaiLink) {
                menuContent.insertBefore(panduanPDFViewer, selesaiLink);
            } else {
                menuContent.appendChild(panduanPDFViewer);
            }
        }
    }
    
    // Untuk submenu lainnya, kembalikan ke submenu content masing-masing
    const submenuSections = ['mealplan1', 'workout1', 'water1', 'istirahat1', 'datatracking1'];
    submenuSections.forEach(section => {
        const pdfViewer = document.getElementById(`pdfViewer${capitalizeFirst(section)}`);
        const submenuContent = document.getElementById(`${section}Content1`);
        if (pdfViewer && submenuContent) {
            submenuContent.appendChild(pdfViewer);
        }
    });
}

// ********************************
// ***** FUNGSI SUMNEU DAN UI *****
/**********************************

/********************
* Tampilkan Submenu *
*********************/
function showSubmenu(targetId) {
  console.log('ðŸ” Menampilkan submenu:', targetId);
  
  // Sembunyikan semua submenu content dan video player
  document.querySelectorAll('.submenu-content').forEach(content => {
    content.style.display = 'none';
    // KEMBALIKAN KE POSISI SEMULA (di dalam menu accordion)
    const menuAccordion = document.getElementById('menuAccordion');
    if (menuAccordion) {
      menuAccordion.parentNode.insertBefore(content, menuAccordion.nextSibling);
    }
  });
  
  document.querySelectorAll('.video-container').forEach(video => {
    video.style.display = 'none';
  });
  
  // Tampilkan submenu yang dipilih
  const targetContent = document.getElementById(targetId);
  if (targetContent) {
    // TEMUKAN TRIGGER ELEMENT YANG DITEKAN
    const triggerElement = document.querySelector(`[data-target="${targetId}"]`);
    
    if (triggerElement) {
      console.log('âœ… Trigger ditemukan:', triggerElement);
      
      // TEMUKAN PARENT MENU CONTENT (di dalam accordion)
      const parentMenuContent = triggerElement.closest('.menu-content');
      
      if (parentMenuContent) {
        console.log('âœ… Menu content parent ditemukan');
        
        // Tempatkan content TEPAT SETELAH TRIGGER ELEMENT di dalam menu content
        parentMenuContent.insertBefore(targetContent, triggerElement.nextSibling);
        
        // Tampilkan content
        targetContent.style.display = 'block';
        
        console.log('âœ… Submenu ditempatkan di posisi yang benar');
        
      } else {
        console.warn('âš ï¸ Menu content parent tidak ditemukan');
        
        // Fallback: tempatkan setelah trigger element
        triggerElement.parentNode.insertBefore(targetContent, triggerElement.nextSibling);
        targetContent.style.display = 'block';
      }
    } else {
      console.error('âŒ Trigger element tidak ditemukan untuk:', targetId);
      targetContent.style.display = 'block';
    }
    
    // Scroll ke konten yang ditampilkan
    setTimeout(() => { 
      targetContent.scrollIntoView({ behavior: 'smooth', block: 'start' }); 
      console.log('ðŸ“œ Scroll ke submenu');
    }, 100);
  } else {
    console.error('âŒ Target content tidak ditemukan:', targetId);
  }
}

/**********************
* Sembunyikan Submenu *
***********************/
function hideSubmenu(targetId) {
  console.log('ðŸ” Menyembunyikan submenu:', targetId);
  
  const targetContent = document.getElementById(targetId);
  if (targetContent) {
    // Sembunyikan content
    targetContent.style.display = 'none';
    
    // KEMBALIKAN KE POSISI SEMULA (setelah menu accordion)
    const menuAccordion = document.getElementById('menuAccordion');
    if (menuAccordion && menuAccordion.parentNode) {
      menuAccordion.parentNode.insertBefore(targetContent, menuAccordion.nextSibling);
      console.log('âœ… Submenu dikembalikan ke posisi semula');
    }
    
    // Scroll kembali ke menu yang aktif
    const activeMenu = document.querySelector('.menu-header:not(.collapsed)');
    if (activeMenu) {
      setTimeout(() => {
        activeMenu.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 100);
    }
  }
}

// *****************************
// ***** UTILITY FUNCTIONS *****
// *****************************

/************************************************************
* Memberikan tombol centang Centang Selain Video Perkenalan *
*************************************************************/
function setupMateriCompletion() {
    console.log('ðŸ”§ Setting up materi completion...');
    
    document.querySelectorAll('.video-container').forEach(container => {
        const containerId = container.id;
        
        if (containerId.includes('Pertemuan')) {
            console.log('âœ… Found video container for materi:', containerId);
            
            // Extract hariKe dari container ID
            const hariKe = containerId.replace('videoContainerPertemuan', '');
            
            if (!container.querySelector('.complete-btn')) {
                const completeBtn = document.createElement('button');
                completeBtn.innerHTML = '<i class="fas fa-check"></i>';
                completeBtn.className = 'btn btn-success btn-sm complete-btn';
                completeBtn.style.cssText = `
                    position: absolute; top: 10px; left: 10px; z-index: 25;
                    width: 35px; height: 35px; border-radius: 50%; padding: 0;
                    border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);
                `;
                
                completeBtn.onclick = function(e) {
                    e.stopPropagation();
                    console.log('ðŸŽ¯ Tombol centang diklik untuk hari:', hariKe);
                    simpanMateri(parseInt(hariKe));
                };
                
                const videoWrapper = container.querySelector('.video-wrapper');
                if (videoWrapper) {
                    videoWrapper.style.position = 'relative';
                    videoWrapper.appendChild(completeBtn);
                    console.log('âœ… Tombol centang ditambahkan ke:', containerId);
                }
            }
            
            // âœ… CEK STATUS SUDAH COMPLETE ATAU BELUM
            const status = localStorage.getItem(`materi_hari_${hariKe}`);
            if (status === 'completed') {
                const existingBtn = container.querySelector('.complete-btn');
                if (existingBtn) {
                    existingBtn.innerHTML = '<i class="fas fa-check-double"></i>';
                    existingBtn.classList.remove('btn-success');
                    existingBtn.classList.add('btn-secondary');
                    existingBtn.disabled = true;
                }
            }
        }
    });
}

/*********************************************************************
* Cari link "Selesai Perkenalan" dengan selector yang lebih spesifik *
*********************************************************************/
function setupPerkenalanCompletion() {
  const selesaiPerkenalanLinks = document.querySelectorAll('.menu-item');
  selesaiPerkenalanLinks.forEach(link => {
    if (link.textContent.includes('Selesai Perkenalan')) {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        selesaiPerkenalan();
      });
    }
  });
}

// **********************************
// ***** FUNGSI PESAN UNIVERSAL *****
// **********************************

/**************************************************************************
 * Fungsi universal untuk menampilkan pesan
 * @param {string} type - Tipe pesan: 'success', 'error', 'warning', 'info'
 * @param {string} message - Pesan yang akan ditampilkan
 * @param {number} duration - Durasi tampil (ms), 0 = tidak auto-hide
 * @param {string} menuTarget - Target menu (otomatis detect jika null)
 **************************************************************************/
function showMessage(type, message, duration = 3000, menuTarget = null) {
    // Auto-detect menu target jika tidak diberikan
    if (!menuTarget) {
        const activeMenu = document.querySelector('.menu-header:not(.collapsed)');
        if (activeMenu && activeMenu.hasAttribute('data-hari')) {
            const hariKe = activeMenu.getAttribute('data-hari');
            menuTarget = `pertemuan${hariKe}`;
        }
    }
    // Konfigurasi tipe pesan
    const typeConfig = {
        success: { cssClass: 'notification-success', icon: 'fas fa-check-circle' },
        error: { cssClass: 'notification-error', icon: 'fas fa-times-circle' },
        warning: { cssClass: 'notification-warning', icon: 'fas fa-exclamation-circle' },
        info: { cssClass: 'notification-info', icon: 'fas fa-info-circle' }
    };

    const config = typeConfig[type] || typeConfig.info;
    // Buat element pesan
    const messageElement = document.createElement('div');
    messageElement.className = `notification-message w-100 mb-2 ${config.cssClass}`;
    // Jika toast, tambahkan class khusus
    if (menuTarget === 'toast') {
        messageElement.classList.add('toast-message');
        menuTarget = null; // Reset untuk toast
    }

    messageElement.innerHTML = `
        <i class="pesan-notif-icon me-2 ${config.icon}"></i>
        <span class="flex-grow-1">${message}</span>
        <button type="button" class="btn-close btn-close-white ms-2" onclick="this.parentElement.remove()"></button>
    `;

    // Tentukan target container
    let targetContainer = document.body;
    if (menuTarget) {
        const menuElement = document.getElementById(menuTarget + 'Content');
        if (menuElement) {
            const menuContent = menuElement.querySelector('.menu-content');
            if (menuContent) {
                targetContainer = menuContent;
            }
        }
    } else {
        // Untuk pesan general, cari container yang aktif
        const activeMenu = document.querySelector('.menu-header:not(.collapsed)');
        if (activeMenu && activeMenu.hasAttribute('data-hari')) {
            const hariKe = activeMenu.getAttribute('data-hari');
            const menuElement = document.getElementById(`pertemuan${hariKe}Content`);
            if (menuElement) {
                const menuContent = menuElement.querySelector('.menu-content');
                if (menuContent) {
                    targetContainer = menuContent;
                }
            }
        }
    }

    // Tambahkan pesan ke container
    targetContainer.insertBefore(messageElement, targetContainer.firstChild);
    messageElement.style.display = 'flex';

    // Auto-hide jika duration > 0
    if (duration > 0) {
        setTimeout(() => {
            if (messageElement.parentElement) {
                messageElement.remove();
            }
        }, duration);
    }
    return messageElement;
}

// ******************************************
// ***** FUNGSI LAINNYA YANG DIPERLUKAN *****
// ******************************************

/********************************************
* Selesaikan perkenalan unlock Hari Pertama *
********************************************/
async function selesaiPerkenalan() {
    console.log('âœ… Menyelesaikan perkenalan');
    
    const userId = localStorage.getItem('userId');
    const namaUser = localStorage.getItem('namaUser') || userId;
    
    if (!userId) {
        showMessage('error', 'Silahkan login terlebih dahulu', 3000, 'perkenalan');
        return;
    }
    
    // 1. SIMPAN KE SERVER
    try {
        const response = await fetch(URL_PROGRAM_APP, {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: new URLSearchParams({
                action: 'updatePerkenalan',
                userId: userId,
                namaUser: namaUser
            })
        });

        const result = await response.text();
        console.log('ðŸ“¥ Response updatePerkenalan:', result);
        
        if (result.includes("OK")) {
            // 2. UPDATE PROGRESS DATA
            let progressData = {success: true, perkenalan: true, materiHari1: false, mealplanHari1: false};
            const existingProgress = localStorage.getItem('progressData');
            if (existingProgress) {
                progressData = JSON.parse(existingProgress);
                progressData.perkenalan = true;
            }
            localStorage.setItem('progressData', JSON.stringify(progressData));
            localStorage.setItem('perkenalanSelesai', 'true');
            
            // 3. UPDATE UI
            updatePerkenalanUI();
            
            // 4. UNLOCK MODUL HARI 1
            unlockModul(1);
            
            // 5. TAMPILKAN PESAN
            showMessage('success', 'Perkenalan selesai! Modul Hari Pertama sekarang dapat diakses.', 3000, 'perkenalan');
            
            // 6. CLOSE VIDEO
            closeVideo('perkenalan');
            
            // 7. AUTO-EXPAND MODUL HARI 1
            setTimeout(() => {
                const header = document.querySelector('[data-hari="1"]');
                if (header && header.classList.contains('collapsed')) {
                    header.click();
                }
            }, 1000);
            
        } else {
            showMessage('error', 'Gagal menyimpan: ' + result, 3000, 'perkenalan');
        }
    } catch (error) {
        console.error('âŒ Error:', error);
        showMessage('error', 'Gagal terhubung: ' + error.message, 3000, 'perkenalan');
    }
}

/************************
* Cek Status Perkenalan *
*************************/
function checkPerkenalanStatus() {
  const userId = localStorage.getItem('userId');
  if (!userId) return;

  const perkenalanSelesai = localStorage.getItem('perkenalanSelesai');
  
  if (!perkenalanSelesai) {
    // Lock Modul Hari Pertama
    const modulPertamaHeader = document.querySelector('[data-hari="1"]');
    if (modulPertamaHeader) {
      modulPertamaHeader.classList.add('disabled');
      modulPertamaHeader.style.pointerEvents = 'none';
      modulPertamaHeader.style.opacity = '0.6';
      
      const lockIcon = modulPertamaHeader.querySelector('.status-lock');
      if (lockIcon) {
        lockIcon.className = 'status-lock';
        lockIcon.innerHTML = '<i class="fas fa-lock"></i>';
      }
    }
  }
}

/*******************************************************
* Unlock modul berikutnya secara otomatis              * 
* @param {number} hariSelesai - Hari yang baru selesai *
********************************************************/
function selesaiMateri(hariSelesai) {
    console.log('âœ… Menyelesaikan materi hari:', hariSelesai);
    showMessage('success', `Materi hari ${hariSelesai} selesai!`, 3000, `pertemuan${hariSelesai}`);
    
    // Unlock modul berikutnya (jika masih dalam range 1-10)
    const nextHari = hariSelesai + 1;
    if (nextHari <= 10) {
        unlockModul(nextHari);
    }
}

/************************************
* Simpan materi untuk hari tertentu *
************************************/
async function simpanMateri(hariKe) {
    const userId   = localStorage.getItem('userId');
    const namaUser = localStorage.getItem('namaUser');
    
    if (!userId) {
        showMessage('error', 'Silahkan login terlebih dahulu', 3000, `pertemuan${hariKe}`);
        return;
    }
    
    console.log('ðŸ”§ simpanMateri called:', { userId, namaUser, hariKe });
    
    try {
        const response = await fetch(URL_PROGRAM_APP, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                action: 'updateMateri',
                userId: userId,
                namaUser: namaUser, // âœ… PASTIKAN INI TERKIRIM
                hariKe: hariKe
            })
        });

        const result = await response.text();
        console.log('ðŸ“¥ Response:', result);
        
        if (result === "OK") {
            showMessage('success', `Materi Hari ${hariKe} berhasil disimpan!`, 3000, `pertemuan${hariKe}`);
            updateMateriCompletionUI(hariKe);
            saveMateriStatus(hariKe, 'completed');
        } else {
            showMessage('error', 'Gagal: ' + result, 3000, `pertemuan${hariKe}`);
        }
    } catch (error) {
        console.error('âŒ Fetch error:', error);
        showMessage('error', 'Gagal terhubung : ' + error.message, 3000, `pertemuan${hariKe}`);
    }
}

/***************************************
* Simpan status materi di localStorage *
****************************************/
function saveMateriStatus(hariKe, status) {
    localStorage.setItem(`materi_hari_${hariKe}`, status);
    localStorage.setItem(`materi_completed_${hariKe}`, new Date().toISOString());
}

/****************************************
* Update UI materi dengan tanda centang *
*****************************************/
function updateMateriCompletionUI(hariKe) {
    // Update link materi di menu
    const materiLink = document.getElementById(`materiLink${hariKe}`);
    if (materiLink) {
        // Tambahkan tanda centang tanpa mengubah teks utama
        const currentText = materiLink.innerHTML;
        if (!currentText.includes('âœ“')) {
            //materiLink.innerHTML = currentText + ' <span class="badge bg-success ms-2">âœ“</span>';
            materiLink.innerHTML = currentText + ' <span class="ms-2">âœ“</span>';
            materiLink.style.color = '#666666';
            materiLink.style.fontWeight = 'bold';
        }
    }
    
    // Juga update tombol centang di video player (jika ada)
    const completeBtn = document.querySelector(`#videoContainerPertemuan${hariKe} .complete-btn`);
    if (completeBtn) {
        completeBtn.innerHTML = '<i class="fas fa-check-double"></i>';
        completeBtn.classList.remove('btn-success');
        completeBtn.classList.add('btn-secondary');
        completeBtn.disabled = true;
    }
}

/************************
/***** FUNGSI BANTU *****
/************************/

/********************************
* Convert file to base64 string *
*********************************/
function fileToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => {
            const base64 = reader.result.split(',')[1];
            resolve(base64);
        };
        reader.onerror = error => reject(error);
    });
}

/**************************
* Mengambil Nilai hari ke *
***************************/
function getHariKeFromSection(section) {
  const map = {
    'Pertemuan1': 1, 'Pertemuan2': 2, 'Pertemuan3': 3,
    'Pertemuan4': 4, 'Pertemuan5': 5, 'Pertemuan6': 6,
    'Pertemuan7': 7, 'Pertemuan8': 8, 'Pertemuan9': 9,
    'Pertemuan10': 10
  };
  return map[section] || 1;
}

/**********************************
* Konvers Huruf Besar Awal String *
***********************************/
function capitalizeFirst(string) {
  return string.charAt(0).toUpperCase() + string.slice(1);
}

// *********************************************
// ***** FUNGSI - FUNGSI UTK TAMPILAN FORM  ****
// *********************************************

/**********************************
* Mengupdate Status Materi Unlock *
***********************************/
function updateMateriStatusUI(hariKe) {
  const header = document.querySelector(`[data-hari="${hariKe}"]`);
  if (header) {
    const lockIcon = header.querySelector('.status-lock');
    if (lockIcon) {
      lockIcon.className = 'status-unlock';
      lockIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
    }
  }
}

/************************
* Daftar Olahraga Kardio
*************************/   

/** TIDAK AKTIF ***
const kardioExercises = document.getElementById("olahragaKardio-list");
if (kardioExercises) {
  const wrapper = document.createElement("div");
  wrapper.className = "mb-1";
  wrapper.innerHTML = `
    <div class="form-group mb-2"> 
      <select class="form-select" id="olahragaKardio" style="max-width: 100%;" required>
        <option value="">Pilihan...</option>
        <option value="Lari">Lari</option>
        <option value="Sepeda">Sepeda</option>
        <option value="Renang">Renang</option>
        <option value="Aerobic">Aerobic</option>
        <option value="Zumba">Zumba</option>
        <option value="Jalan Cepat">Jalan Cepat</option>
      </select>
    </div> 

    <div class="form-label mt-2 mb-2">Kegiatan Olahraga :</div>
    <div class="input-group mb-2">
      <input class="form-control" type="text" id="kegiatanKardio" placeholder="Upload" style="max-width: 100%;" readonly>
        <button type="button" class="btn btn-outline-secondary btn-sm" id="btnUploadKardio" data-bs-toggle="tooltip" title="upload"><i class="fa fa-cloud-upload"></i></button>
        <!-- <button type="button" class="btn btn-primary btn-sm disabled" id="btnSimpanKardio" data-bs-toggle="tooltip" title="simpan"><i class="fa fa-pencil-square-o"></i></button> -->
      </input>
    </div>
    
    <div class="form-label mt-1 mb-0">Durasi Olahraga :</div>
    <div class="input-group mt-0 mb-2">
      <button type="button" class="btn btn-primary btn-sm" id="btnStartOlahraga" data-bs-toggle="tooltip" title="Waktu Mulai">Start</button>
        <input class="form-control" type="time" id="startOlahraga" style="max-width: 100%;" disabled>  
      <button type="button" class="btn btn-primary btn-sm  disabled" id="btnSimpanStartOlahraga" data-bs-toggle="tooltip" title="simpan"><i class="fa fa-pencil-square-o"></i></button>
    </div>

    <div class="input-group mt-0 mb-2">
      <button type="button" class="btn btn-danger btn-sm" id="btnStopOlahraga" data-bs-toggle="tooltip" title="Waktu Berhenti">Stop</button>
        <input class="form-control" type="time" id="stoptOlahraga" style="max-width: 100%;" disabled>  
      <button type="button" class="btn btn-primary btn-sm  disabled" id="btnSimpanStopOlahraga" data-bs-toggle="tooltip" title="simpan"><i class="fa fa-pencil-square-o"></i></button>
    </div>
`;
  kardioExercises.appendChild(wrapper);
} 
**************/
 

/*********************************************
* Daftar Olahraga Resisten - DROPDOWN VERSION
*********************************************/   
const resistanceExercises = ["Squat", "Lunge", "Push Up", "Sit Up", "Plank", "Pilates", "Yoga"];
const listEl = document.getElementById("olahragaResisten-list");

if (listEl) {
  const wrapper = document.createElement("div");
  wrapper.className = "mb-3";
  wrapper.innerHTML = `  
    <div class="mb-3">
      <select class="form-select" id="resistanceDropdown" style="max-width: 100%;">
        <option value="">Pilihan...</option>
        ${resistanceExercises.map(exercise => 
          `<option value="${exercise}">${exercise}</option>`
        ).join('')}
      </select>
    </div>
    
    <div id="selectedResistanceContainer">
      <!-- Selected exercises will appear here -->
    </div>
  `;
  
  listEl.appendChild(wrapper);
  
  // Event listener untuk dropdown
  const dropdown = document.getElementById('resistanceDropdown');
  dropdown.addEventListener('change', function() {
    const selectedValue = this.value;
    if (selectedValue) {
      addResistanceExercise(selectedValue);
      this.value = ''; // Reset dropdown
    }
  });
}

/************************************
* Fungsi Tambah Olahraga Resistance
*************************************/
function addResistanceExercise(exerciseName) {
  const container = document.getElementById('selectedResistanceContainer');
  const exerciseId = exerciseName.toLowerCase().replace(/\s+/g, '-');
  
  // Cek apakah exercise sudah dipilih
  if (document.getElementById(`resistance-${exerciseId}`)) {
    showMessage('warning', 'Olahraga ini sudah terpilih', 5000, 'inline', 'resistance-message');
    return;
  }
  
  const exerciseElement = document.createElement("div");
  exerciseElement.id = `resistance-${exerciseId}`;
  exerciseElement.className = "resistance-exercise-item card mb-3";
  exerciseElement.innerHTML = `  
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h6 class="card-title mb-0 text-primary">${exerciseName}</h6>
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-primary btn-sm" 
                  onclick="simpanResistanceData('${exerciseId}')"
                  data-bs-toggle="tooltip" title="Simpan">
            <i class="fa fa-pencil-square-o"></i>
          </button>
          <button type="button" class="btn btn-danger btn-sm" 
                  onclick="removeResistanceExercise('${exerciseId}')"
                  data-bs-toggle="tooltip" title="Hapus"> 
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
      
      <div class="row g-2">
        <div class="col-12 col-md-4">
          <div class="input-group input-group-sm">	
            <span class="input-group-text"><i class="fas fa-user-cog"></i></span>
            <input type="number" min="0" id="jmlSet-${exerciseId}" class="form-control" 
                   placeholder="Jumlah set" data-exercise="${exerciseId}" data-type="set">
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="input-group input-group-sm">
            <span class="input-group-text"><i class="fas fa-user-plus"></i></span>
            <input type="number" min="0" id="jmlRepetisi-${exerciseId}" class="form-control" 
                   placeholder="Jumlah Repetisi" data-exercise="${exerciseId}" data-type="repetisi">
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="input-group input-group-sm">
            <span class="input-group-text"><i class="fas fa-user-clock"></i></span>
            <input type="number" min="0" id="jmlDurasi-${exerciseId}" class="form-control" 
                   placeholder="Durasi (Menit)" data-exercise="${exerciseId}" data-type="durasi">
          </div>
        </div>
      </div>
    </div>
  `;
  
  container.appendChild(exerciseElement);
  
  // Auto-save ketika input berubah
  const inputs = exerciseElement.querySelectorAll('input[type="number"]');
  inputs.forEach(input => {
    input.addEventListener('change', function() {
      const exerciseId = this.getAttribute('data-exercise');
      simpanResistanceData(exerciseId);
    });
  });
}

/*********************************
* Fungsi Hapus Olahraga Resistance
**********************************/
function removeResistanceExercise(exerciseId) {
  const exerciseElement = document.getElementById(`resistance-${exerciseId}`);
  if (exerciseElement) {
    exerciseElement.remove();
    showMessage('warning', 'Batalkan pilihan...', 5000, 'inline', 'resistance-message');
    localStorage.removeItem(`resistance-${exerciseId}`);
  }
}

/******************************
* Fungsi Simpan Data Resistance
*******************************/
function simpanResistanceData(exerciseId) {
  const setValue = document.getElementById(`jmlSet-${exerciseId}`)?.value;
  const repetisiValue = document.getElementById(`jmlRepetisi-${exerciseId}`)?.value;
  const durasiValue = document.getElementById(`jmlDurasi-${exerciseId}`)?.value;
  
  // Validasi: minimal satu field harus diisi
  if (!setValue && !repetisiValue && !durasiValue) {
    showMessage('warning', 'Isi minimal satu field data', 5000, 'inline', 'resistance-message');
    return;
  }
  
  const exerciseData = {
    name: document.querySelector(`#resistance-${exerciseId} .card-title`).textContent,
    set: setValue,
    repetisi: repetisiValue,
    durasi: durasiValue,
    timestamp: new Date().toISOString()
  };
  
  localStorage.setItem(`resistance-${exerciseId}`, JSON.stringify(exerciseData));
  showMessage('success', 'Data resistance berhasil disimpan', 2000, 'inline', 'resistance-message');
}

/*********************************************
* Fungsi Load Data Resistance yang Tersimpan *
**********************************************/
function loadSavedResistanceData() {
  const resistanceExercises = ["squat", "lunge", "push-up", "sit-up", "plank", "pilates", "yoga"];
  
  resistanceExercises.forEach(exercise => {
    const savedData = localStorage.getItem(`resistance-${exercise}`);
    if (savedData) {
      addResistanceExercise(exercise.replace(/-/g, ' '));
      
      // Set values setelah element dibuat
      setTimeout(() => {
        const data = JSON.parse(savedData);
        const setInput = document.getElementById(`jmlSet-${exercise}`);
        const repetisiInput = document.getElementById(`jmlRepetisi-${exercise}`);
        const durasiInput = document.getElementById(`jmlDurasi-${exercise}`);
        
        if (setInput && data.set) setInput.value = data.set;
        if (repetisiInput && data.repetisi) repetisiInput.value = data.repetisi;
        if (durasiInput && data.durasi) durasiInput.value = data.durasi;
      }, 100);
    }
  });
}

/***************************
* Minum Air Putih per hari *
****************************/   
const minumAirPutih = document.getElementById("airputihRadioBtn");
if (minumAirPutih) {
  const wrapper = document.createElement("div");
  wrapper.className = "mb-1"; /* "input-group mb-1 align-items-start"; */
  wrapper.innerHTML = `
    <div class="input-group mb-3">
      <div class="input-group-text">
        <input type="radio">
      </div>
      <input type="text" class="form-control" id="kurang1LtrAir" placeholder="Kurang dari 1 ltr air putih" readonly>
    </div>  
    
    <div class="input-group mb-3">
      <div class="input-group-text">
        <input type="radio">
      </div>
      <input type="text" class="form-control" id="pas1LtrAir" placeholder="1 ltr air putih" readonly>
    </div>  
    
    <div class="input-group mb-3">
      <div class="input-group-text">
        <input type="radio">
      </div>
      <input type="text" class="form-control" id="pas2LtrAir" placeholder="2 ltr air putih" readonly>
    </div>  
    
    <div class="input-group mb-3">
      <div class="input-group-text">
        <input type="radio"> 
      </div>
      <input type="text" class="form-control" id="lebih2LtrAir" placeholder="Lebih dari 2 ltr air putih" readonly>
    </div>

    <div>
      <button type="button" class="btn btn-primary btn-sm" id="btnSimpanMinumAir" data-bs-toggle="tooltip" title="Simpan Minum"><i class="fa fa-pencil-square-o"></i> Simpan</button>
      <button type="button" class="btn btn-secondary btn-sm" id="btnSelesaiMinumAir" data-bs-toggle="tooltip" title="Selesai Minum"><i class="fa fa-check"></i> Selesai</button>
    </div>  
`;
  minumAirPutih.appendChild(wrapper);
}    

/************************
* Jadwal Waktu Istrihat *
*************************/   
const radioIstirahat = document.getElementById("istirahatBtn");
if (radioIstirahat) {
  const wrapper = document.createElement("div");
  wrapper.className = "mb-1"; /* "input-group mb-1 align-items-start"; */
  wrapper.innerHTML = `  
    <h6><b>WAKTU ISTIRAHAT</b></h6>
    <b>Mulai Istirahat Jam</b>
    <div class="input-group mb-3">
      <button type="button" class="btn btn-outline-primary btn-sm" id="btnStartIstirahat" data-bs-toggle="tooltip" title="Mulai Istirahat">
        <i class="far fa-clock mt-2 mb-2"></i>  
      </button>
      <input class="form-control" type="time" id="mulaiIstirahat" style="max-width: 100%;" disabled>  
    </div>

    <b>Berapa Jam Istirahat</b></h6>
    <div class="input-group mb-3">
      <div class="input-group-text">
        <input type="radio">
      </div>
      <input type="text" class="form-control" id="tidurKurang6Jam" placeholder="Kurang dari 6jam per malam" readonly>
    </div>  
    
    <div class="input-group mb-3">
      <div class="input-group-text">
        <input type="radio">
      </div>
      <input type="text" class="form-control" id="tidurAntara6_8Jam" placeholder="6jam-8jam per malam" readonly>
    </div>  
    
    <div class="input-group mb-3">
      <div class="input-group-text">
        <input type="radio">
      </div>
      <input type="text" class="form-control" id="tidurLebih8Jam" placeholder="Lebih 8jam per malam" readonly>
    </div>  
    <div class="container p-0">
      <button type="button" class="btn btn-primary btn-sm" id="btnSimpanIstirahat" data-bs-toggle="tooltip" title="Simpan Istirahat"><i class="fa fa-pencil-square-o"></i> Simpan</button>
      <button type="button" class="btn btn-secondary btn-sm" id="btnSelesaiIstirahat" data-bs-toggle="tooltip" title="Selesai Istirahat"><i class="fa fa-check"></i> Selesai</button>
    </div>
  `;
    radioIstirahat.appendChild(wrapper);
} 

/***************************
* Input Data Kondisi Tubuh *
****************************/   
const inputKondisiTubuh = document.getElementById("kondisiTubuh");
if (inputKondisiTubuh) {
  const wrapper = document.createElement("div");
  wrapper.className = "mb-1"; /* "input-group mb-1 align-items-start"; */
  wrapper.innerHTML = `  
    <!-- Pilih Jenis Kelamin -->
    <div class="input-group mt-3 mb-3">  
      <div class="input-group-text">
        <i class="fas fa-venus-mars"></i> 
      </div>
      <select class="form-select" id="jenisKelamin1" required>
        <option value="">Pilihan Jenis Kelamin...</option>
        <option value="Pria">Pria</option>
        <option value="Wanita">Wanita</option>
      </select>
    </div> 

    <!-- Input Data Umur -->
    <div class="input-group mb-3">
      <div class="input-group-text">
        <i class="far fa-calendar-alt" style="padding-left: 3px; padding-right:4px;"></i>
      </div>
      <div class="input-group-text">
        <label>Input Tgl Lahir</label>
      </div>
      <input type="date" class="form-control" id="tglLahir">
    </div>  
                  
    <!-- Input Berat Badan -->
    <div class="input-group mb-3">
      <div class="input-group-text">
        <i class="fas fa-weight" style="padding-left: 2px; padding-right:3px;"></i>
      </div>
      <input type="number" class="form-control" id="beratBadan" placeholder="Input Berat badan (kg)">
    </div>  

    <!-- Input Tinggi Badan -->
    <div class="input-group mb-3">
      <div class="input-group-text">
        <i class="fas fa-ruler-vertical" style="padding-left: 5px; padding-right: 6px;"></i>
      </div>
      <input type="number" class="form-control" id="tinggiBadan" placeholder="Input Tinggi badan (cm)">
    </div>  
                  
    <!-- Input Lingkar Pinggang -->
    <div class="input-group mb-3">
      <div class="input-group-text">
        <i class="fas fa-ribbon" style="padding-left: 3px; padding-right: 4px;"></i>
      </div>
      <input type="number" class="form-control" id="lngkarPinggang" placeholder="Input Lingkar Pinggang (cm)">
    </div>

    <!-- Input Aktivitas Olahraga -->
    <div class="input-group mt-3 mb-3">
      <div class="input-group-text">
        <i class="fas fa-dumbbell"></i> 
      </div>
      <select class="form-select" id="aktivitasOlahraga" style="max-width: 100%;" required>
        <option value="">Pilihan Aktivitas Olahraga...</option>
        <option value="Sedikit/Tidak Olahraga">Sedikit/Tidak Olahraga</option>
        <option value="Olahraga ringan 1-3 hari/minggu">Olahraga ringan 1-3 hari/minggu</option>
        <option value="Olahraga moderat 3-5 hari/minggu">Olahraga moderat 3-5 hari/minggu</option>
        <option value="Olahraga berat 6-7 hari per minggu">Olahraga berat 6-7 hari/minggu</option>
        <option value="Olahraga sangat aktif + Kegiatan fisik">Olahraga aktif + Kegiatan fisik</option>           
      </select>
    </div>

    <div>
      <button type="button" class="btn btn-primary btn-sm" id="btnSimpanDataTubuh" data-bs-toggle="tooltip" title="Simpan Data Fisik"><i class="fa fa-pencil-square-o"></i> Simpan</button>
      <button type="button" class="btn btn-secondary btn-sm" id="btnSelesaiDataTubuh" data-bs-toggle="tooltip" title="Selesai Input Data"><i class="fa fa-check"></i> Selesai</button>
    </div>
  `;
  inputKondisiTubuh.appendChild(wrapper);
}   

// *******************************************
// **** FUNGSI UPLOAD MEAL PLAN FLEKSIBEL ****
// *******************************************

/***********************************************
* Upload meal plan untuk hari tertentu di form * 
************************************************/
function uploadMealPlan(hariKe) {
    console.log('ðŸ½ï¸ Upload meal plan hari:', hariKe);
    
    // Tampilkan form upload langsung
    showMealPlanUploadForm(hariKe);
}

/************************
* Tampilkan upload file *
*************************/
function showMealPlanUploadForm(hariKe) {
    // Sembunyikan semua submenu lainnya
    document.querySelectorAll('.submenu-content').forEach(content => {
        content.style.display = 'none';
    });
    
    // Tampilkan meal plan content
    const mealPlanContent = document.getElementById(`mealPlanContent${hariKe}`);
    if (mealPlanContent) {
        mealPlanContent.style.display = 'block';
        // Scroll ke form
        setTimeout(() => { mealPlanContent.scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 100);
        // showMessage('info', `Upload meal plan hari ${hariKe}`, 3000, `pertemuan${hariKe}`);
    } else {
        showMessage('error', 'Form meal plan tidak ditemukan', 3000, `pertemuan${hariKe}`);
    }
}

/******************************************
* Process upload untuk meal type tertentu *
*******************************************/
async function uploadMealItem(hariKe, mealType) {
    console.log(`ðŸ“¸ Upload ${mealType} hari ${hariKe}`);
    
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = 'image/*';
    fileInput.capture = 'environment';

    fileInput.onchange = async function(e) {
        const file = e.target.files[0];
        if (!file) return;

        // Validasi file
        if (file.size > 5 * 1024 * 1024) {
            showMessage('error', 'File terlalu besar (maks 5MB)', 3000, `pertemuan${hariKe}`);
            return;
        }

        if (!file.type.startsWith('image/')) {
            showMessage('error', 'File harus berupa gambar', 3000, `pertemuan${hariKe}`);
            return;
        }
        try {
            // âœ… PASTIKAN PANGGIL fileToBase64() DI SINI
            const base64Data = await fileToBase64(file);
            // Upload ke server
            const result = await uploadToServer(hariKe, mealType, base64Data, file.name);
            if (result.success) {
                showMessage('success', `${getMealTypeName(mealType)} berhasil diupload!`, 3000, `pertemuan${hariKe}`);
                // Update input field
                updateMealInputField(mealType, file.name, hariKe);
            } else {
                showMessage('error', `Upload ${getMealTypeName(mealType)} gagal: ${result.message}`, 3000, `pertemuan${hariKe}`);
            }
            
        } catch (error) {
            console.error('Upload error:', error);
            showMessage('error', `Gagal upload ${getMealTypeName(mealType)}: ${error.message}`, 3000, `pertemuan${hariKe}`);
        }
    };
    fileInput.click();
}

/************************
* Upload file ke server *
*************************/
async function uploadToServer(hariKe, mealType, fileData, fileName) {
    const userId   = localStorage.getItem('userId');
    const namaUser = localStorage.getItem('namaUser');
    if (!userId) {
        throw new Error('Silakan login terlebih dahulu');
    }
    try {
        const response = await fetch(URL_PROGRAM_APP, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded',},
            body: new URLSearchParams({
                action: 'uploadMealPlan',
                userId: userId,
                namaUser: namaUser,
                hariKe: hariKe,
                mealType: mealType,
                file: fileData,
                fileName: fileName
            })
        });

        const result = await response.text();
        console.log('Upload response:', result);
        // Handle response
        try {
            return JSON.parse(result);
        } catch (e) {
            if (result === "OK") {
                return { success: true, message: 'Upload berhasil' };
            } else {
                return { success: false, message: result };
            }
        }
    } catch (error) {
        console.error('Server error:', error);
        return { success: false, message: 'Gagal terhubung ke server' };
    }
}

/*********************************************
* Update input field setelah upload berhasil *
**********************************************/
function updateMealInputField(mealType, fileName, hariKe) {
    // Gunakan ID yang konsisten dengan form
    const inputId = `${mealType}${hariKe}`;
    const inputField = document.getElementById(inputId);
    
    if (inputField) {
        inputField.value = `âœ“ ${fileName}`;
        inputField.style.color = '#666666';
        // inputField.style.fontWeight = 'bold';
        
        // Simpan status di localStorage
        localStorage.setItem(`meal_${hariKe}_${mealType}`, 'uploaded');
    } else {
        console.error('Input field tidak ditemukan:', inputId);
    }
}

/****************************************
* Get nama meal type yang user-friendly *
*****************************************/
function getMealTypeName(mealType) {
    const mealNames = {
        'sarapan': 'Sarapan',
        'cemilanPagi': 'Cemilan Pagi', 
        'makanSiang': 'Makan Siang',
        'cemilanSore': 'Cemilan Sore',
        'makanMalam': 'Makan Malam'
    };
    return mealNames[mealType] || mealType;
}

/************************************************************
* Selesaikan meal plan untuk hari tertentu dan update sheet *
*************************************************************/
async function selesaiMealPlan(hariKe) {
    console.log('âœ… Menyelesaikan meal plan hari:', hariKe);
    const userId   = localStorage.getItem('userId');
    //const namaUser = localStorage.getItem('namaUser');
    if (!userId) {
        showMessage('error', 'Silakan login terlebih dahulu', 3000, `pertemuan${hariKe}`);
        return;
    }

    // Cek apakah semua meal sudah diupload
    const allUploaded = checkAllMealsUploaded(hariKe);
    if (allUploaded) {
        showMessage('info', 'Menyimpan status meal plan...', 3000, `pertemuan${hariKe}`);
        try {
            // Gunakan action yang sesuai dengan Google Apps Script
            const response = await fetch(URL_PROGRAM_APP, {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded',},
                body: new URLSearchParams({
                    action: 'updateMealPlan', // âœ… ACTION YANG SESUAI
                    userId: userId,
                    hariKe: hariKe,
                    status: 'OK' // âœ… KIRIM STATUS 'OK' UNTUK KOLOM Q
                })
            });

            const result = await response.text();
            console.log('Update meal plan status response:', result);

            if (result === "OK" || result.includes("success")) {
                showMessage('success', `Meal plan hari ${hariKe} selesai!`, 3000, `pertemuan${hariKe}`);
                // Simpan status
                saveMealPlanStatus(hariKe, 'completed');
                // Update UI - tombol jadi hijau
                updateMealPlanCompletionUI(hariKe);
                // Tutup submenu
                setTimeout(() => {
                    hideSubmenu(`mealPlanContent${hariKe}`);
                }, 2000);
            } else {
                showMessage('error', 'Gagal update status: ' + result, 3000, `pertemuan${hariKe}`);
            }
        } catch (error) {
            console.error('Update status error:', error);
            showMessage('error', 'Gagal update status: ' + error.message, 3000, `pertemuan${hariKe}`);
        }
    } else {
        showMessage('warning', 'Lengkapi semua meal terlebih dahulu!', 3000, `pertemuan${hariKe}`);
    }
}

/***********************************************************
* Cek apakah semua meal sudah diupload untuk hari tertentu *
************************************************************/
function checkAllMealsUploaded(hariKe) {
    const mealTypes = ['sarapan', 'cemilanPagi', 'makanSiang', 'cemilanSore', 'makanMalam'];
    const allUploaded = mealTypes.every(mealType => {
        const inputField = document.getElementById(`${mealType}${hariKe}`);
        return inputField && inputField.value.startsWith('âœ“');
    });
    if (!allUploaded) {
        const missingMeals = mealTypes.filter(mealType => {
            const inputField = document.getElementById(`${mealType}${hariKe}`);
            return !inputField || !inputField.value.startsWith('âœ“');
        });
        console.log('Meal yang belum diupload:', missingMeals);
        // showMessage('warning', `Masih ada yang belum diupload: ${missingMeals.map(m => getMealTypeName(m)).join(', ')}`, 3000, `pertemuan${hariKe}`);
    }
    return allUploaded;
}

/**************************
* Simpan status meal plan *
***************************/
function saveMealPlanStatus(hariKe, status) {
    localStorage.setItem(`mealplan_hari_${hariKe}`, status);
    localStorage.setItem(`mealplan_completed_${hariKe}`, new Date().toISOString());
}

/**************************************
* Update UI setelah meal plan selesai *
***************************************/
function updateMealPlanCompletionUI(hariKe) {
    // Update tombol di menu utama
    const mealPlanItem = document.querySelector(`[onclick="uploadMealPlan(${hariKe})"]`);
    if (mealPlanItem) {
        mealPlanItem.innerHTML = `<i class="fas fa-utensils"></i>${hariKe}.2 Meal Plan - Hari ke ${hariKe} âœ“ `;
        mealPlanItem.style.color = '#666666';    // Tulisan Abu-abu 
        mealPlanItem.style.fontWeight = 'bold';  // Tulisan jadi tebal
    }
    
    // âœ… UPDATE TOMBOL SELESAI JADI HIJAU
    const selesaiBtn = document.getElementById(`btnSelesaiMealPlan${hariKe}`);
    if (selesaiBtn) {
        selesaiBtn.innerHTML = `<i class="fas fa-check-double"></i> Selesai Meal Plan Hari ${hariKe}`;
        selesaiBtn.classList.remove('btn-secondary');
        selesaiBtn.classList.add('btn-success');
        selesaiBtn.disabled = true;
    }
}

/*********************************
* Cek status meal plan saat load *
**********************************/
function checkMealPlanStatus(hariKe) {
    const status = localStorage.getItem(`mealplan_hari_${hariKe}`);
    if (status === 'completed') {
        updateMealPlanCompletionUI(hariKe);
    }
}

/*******************************************
* Generate form meal plan untuk semua hari *
********************************************/
function generateMealPlanForms() {
    for (let hariKe = 1; hariKe <= 10; hariKe++) {
        const containerId = `jadwalMealplan-list${hariKe > 1 ? hariKe : ''}`;
        const container = document.getElementById(containerId);
        
        if (container) {
            container.innerHTML = createMealPlanFormHTML(hariKe);
        }
    }
}

/**********************************************
* Load progress meal plan yang sudah diupload *
***********************************************/
function loadMealPlanProgress(hariKe) {
    const mealTypes = ['sarapan', 'cemilanPagi', 'makanSiang', 'cemilanSore', 'makanMalam'];
    
    mealTypes.forEach(mealType => {
        const status = localStorage.getItem(`meal_${hariKe}_${mealType}`);
        if (status === 'uploaded') {
            const fileName = localStorage.getItem(`meal_${hariKe}_${mealType}_file`) || 'File terupload';
            updateMealInputField(mealType, fileName, hariKe);
        }
    });
}

/***********************************
* Create HTML untuk form meal plan *
************************************/
function createMealPlanFormHTML(hariKe) {
    return `
        <div><label class="form-label">Sarapan (07:00 - 09:00)</label></div>
        <div class="input-group mt-0 mb-2">
            <input class="form-control" type="text" id="sarapan${hariKe}" placeholder="Upload Sarapan" readonly>
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="uploadMealItem(${hariKe}, 'sarapan')">
                <i class="fa fa-cloud-upload"></i>
            </button>
        </div>

        <div><label class="form-label">Cemilan Pagi (10:00 - 10:30)</label></div>
        <div class="input-group mt-0 mb-2">
            <input class="form-control" type="text" id="cemilanPagi${hariKe}" placeholder="Upload Cemilan Pagi" readonly>
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="uploadMealItem(${hariKe}, 'cemilanPagi')">
                <i class="fa fa-cloud-upload"></i>
            </button>
        </div>

        <div><label class="form-label">Makan Siang (12:00 - 14:00)</label></div>
        <div class="input-group mt-0 mb-2">
            <input class="form-control" type="text" id="makanSiang${hariKe}" placeholder="Upload Makan Siang" readonly>
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="uploadMealItem(${hariKe}, 'makanSiang')">
                <i class="fa fa-cloud-upload"></i>
            </button>
        </div>

        <div><label class="form-label">Cemilan Sore (16:00 - 16:30)</label></div>
        <div class="input-group mt-0 mb-2">
            <input class="form-control" type="text" id="cemilanSore${hariKe}" placeholder="Upload Cemilan Sore" readonly>
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="uploadMealItem(${hariKe}, 'cemilanSore')">
                <i class="fa fa-cloud-upload"></i>
            </button>
        </div>

        <div><label class="form-label">Makan Malam (18:00 - 20:00)</label></div>
        <div class="input-group mt-0 mb-2">
            <input class="form-control" type="text" id="makanMalam${hariKe}" placeholder="Upload Makan Malam" readonly>
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="uploadMealItem(${hariKe}, 'makanMalam')">
                <i class="fa fa-cloud-upload"></i>
            </button>
        </div>

        <!-- âœ… TAMBAHKAN TOMBOL SELESAI -->
        <div class="text-center mt-4">
            <button type="button" class="btn btn-secondary btn-sm" onclick="selesaiMealPlan(${hariKe})" id="btnSelesaiMealPlan${hariKe}">
                <i class="fa fa-check"></i> Selesai Meal Plan Hari ${hariKe}
            </button>
        </div>
    `;
}

// *********************************************
// ***** FUNGSI WORKOUT COMPLETE FLEKSIBEL *****
// *********************************************

/***************************************
* Selesaikan workout untuk hari tertentu *
****************************************/
async function selesaiWorkout(hariKe) {
    console.log('ðŸ‹ï¸â€â™‚ï¸ Selesaikan workout hari:', hariKe);
    
    // Tampilkan form workout langsung
    showWorkoutForm(hariKe);
}

/*************************
* Tampilkan form workout *
**************************/
function showWorkoutForm(hariKe) {
    // Sembunyikan semua submenu lainnya
    document.querySelectorAll('.submenu-content').forEach(content => {
        content.style.display = 'none';
    });
    
    // Tampilkan workout content
    const workoutContent = document.getElementById(`workoutContent${hariKe}`);
    if (workoutContent) {
        workoutContent.style.display = 'block';
        // Scroll ke form
        setTimeout(() => { 
            workoutContent.scrollIntoView({ behavior: 'smooth', block: 'start' }); 
        }, 100);
        
        // Load saved workout data
        loadSavedWorkoutData(hariKe);
    } else {
        showMessage('error', 'Form workout tidak ditemukan', 3000, `pertemuan${hariKe}`);
    }
}

/*******************************
* Upload file kardio olahraga *
********************************/
async function uploadKardioFile(hariKe) {
    console.log(`ðŸ“¸ Upload kardio file hari ${hariKe}`);
    
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = 'image/*';
    fileInput.capture = 'environment';

    fileInput.onchange = async function(e) {
        const file = e.target.files[0];
        if (!file) return;

        // Validasi file
        if (file.size > 5 * 1024 * 1024) {
            showMessage('error', 'File terlalu besar (maks 5MB)', 3000, `pertemuan${hariKe}`);
            return;
        }

        if (!file.type.startsWith('image/')) {
            showMessage('error', 'File harus berupa gambar', 3000, `pertemuan${hariKe}`);
            return;
        }
        
        try {
            // Konversi ke base64
            const base64Data = await fileToBase64(file);
            
            // Simpan di localStorage untuk sementara
            localStorage.setItem(`workout_kardio_file_${hariKe}`, base64Data);
            localStorage.setItem(`workout_kardio_filename_${hariKe}`, file.name);
            
            // Update input field
            const inputField = document.getElementById(`kegiatanKardio${hariKe}`);
            if (inputField) {
                inputField.value = `âœ“ ${file.name}`;
                inputField.style.color = '#666666';
            }
            
            showMessage('success', 'File kardio berhasil diupload!', 3000, `pertemuan${hariKe}`);
            
        } catch (error) {
            console.error('Upload error:', error);
            showMessage('error', `Gagal upload file: ${error.message}`, 3000, `pertemuan${hariKe}`);
        }
    };
    fileInput.click();
}

/*********************************
* Set waktu mulai olahraga kardio *
**********************************/
function setStartTimeKardio(hariKe) {
    const now = new Date();
    const timeString = now.toTimeString().split(' ')[0].substring(0, 5); // Format HH:mm
    
    const inputField = document.getElementById(`startOlahraga${hariKe}`);
    if (inputField) {
        inputField.value = timeString;
        
        // Simpan di localStorage
        localStorage.setItem(`workout_start_time_${hariKe}`, timeString);
        
        showMessage('info', `Waktu mulai: ${timeString}`, 2000, `pertemuan${hariKe}`);
    }
}

/**********************************
* Set waktu selesai olahraga kardio *
***********************************/
function setStopTimeKardio(hariKe) {
    const now = new Date();
    const timeString = now.toTimeString().split(' ')[0].substring(0, 5); // Format HH:mm
    
    const inputField = document.getElementById(`stopOlahraga${hariKe}`);
    if (inputField) {
        inputField.value = timeString;
        
        // Simpan di localStorage
        localStorage.setItem(`workout_stop_time_${hariKe}`, timeString);
        
        showMessage('info', `Waktu selesai: ${timeString}`, 2000, `pertemuan${hariKe}`);
    }
}

/******************************************
* Simpan data workout ke server *
*******************************************/
/******************************************
* Simpan data workout ke server - UPDATED *
*******************************************/
async function simpanWorkoutData(hariKe) {
    const userId = localStorage.getItem('userId');
    const namaUser = localStorage.getItem('namaUser');
    
    if (!userId) {
        showMessage('error', 'Silakan login terlebih dahulu', 3000, `pertemuan${hariKe}`);
        return;
    }
    
    // Collect kardio data
    const kardioType = document.getElementById(`olahragaKardio${hariKe}`)?.value || '';
    const startTime = document.getElementById(`startOlahraga${hariKe}`)?.value || '';
    const stopTime = document.getElementById(`stopOlahraga${hariKe}`)?.value || '';
    
    if (!kardioType) {
        showMessage('warning', 'Pilih jenis olahraga kardio terlebih dahulu', 3000, `pertemuan${hariKe}`);
        return;
    }
    
    // Collect resistance data
    const resistanceData = getResistanceDataForServer(hariKe);
    
    const workoutData = {
        kardioType: kardioType,
        startTime: startTime,
        stopTime: stopTime,
        resistenExercises: resistanceData.resistenExercises,
        totalSets: resistanceData.totalSets,
        totalReps: resistanceData.totalReps,
        totalMinutes: resistanceData.totalMinutes
    };
    
    console.log('ðŸ“¤ Sending workout data for day', hariKe, ':', workoutData);
    
    // Get kardio file data
    const kardioFile = localStorage.getItem(`workout_kardio_file_${hariKe}`);
    const kardioFilename = localStorage.getItem(`workout_kardio_filename_${hariKe}`);
    
    try {
        showMessage('info', 'Menyimpan data workout...', 3000, `pertemuan${hariKe}`);
        
        const response = await fetch(URL_PROGRAM_APP, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({
                action: 'updateWorkout',
                userId: userId,
                namaUser: namaUser,
                hariKe: hariKe,
                workoutData: JSON.stringify(workoutData),
                kardioFile: kardioFile || '',
                kardioFilename: kardioFilename || ''
            })
        });

        const result = await response.text();
        console.log('ðŸ“¥ Workout update response:', result);
        
        if (result === "OK" || result.includes("success")) {
            showMessage('success', 'Data workout berhasil disimpan!', 3000, `pertemuan${hariKe}`);
            
            // Simpan kardio type ke localStorage
            localStorage.setItem(`workout_kardio_type_${hariKe}`, kardioType);
            localStorage.setItem(`workout_start_time_${hariKe}`, startTime);
            localStorage.setItem(`workout_stop_time_${hariKe}`, stopTime);
            localStorage.setItem(`workout_saved_${hariKe}`, 'true');
            
            // Save workout status
            saveWorkoutStatus(hariKe, 'saved');
            
        } else {
            showMessage('error', 'Gagal menyimpan data workout: ' + result, 3000, `pertemuan${hariKe}`);
        }
    } catch (error) {
        console.error('âŒ Workout save error:', error);
        showMessage('error', 'Gagal terhubung: ' + error.message, 3000, `pertemuan${hariKe}`);
    }
}

/***************************************
* Tandai workout sebagai selesai *
****************************************/
async function completeWorkoutFinal(hariKe) {
    const userId = localStorage.getItem('userId');
    const namaUser = localStorage.getItem('namaUser');
    
    if (!userId) {
        showMessage('error', 'Silakan login terlebih dahulu', 3000, `pertemuan${hariKe}`);
        return;
    }
    
    // Pastikan data sudah disimpan
    const workoutSaved = localStorage.getItem(`workout_saved_${hariKe}`);
    if (!workoutSaved) {
        showMessage('warning', 'Simpan data workout terlebih dahulu!', 3000, `pertemuan${hariKe}`);
        return;
    }
    
    try {
        showMessage('info', 'Menandai workout sebagai selesai...', 3000, `pertemuan${hariKe}`);
        
        const response = await fetch(URL_PROGRAM_APP, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({
                action: 'completeWorkout',
                userId: userId,
                namaUser: namaUser,
                hariKe: hariKe
            })
        });

        const result = await response.text();
        console.log('ðŸ“¥ Workout complete response:', result);
        
        if (result === "OK" || result.includes("success")) {
            showMessage('success', `Workout hari ${hariKe} selesai!`, 3000, `pertemuan${hariKe}`);
            
            // Update UI
            updateWorkoutCompletionUI(hariKe);
            
            // Simpan status
            saveWorkoutStatus(hariKe, 'completed');
            
            // Tutup submenu
            setTimeout(() => {
                hideSubmenu(`workoutContent${hariKe}`);
            }, 2000);
            
        } else {
            showMessage('error', 'Gagal menandai workout selesai: ' + result, 3000, `pertemuan${hariKe}`);
        }
    } catch (error) {
        console.error('âŒ Workout complete error:', error);
        showMessage('error', 'Gagal terhubung: ' + error.message, 3000, `pertemuan${hariKe}`);
    }
}

/******************************
* Simpan status workout *
*******************************/
function saveWorkoutStatus(hariKe, status) {
    localStorage.setItem(`workout_status_${hariKe}`, status);
    if (status === 'saved') {
        localStorage.setItem(`workout_saved_${hariKe}`, 'true');
    } else if (status === 'completed') {
        localStorage.setItem(`workout_completed_${hariKe}`, new Date().toISOString());
    }
}

/************************************
* Update UI setelah workout selesai *
*************************************/
function updateWorkoutCompletionUI(hariKe) {
    // Update tombol di menu utama
    const workoutItem = document.querySelector(`[onclick="selesaiWorkout(${hariKe})"]`);
    if (workoutItem) {
        workoutItem.innerHTML = `<i class="fas fa-dumbbell"></i>${hariKe}.3 Workout - Hari ke ${hariKe} âœ“ `;
        workoutItem.style.color = '#666666';
        workoutItem.style.fontWeight = 'bold';
    }
    
    // Update tombol selesai di form
    const selesaiBtn = document.getElementById(`btnSelesaiWorkout${hariKe}`);
    if (selesaiBtn) {
        selesaiBtn.innerHTML = `<i class="fas fa-check-double"></i> Workout Selesai`;
        selesaiBtn.classList.remove('btn-secondary');
        selesaiBtn.classList.add('btn-success');
        selesaiBtn.disabled = true;
    }
}

/*********************************
* Load saved workout data *
**********************************/
function loadSavedWorkoutData(hariKe) {
    console.log(`ðŸ“‚ Loading saved workout data for day ${hariKe}`);
    
    // Load kardio type
    const kardioType = localStorage.getItem(`workout_kardio_type_${hariKe}`);
    const kardioSelect = document.getElementById(`olahragaKardio${hariKe}`);
    if (kardioType && kardioSelect) {
        kardioSelect.value = kardioType;
    }
    
    // Load kardio filename
    const kardioFilename = localStorage.getItem(`workout_kardio_filename_${hariKe}`);
    const kardioInput = document.getElementById(`kegiatanKardio${hariKe}`);
    if (kardioFilename && kardioInput) {
        kardioInput.value = `âœ“ ${kardioFilename}`;
    }
    
    // Load start time
    const startTime = localStorage.getItem(`workout_start_time_${hariKe}`);
    const startInput = document.getElementById(`startOlahraga${hariKe}`);
    if (startTime && startInput) {
        startInput.value = startTime;
    }
    
    // Load stop time
    const stopTime = localStorage.getItem(`workout_stop_time_${hariKe}`);
    const stopInput = document.getElementById(`stopOlahraga${hariKe}`);
    if (stopTime && stopInput) {
        stopInput.value = stopTime;
    }
    
    // Setup resistance exercises untuk hari ini
    setupResistanceExercises(hariKe);
    
    // Check if already completed
    const status = localStorage.getItem(`workout_status_${hariKe}`);
    if (status === 'completed') {
        updateWorkoutCompletionUI(hariKe);
    }
}

/*****************************************
* Fungsi khusus untuk hari tertentu *
******************************************/
function setupWorkoutForDay(hariKe) {
    // Setup event listeners untuk hari tertentu
    const uploadBtn = document.getElementById(`btnUploadKardio${hariKe}`);
    const startBtn = document.getElementById(`btnStartOlahraga${hariKe}`);
    const stopBtn = document.getElementById(`btnStopOlahraga${hariKe}`);
    const simpanBtn = document.getElementById(`btnSimpanWorkout${hariKe}`);
    const selesaiBtn = document.getElementById(`btnSelesaiWorkout${hariKe}`);
    
    if (uploadBtn) {
        uploadBtn.onclick = () => uploadKardioFile(hariKe);
    }
    
    if (startBtn) {
        startBtn.onclick = () => setStartTimeKardio(hariKe);
    }
    
    if (stopBtn) {
        stopBtn.onclick = () => setStopTimeKardio(hariKe);
    }
    
    if (simpanBtn) {
        simpanBtn.onclick = () => simpanWorkoutData(hariKe);
    }
    
    if (selesaiBtn) {
        selesaiBtn.onclick = () => completeWorkoutFinal(hariKe);
    }
}

/******************************************
* Initialize workout untuk semua hari *
*******************************************/
function initializeAllWorkoutDays() {
    console.log('ðŸ‹ï¸â€â™‚ï¸ Initializing workout for all days...');
    
    for (let hariKe = 1; hariKe <= 10; hariKe++) {
        setupWorkoutForDay(hariKe);
    }
}

// Update generate workout form di bagian yang sesuai
function generateWorkoutForms() {
    for (let hariKe = 1; hariKe <= 10; hariKe++) {
        const containerId = `olahragaKardio-list${hariKe > 1 ? hariKe : ''}`;
        const container = document.getElementById(containerId);
        
        if (container) {
            container.innerHTML = createWorkoutFormHTML(hariKe);
        }
    }
}

function createWorkoutFormHTML(hariKe) {
    return `
        <div class="form-group mb-2"> 
            <select class="form-select" id="olahragaKardio${hariKe}" style="max-width: 100%;" required>
                <option value="">Pilihan Olahraga Kardio...</option>
                <option value="Lari">Lari</option>
                <option value="Sepeda">Sepeda</option>
                <option value="Renang">Renang</option>
                <option value="Aerobic">Aerobic</option>
                <option value="Zumba">Zumba</option>
                <option value="Jalan Cepat">Jalan Cepat</option>
            </select>
        </div> 

        <div class="form-label mt-2 mb-2">Kegiatan Olahraga :</div>
        <div class="input-group mb-2">
            <input class="form-control" type="text" id="kegiatanKardio${hariKe}" placeholder="Upload" style="max-width: 100%;" readonly>
            <button type="button" class="btn btn-outline-secondary btn-sm" id="btnUploadKardio${hariKe}" data-bs-toggle="tooltip" title="upload">
                <i class="fa fa-cloud-upload"></i>
            </button>
        </div>
        
        <div class="form-label mt-1 mb-0">Durasi Olahraga :</div>
        <div class="input-group mt-0 mb-2">
            <button type="button" class="btn btn-primary btn-sm" id="btnStartOlahraga${hariKe}" data-bs-toggle="tooltip" title="Waktu Mulai">
                Start
            </button>
            <input class="form-control" type="time" id="startOlahraga${hariKe}" style="max-width: 100%;">  
        </div>

        <div class="input-group mt-0 mb-2">
            <button type="button" class="btn btn-danger btn-sm" id="btnStopOlahraga${hariKe}" data-bs-toggle="tooltip" title="Waktu Berhenti">
                Stop
            </button>
            <input class="form-control" type="time" id="stopOlahraga${hariKe}" style="max-width: 100%;">  
        </div>
        
        <div class="mt-3">
            <button type="button" class="btn btn-primary btn-sm me-2" id="btnSimpanWorkout${hariKe}">
                <i class="fa fa-pencil-square-o"></i> Simpan Workout
            </button>
            <button type="button" class="btn btn-secondary btn-sm" id="btnSelesaiWorkout${hariKe}">
                <i class="fa fa-check"></i> Selesai Workout
            </button>
        </div>
    `;
}

/*********************************************
* Daftar Olahraga Resisten - MULTIPLE DAYS VERSION
*********************************************/   
function setupResistanceExercises(hariKe) {
    const containerId = `olahragaResisten-list${hariKe > 1 ? hariKe : ''}`;
    const container = document.getElementById(containerId);
    
    if (!container) return;
    
    const resistanceExercises = ["Squat", "Lunge", "Push Up", "Sit Up", "Plank", "Pilates", "Yoga"];
    
    const wrapper = document.createElement("div");
    wrapper.className = "mb-3";
    wrapper.innerHTML = `  
        <div class="mb-3">
            <select class="form-select" id="resistanceDropdown${hariKe}" style="max-width: 100%;">
                <option value="">Pilihan Olahraga Resistance...</option>
                ${resistanceExercises.map(exercise => 
                    `<option value="${exercise}">${exercise}</option>`
                ).join('')}
            </select>
        </div>
        
        <div id="selectedResistanceContainer${hariKe}">
            <!-- Selected exercises will appear here -->
        </div>
    `;
    
    container.innerHTML = '';
    container.appendChild(wrapper);
    
    // Event listener untuk dropdown
    const dropdown = document.getElementById(`resistanceDropdown${hariKe}`);
    dropdown.addEventListener('change', function() {
        const selectedValue = this.value;
        if (selectedValue) {
            addResistanceExercise(hariKe, selectedValue);
            this.value = ''; // Reset dropdown
        }
    });
    
    // Load saved data untuk hari ini
    loadSavedResistanceData(hariKe);
}

/************************************
* Fungsi Tambah Olahraga Resistance (per hari)
*************************************/
function addResistanceExercise(hariKe, exerciseName) {
    const containerId = `selectedResistanceContainer${hariKe}`;
    const container = document.getElementById(containerId);
    if (!container) return;
    
    const exerciseId = exerciseName.toLowerCase().replace(/\s+/g, '-');
    const fullExerciseId = `resistance-${hariKe}-${exerciseId}`;
    
    // Cek apakah exercise sudah dipilih
    if (document.getElementById(fullExerciseId)) {
        showMessage('warning', 'Olahraga ini sudah terpilih', 3000, `pertemuan${hariKe}`);
        return;
    }
    
    const exerciseElement = document.createElement("div");
    exerciseElement.id = fullExerciseId;
    exerciseElement.className = "resistance-exercise-item card mb-3";
    exerciseElement.innerHTML = `  
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="card-title mb-0 text-primary">${exerciseName}</h6>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-danger btn-sm" 
                            onclick="removeResistanceExercise(${hariKe}, '${exerciseId}')"
                            data-bs-toggle="tooltip" title="Hapus"> 
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            
            <div class="row g-2">
                <div class="col-12 col-md-4">
                    <div class="input-group input-group-sm">	
                        <span class="input-group-text"><i class="fas fa-user-cog"></i></span>
                        <input type="number" min="0" id="jmlSet-${hariKe}-${exerciseId}" class="form-control" 
                               placeholder="Jumlah set" data-exercise="${exerciseId}" data-hari="${hariKe}" data-type="set">
                    </div>
                </div>
                <div class="col-12 col-md-4">
                    <div class="input-group input-group-sm">
                        <span class="input-group-text"><i class="fas fa-user-plus"></i></span>
                        <input type="number" min="0" id="jmlRepetisi-${hariKe}-${exerciseId}" class="form-control" 
                               placeholder="Jumlah Repetisi" data-exercise="${exerciseId}" data-hari="${hariKe}" data-type="repetisi">
                    </div>
                </div>
                <div class="col-12 col-md-4">
                    <div class="input-group input-group-sm">
                        <span class="input-group-text"><i class="fas fa-user-clock"></i></span>
                        <input type="number" min="0" id="jmlDurasi-${hariKe}-${exerciseId}" class="form-control" 
                               placeholder="Durasi (Menit)" data-exercise="${exerciseId}" data-hari="${hariKe}" data-type="durasi">
                    </div>
                </div>
            </div>
        </div>
    `;
    
    container.appendChild(exerciseElement);
    
    // Auto-save ketika input berubah
    const inputs = exerciseElement.querySelectorAll('input[type="number"]');
    inputs.forEach(input => {
        input.addEventListener('change', function() {
            const exerciseId = this.getAttribute('data-exercise');
            const hariKe = this.getAttribute('data-hari');
            saveResistanceData(hariKe, exerciseId);
        });
    });
}

/*********************************
* Fungsi Hapus Olahraga Resistance (per hari)
**********************************/
function removeResistanceExercise(hariKe, exerciseId) {
    const fullExerciseId = `resistance-${hariKe}-${exerciseId}`;
    const exerciseElement = document.getElementById(fullExerciseId);
    if (exerciseElement) {
        exerciseElement.remove();
        showMessage('warning', 'Olahraga dihapus', 3000, `pertemuan${hariKe}`);
        
        // Hapus dari localStorage
        localStorage.removeItem(`resistance-${hariKe}-${exerciseId}`);
    }
}

/******************************
* Fungsi Simpan Data Resistance (per hari)
*******************************/
function saveResistanceData(hariKe, exerciseId) {
    const setValue = document.getElementById(`jmlSet-${hariKe}-${exerciseId}`)?.value;
    const repetisiValue = document.getElementById(`jmlRepetisi-${hariKe}-${exerciseId}`)?.value;
    const durasiValue = document.getElementById(`jmlDurasi-${hariKe}-${exerciseId}`)?.value;
    
    // Validasi: minimal satu field harus diisi
    if (!setValue && !repetisiValue && !durasiValue) {
        showMessage('warning', 'Isi minimal satu field data', 3000, `pertemuan${hariKe}`);
        return;
    }
    
    const exerciseElement = document.getElementById(`resistance-${hariKe}-${exerciseId}`);
    const exerciseName = exerciseElement?.querySelector('.card-title')?.textContent || exerciseId.replace(/-/g, ' ');
    
    const exerciseData = {
        name: exerciseName,
        set: setValue || 0,
        repetisi: repetisiValue || 0,
        durasi: durasiValue || 0,
        timestamp: new Date().toISOString()
    };
    
    localStorage.setItem(`resistance-${hariKe}-${exerciseId}`, JSON.stringify(exerciseData));
    console.log(`ðŸ’¾ Saved resistance data for day ${hariKe}, exercise ${exerciseId}:`, exerciseData);
}

/*********************************************
* Fungsi Load Data Resistance yang Tersimpan (per hari)
**********************************************/
function loadSavedResistanceData(hariKe) {
    // Get all resistance keys for this day
    const allKeys = Object.keys(localStorage);
    const resistanceKeys = allKeys.filter(key => key.startsWith(`resistance-${hariKe}-`));
    
    console.log(`ðŸ“‚ Loading saved resistance data for day ${hariKe}:`, resistanceKeys);
    
    resistanceKeys.forEach(key => {
        try {
            const savedData = JSON.parse(localStorage.getItem(key));
            if (savedData) {
                // Extract exerciseId from key
                const exerciseId = key.replace(`resistance-${hariKe}-`, '');
                const exerciseName = savedData.name || exerciseId.replace(/-/g, ' ');
                
                // Add exercise to UI
                setTimeout(() => {
                    addResistanceExercise(hariKe, exerciseName);
                    
                    // Set values after element is created
                    setTimeout(() => {
                        const setInput = document.getElementById(`jmlSet-${hariKe}-${exerciseId}`);
                        const repetisiInput = document.getElementById(`jmlRepetisi-${hariKe}-${exerciseId}`);
                        const durasiInput = document.getElementById(`jmlDurasi-${hariKe}-${exerciseId}`);
                        
                        if (setInput && savedData.set) setInput.value = savedData.set;
                        if (repetisiInput && savedData.repetisi) repetisiInput.value = savedData.repetisi;
                        if (durasiInput && savedData.durasi) durasiInput.value = savedData.durasi;
                    }, 200);
                }, 100);
            }
        } catch (error) {
            console.error('Error loading resistance data:', error);
        }
    });
}

/******************************************
* Get resistance data untuk dikirim ke server
*******************************************/
function getResistanceDataForServer(hariKe) {
    const allKeys = Object.keys(localStorage);
    const resistanceKeys = allKeys.filter(key => key.startsWith(`resistance-${hariKe}-`));
    
    const exercises = [];
    let totalSets = 0;
    let totalReps = 0;
    let totalMinutes = 0;
    
    resistanceKeys.forEach(key => {
        try {
            const savedData = JSON.parse(localStorage.getItem(key));
            if (savedData) {
                exercises.push(savedData.name);
                totalSets += parseInt(savedData.set) || 0;
                totalReps += parseInt(savedData.repetisi) || 0;
                totalMinutes += parseInt(savedData.durasi) || 0;
            }
        } catch (error) {
            console.error('Error getting resistance data:', error);
        }
    });
    
    return {
        resistenExercises: exercises.join(', '),
        totalSets: totalSets,
        totalReps: totalReps,
        totalMinutes: totalMinutes
    };
}

</script>
</body>
</html>