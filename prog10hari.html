<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Main Menu - FIT Challenge Program 10 Hari</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" >
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
body { background-color: #f8f9fa; }
/***** Judul di Navbar *****/
.brand-title { font-size: 12px; font:wide; color: #023581; line-height: 1; }
/***** Sub Judul di Navbar *****/
.brand-subtitle { font-size: 10px; color: #6c757d; line-height: 1; }

/***** Main Menu Navbar *****/
.main-menu-link { font-weight: 500; padding: 8px 12px !important; border-radius: 3px; }
.main-menu-link:hover, .main-menu-link.active { 
  color: #dc3545 !important; 
  /* background-color: #dadada; */
}

/****** Icon Medsos ******/
.social-icon { 
  display: inline-flex; 
  justify-content: center; 
  align-items: center; 
  width: 40px; 
  height: 40px; 
  border-radius: 50%; 
}
.social-icon i { color: #555; transition: color 0.3s ease-in-out; }
.social-icon:hover { background-color: #dadada; }
.social-icon:hover i { color: #dc3545; }

/***** Header Image *****/
.header-image img {
    height: 100%;
    width: 100%;
    object-fit: cover;
    /*
    border-radius: 10px 10px 0 0;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
    */
}

/***** Menu Accordian ******/
.menu-accordion { margin-bottom: 10px; }
.menu-header {
  /* background: linear-gradient(135deg, #002266 0%, #0044cc 100%); */
  background: linear-gradient(135deg, #105fff 0%, #cfdaff 100%);
  color: white;
  border: none;
  padding: 15px 20px;
  text-align: left;
  width: 100%;
  /* border-radius: 8px; */
  font-weight: 500;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.3s ease;
}
.menu-header:hover {
  /* background: linear-gradient(135deg, #0044cc 0%, #002266 100%); */
  background: linear-gradient(135deg, #cfdaff 0%, #105fff 100%);
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
.menu-header .menu-icon { transition: transform 0.3s ease; }
.menu-header.collapsed .menu-icon { transform: rotate(0deg); }
.menu-header:not(.collapsed) .menu-icon { transform: rotate(180deg); }
.menu-content {
  background-color: white;
  /* border: 1px solid #dee2e6; */
  border-top: none;
  /* border-radius: 0 0 8px 8px; */
  padding: 0;
}
.menu-item {
  display: block;
  padding: 12px 20px;
  color: #333;      
  text-decoration: none;
  border-bottom: 1px solid #f8f9fa;
  transition: all 0.2s ease;
}
.menu-item:last-child { border-bottom: none; }
/* Warna Hover Item Text Menu */
.menu-item:hover {
  /* Warna Pointer Sub Menu */
  background-color: #e7e7e7;
  /* color: #002266; */
  color: #830000;        
  text-decoration: none;
}
/* Warna Icon Menu */
.menu-item i { width: 20px; margin-right: 10px; color: #000000; }
/* Status Icon Lock */
.status-lock { color: #002fff; margin-left: 10px; }
/* Status Icon Unlock */
.status-unlock { color: #ffffff; margin-left: 10px; }
/***** Akhir Menu Accordian *****/

/***** Playlist Container di Menu Accordion *****/
.menu-content .playlist-container {
    margin: 10px 0;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    overflow: hidden;
    max-height: 400px;
}

/***** Submenu Content Styles *****/
.submenu-content { border-radius: 8px; margin: 10px 0; display: none; }
.submenu-trigger { cursor: pointer; }
.submenu-trigger:hover { background-color: #e7e7e7; color: #830000; }
/***** akhir Sebmenu *****/ 

/***** Tombol Close di Header *****/
.btn-close-header {
  background: none;
  border: none;
  color: white;
  font-size: 18px;
  padding: 0;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.8;
  transition: all 0.3s ease;
  border-radius: 50%;
}
.btn-close-header:hover {
  opacity: 1;
  color: #dc3545 !important;
  background-color: rgba(255, 255, 255, 0.2);
}

/***** Footer *****/
.footer a:hover { color: #ff4d4d !important; }

/**** * About Overlay *****/
.about-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  display: none;
}
.about-form {
  width: 100%;
  max-width: 350px;
  padding: 20px;
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
  text-align: center;
}
/***** Akhir About *****/

/***** Video Player Styles *****/
.video-container {
    position: relative;
    width: 100%;
    /* max-width: 800px; */
    max-width: 780px;
    margin: 15px auto;
    display: none;
    background: #000;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    /* border: 3px solid #002266; */
    border: 3px solid #000000;
}
.video-wrapper {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
    height: 0;
}
.video-wrapper iframe,
.video-wrapper video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
.video-placeholder {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #002266 0%, #0044cc 100%);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
}
.video-placeholder:hover {
    background: linear-gradient(135deg, #0044cc 0%, #002266 100%);
    transform: scale(1.02);
}
.video-placeholder i { font-size: 48px; margin-bottom: 15px; opacity: 0.9; }
.video-placeholder-text { font-size: 16px; font-weight: 500; text-align: center; padding: 0 20px; }
/* Spinner di tengah video player */
.video-loading {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: none;
    justify-content: center;
    align-items: center;
    background: #000;
    z-index: 5;
}
.video-loading .spinner-border { width: 3rem; height: 3rem; color: #dc3545; }
.close-video {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.7);
    color: white;
    border: none;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 20;
    transition: all 0.3s ease;
    font-size: 14px;
}
.close-video:hover { background: rgba(220, 53, 69, 0.9); transform: scale(1.1); }
/***** Akhir Video Player Styles *****/

/***** Playlist Container Styles Video Youtube *****/
.playlist-container {
    display: none;
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 0 0 8px 8px;
    max-height: 400px !important;
    overflow-y: auto !important;
    scrollbar-width: thin;
    position: relative;
}

/***** Tombol Close di Playlist Header *****/
.playlist-header .btn-close-header {
    background: none;
    border: none;
    color: #666;
    font-size: 16px;
    padding: 4px;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.7;
    transition: all 0.3s ease;
    border-radius: 50%;
    cursor: pointer;
}
.playlist-header .btn-close-header:hover {
    opacity: 1;
    color: #dc3545 !important;
    background-color: rgba(220, 53, 69, 0.1);
    transform: scale(1.1);
}
.playlist-header.position-relative {
    position: relative !important;
}
/***** Pastikan tombol di posisi yang benar *****/
.playlist-header .position-absolute {
    position: absolute !important;
    top: 50% !important;
    right: 10px !important;
    transform: translateY(-50%) !important;
} 

/***** Playlist Video Items Container *****/
.playlist-container::-webkit-scrollbar { width: 8px !important; display: block !important; }
.playlist-container::-webkit-scrollbar-track { background: #f8f9fa !important; display: block !important;}
.playlist-container::-webkit-scrollbar-thumb { background: #ccc !important; border-radius: 4px !important; display: block !important;}
.playlist-container::-webkit-scrollbar-thumb:hover { background: #aaa !important;}
.playlist-item {
    display: flex;
    align-items: center;
    padding: 12px 15px;
    border-bottom: 1px solid #f8f9fa;
    transition: all 0.2s ease;
}
.playlist-item:hover { background-color: #f8f9fa;}
.playlist-item:last-child { border-bottom: none; }
.playlist-thumbnail {
    position: relative;
    width: 120px;
    height: 68px;
    margin-right: 12px;
    border-radius: 4px;
    overflow: hidden;
    background: #ddd;
    flex-shrink: 0;
}
.playlist-thumbnail img { width: 100%; height: 100%; object-fit: cover; }
.position-badge {
    position: absolute;
    bottom: 4px;
    right: 4px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 3px;
    font-weight: bold;
    min-width: 20px;
    text-align: center;
}
.playlist-info { flex: 1; min-width: 0; }
.playlist-title {
    font-weight: 500;
    margin-bottom: 4px;
    font-size: 14px;
    line-height: 1.3;
    display: -webkit-box;
    /* -webkit-line-clamp: 2; */
    line-clamp: 2;
    /*-webkit-box-orient: vertical;*/
    box-orient: vertical;
    overflow: hidden;
}
.playlist-meta {display: flex; gap: 12px; font-size: 12px; color: #666;}
.playlist-duration {color: #dc3545; font-weight: 500;}
.playlist-position {color: #6c757d; }
.playlist-loading {padding: 30px 20px; text-align: center; color: #666;}
.playlist-error { padding: 30px 20px; text-align: center; color: #dc3545;}
/***** Akhir Playlist Youtube *****/

/***** PDF Viewer Styles *****/
.pdf-viewer {
    display: none;
    position: relative;
    background: white;
    border: 1px solid #dee2e6;
    border-top: none;
}
.pdf-container { width: 100%; height: 500px; scrollbar-width: none; overflow-x: hidden; }
.pdf-container::-webkit-scrollbar { display: none; }                
.pdf-container iframe { width: 100%; height: 100%; border: none; overflow-x: hidden !important; }
.pdf-viewer::-webkit-scrollbar { width: 0px; display: none; }

.pdf-header {
    padding: 12px 15px;
    background: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    justify-content: between;
    align-items: center;
}
.pdf-title { font-weight: 600; color: #333; flex: 1; }
.pdf-actions { display: flex; gap: 10px; }
.pdf-loading {
    padding: 30px 20px;
    text-align: center;
    color: #666;
    height: 200px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
/*
.pdf-error {
    padding: 30px 20px;
    text-align: center;
    color: #dc3545;
    height: 200px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
*/

.close-pdf {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.7);
    color: white;
    border: none;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 25;
    transition: all 0.3s ease;
    font-size: 14px;
}
.close-pdf:hover { background: rgba(220, 53, 69, 0.9); transform: scale(1.1);}
/***** Akhir PDF Viewer Styles *****/

/***** PDF.js Viewer Styles *****/
.pdfjs-viewer { 
    width: 100%; 
    height: 500px; 
    border: 1px solid #ddd; 
    overflow: auto; 
    background: #f5f5f5;
}
.pdfjs-canvas { 
    display: block; 
    margin: 0 auto; 
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    max-width: 100%; /* TAMBAH INI - pastikan tidak melebihi container */
}
.pdfjs-controls {
    padding: 10px;
    background: white;
    border-bottom: 1px solid #ddd;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 10px;            /* PINDAH KE BAWAH - tambahkan margin-top dan border-top */
    border-top: 1px solid #ddd;
    border-bottom: none;
}
.pdfjs-page-info { font-size: 14px; color: #666;}
/***** Akhir PDF.js Viewer Styles *****/

/***** Tampilan Mobile ******/
@media (max-width: 591.98px) {
  .navbar-collapse .mx-auto {
      margin-left: 0 !important;
      margin-right: 0 !important;
      flex-direction: row; 
      margin-bottom: 1rem;
  }
  .navbar-nav:not(.mx-auto) .nav-item, .navbar-nav:not(.mx-auto) .main-menu-link { 
    width: 50%; 
   }
 
  /* PDF Viewer untuk Mobile */
  .pdf-container { 
      height: 400px;                 /* Sedikit lebih pendek untuk mobile */
      overflow-x: hidden !important; /* Pastikan no horizontal scroll */
      overflow-y: auto;              /* Biarkan vertical scroll */
  }
    .pdf-container iframe {
      overflow-x: hidden !important;
      -webkit-overflow-scrolling: touch; /* Smooth scroll untuk iOS */
  }
  
  /* Untuk PDF.js viewer di mobile */
  .pdfjs-viewer { 
      height: 350px; 
      overflow-x: hidden !important;
      overflow-y: auto;
  }
    .pdfjs-canvas {
      max-width: 100% !important;
      height: auto !important; /* Biarkan tinggi menyesuaikan */
  }
    .pdfjs-controls {
      padding: 8px 5px;
      font-size: 12px;
  }
    .pdfjs-controls .btn {
      font-size: 12px;
      padding: 4px 8px;
  }
}
/***** Akhir Tampilan Mobile *****/

</style>
</head>

<body>
<div class="container mt-5 mb-5">
  <div class="row justify-content-center">
    <div class="card mx-auto shadow p-0" style="max-width:789px">
      <!-- HEADER -->
      <header>
        <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #f1f1f1;">
          <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="#">
              <img src="images/logo-beratidealku.png" alt="Logo" width="199" height="38" class="me-2">
              <div class="d-md-block">
                <div class="brand-title">FIT Challenge</div>
                <div class="brand-subtitle">Program 10 Hari</div>
              </div>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mainNavbar">
              <ul class="navbar-nav mx-auto">
                <li class="nav-item"><a class="nav-link social-icon" href="https://facebook.com/beratidealku" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
                <li class="nav-item"><a class="nav-link social-icon" href="https://www.instagram.com/hestyamin" target="_blank"><i class="fab fa-instagram"></i></a></li>
                <li class="nav-item"><a class="nav-link social-icon" href="https://www.youtube.com" target="_blank"><i class="fab fa-youtube"></i></a></li>
              </ul>
              <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link main-menu-link" href="#about" onclick="showAbout()">About</a></li>
                <li class="nav-item" id="loginMenuItem">
                  <a class="nav-link main-menu-link" href="loginFC.html">
                    <i class="fas fa-sign-in-alt"></i> Login
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </nav>
      </header>
      
      <div class="card-body">
       <!-- Header Image -->
        <div class="header-image">
            <img src="images/Header-FITChallenge.jpg" alt="Header Image">
        </div>
        <div class="card-title text-white p-1 mb-0" style="text-shadow: #c6d8ff; text-align:center; background-color: #002266; border-bottom-style:solid; border-bottom-color:#830000; border-width:5px;">
          <h5>SELAMAT DATANG</h5>
          <h6 style="font-size: small;">Di kelas online <strong>FIT CHALLENGE PROGRAMME by BERATidealku</strong> merupakan tantangan</br>
          bagi anda yang ingin meningkatkan level kebugaran. Dengan mengikuti kelas ini selama <strong>10 Hari</strong></br>
          anda akan di bimbing secara terstruktur dengan kurikulum yang disusun sedemikian rupa </br>
          dengan panduan video tutorial yang lengkap serta didampingi seorang coach berpengalaman</h6>
        </div>
        
        <!------------------------------->
        <!-- MENU UTAMA FIT CHALLENGE  -->
        <!------------------------------->
        <div class="menu-accordion" id="menuAccordion">
          <!--------------------------->
          <!-- MENU PANDUAN APLIKASI -->
          <!---------------------------> 
          <div class="menu-accordion-item">
            <button class="menu-header collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panduanContent">
              <span>
                <i class="fas fa-angle-double-right me-2"></i>Panduan Penggunaan Aplikasi
              </span>
              <i class="fas fa-angle-down menu-icon"></i>
            </button>

            <!-- SUBMENU PANDUAN APLIKASI -->
            <div class="collapse" id="panduanContent" data-bs-parent="#menuAccordion">
              <div class="menu-content">
                <!-- Video Tutorial -->
                <a href="https://www.youtube.com/watch?v=Zg_badTE2Ec" 
                  class="menu-item video-link" data-section="panduan" data-type="youtube" data-url="https://www.youtube.com/watch?v=Zg_badTE2Ec">
                  <i class="fas fa-file-video"></i>Video Tutorial Panduan Penggunaan Aplikasi
                </a>

                 <!-- PDF Panduan Penggunaan Aplikasi -->
                <a href="pdf/Panduan_Penggunaan_Aplikasi.pdf" 
                  class="menu-item" id="pdfPanduanLink">
                  <i class="fas fa-file-pdf"></i>PDF Panduan Penggunaan Aplikasi
                </a>
                
                <!-- PDF Viewer untuk Panduan -->
                <div class="pdf-viewer" id="pdfViewerPanduan" style="display: none;">
                  <button class="close-pdf" onclick="closePDF('panduan')">
                    <i class="fas fa-times"></i>
                  </button>
                  <div class="pdf-container" id="pdfContainerPanduan">
                    <!-- PDF akan dimuat di sini -->
                  </div>
                </div>
               
                <!-- Video Player untuk Panduan -->
                <div class="video-container" id="videoContainerPanduan" style="display: none;">
                  <button class="close-video" onclick="closeVideo('panduan')">
                    <i class="fas fa-times"></i>
                  </button>
                  <div class="video-wrapper">
                    <div class="video-placeholder" onclick="playVideo('panduan')">
                      <i class="fas fa-play-circle"></i>
                      <div class="video-placeholder-text">Klik untuk memuat video</div>
                    </div>
                    <div class="video-loading" id="videoLoadingPanduan">
                      <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading video...</span>
                      </div>
                    </div>
                    <div id="videoPlayerPanduan"></div>
                  </div>
                </div>

                <!-- Selesai Panduan -->
                <a href="#" class="menu-item">
                  <i class="fas fa-check-double"></i>Selesai Panduan
                </a>

              </div>
            </div>
          </div>

          <!--------------------->
          <!-- MENU PERKENALAN --> 
          <!--------------------->
          <div class="menu-accordion-item">
            <button class="menu-header collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#perkenalanContent">
              <span>
                <i class="fas fa-angle-double-right me-2"></i>Perkenalan
                <i class="fas fa-lock status-lock"></i>
              </span>
              <i class="fas fa-angle-down menu-icon"></i>
            </button>

            <div class="collapse" id="perkenalanContent" data-bs-parent="#menuAccordion">
              <div class="menu-content">
                <!-- Canva Link - Buka di tab baru -->
                <a href="https://www.canva.com/design/DAGqjXWcl6o/ylVUgMbZ8it0TXN0dqCKzQ/view?utm_content=DAGqjXWcl6o&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=h1feb0aca2a" 
                  class="menu-item" target="_blank">
                  <i class="fas fa-video"></i>1. Perkenalan dengan Personal Diet Partner
                </a>
                
                <!-- YouTube Video -->
                <a href="https://www.youtube.com/watch?v=9DoHhx9jlGM" 
                  class="menu-item video-link" data-section="perkenalan" data-type="youtube" data-url="https://www.youtube.com/watch?v=9DoHhx9jlGM">
                  <i class="fas fa-video"></i>2. Alasan Mengapa Herbalife
                </a>

                <!-- Local Video -->
                <a href="video/Live Best Your Best Life ! - 360.mp4" 
                  class="menu-item video-link" data-section="perkenalan" data-type="local" data-url="video/Live Best Your Best Life ! - 360.mp4">
                  <i class="fas fa-video"></i>3. Live Best Your Best Life !
                </a>
                
                <!-- Video Player untuk Perkenalan -->
                <div class="video-container" id="videoContainerPerkenalan" style="display: none;">
                  <button class="close-video" onclick="closeVideo('perkenalan')">
                    <i class="fas fa-times"></i>
                  </button>
                  <div class="video-wrapper">
                    <div class="video-placeholder" onclick="playVideo('perkenalan')">
                      <i class="fas fa-play-circle"></i>
                      <div class="video-placeholder-text">Klik untuk memuat video</div>
                    </div>
                    <div class="video-loading" id="videoLoadingPerkenalan">
                      <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading video...</span>
                      </div>
                    </div>
                    <div id="videoPlayerPerkenalan"></div>
                  </div>
                </div>
                
                <a href="#" class="menu-item">
                  <i class="fas fa-times"></i>Selesai Perkenalan
                </a>      
              </div>
            </div>
          </div>
           
          <!----------------------------->
          <!-- MENU MODUL HARI PERTAMA -->
          <!-----------------------------> 
          <div class="menu-accordion-item">
            <button class="menu-header collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#pertemuan1Content" data-hari="1">
              <span>
                <i class="fas fa-angle-double-right me-2"></i>Modul Hari Pertama
                <i class="fas fa-lock status-lock"></i>
              </span>
              <i class="fas fa-angle-down menu-icon"></i>
            </button>

            <!-- SUBMENU MODUL HARI PERTAMA --> 
            <div class="collapse" id="pertemuan1Content" data-bs-parent="#menuAccordion">
              <div class="menu-content">
              
                <!-- VIDEO MATERI HARI PERTAMA -->
                <a href="https://www.youtube.com/watch?v=Zg_badTE2Ec" 
                  class="menu-item video-link"  style="max-width: 100%;" data-section="pertemuan1" data-type="youtube" data-url="https://www.youtube.com/watch?v=Zg_badTE2Ec"> 
                  <i class="fas fa-video"></i>1.1 Materi Hari Pertama - Dari Mana Saja Sumber Protein Bisa Didapatkan? 
                </a>
                
                <!-- Video Player untuk Materi Hari Pertama - DITEMPATKAN DI SINI -->
                <div class="video-container" id="videoContainerPertemuan1" style="display: none;">
                  <button class="close-video" onclick="closeVideo('pertemuan1')">
                    <i class="fas fa-times"></i>
                  </button>
                
                  <div class="video-wrapper">
                    <div class="video-placeholder" onclick="playVideo('pertemuan1')">
                      <i class="fas fa-play-circle"></i>
                      <div class="video-placeholder-text">Klik untuk memuat video</div>
                    </div>
                    <div class="video-loading" id="videoLoadingPertemuan1">
                      <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading video...</span>
                      </div>
                    </div>
                    <div id="videoPlayerPertemuan1"></div>
                  </div>
                </div>
               

                <!-- MEAL PLAN HARI PERTAMA -->
                <a href="pdf/MealPlan_HariKe1.pdf" 
                  class="menu-item submenu-trigger" data-target="mealPlanContent1">
                  <i class="fas fa-utensils"></i>1.2 Meal Plan - Hari Pertama
                </a>

                <!-- WORKOUT HARI PERTAMA -->
                <a href="pdf/Workout_HariKe1.pdf"
                  class="menu-item submenu-trigger" data-target="workoutContent1">
                  <i class="fas fa-dumbbell"></i>1.3 Workout - Hari Pertama
                </a>
              
                <!-- WATER REMINDER HARI PERTAMA -->
                <a href="pdf/WaterReminder_HariKe1.pdf" 
                  class="menu-item submenu-trigger" data-target="waterReminderContent1">
                  <i class="fas fa-prescription-bottle"></i>1.4 Water Reminder - Hari Pertama
                </a>
              
                <!-- WAKTU ISTIRAHAT HARI PERTAMA -->
                <a href="pdf/Istirahat_HariKe1.pdf" 
                  class="menu-item submenu-trigger" data-target="istirahatContent1">
                  <i class="fas fa-bed"></i>1.5 Waktu Istirahat - Hari Pertama
                </a>
                
                <!-- DATA TRACKING HARI PERTAMA -->
                <a href="/pdf/DataTracking_HariKe1.pdf" 
                  class="menu-item submenu-trigger" data-target="dataTrackingContent1">
                  <i class="fas fa-user-friends"></i>1.6 Data Tracking - Hari Pertama
                </a>

                <!-- TANYA COACH HARI PERTAMA -->
                <a href="https://api.whatsapp.com/send?phone=6281241318600&text=Halo+kak%2C+saya+ingin+bertanya+materi+tentang+" 
                  class="menu-item" target="_blank">
                  <i class="fa fa-whatsapp"></i>1.7 Tanya Coach? - Hari Pertama
                </a>

                <!-- SELESAI MODUL HARI PERTAMA -->
                <a href="#" 
                  class="menu-item">
                  <i class="fas fa-check-double"></i>Selesai Modul Hari Pertama
                </a>
              </div>
            </div>
          </div>

          <!-- KONTEN DETAIL UNTUK SUBMENU -->
          <!-- Meal Plan Content -->
          <div class="submenu-content" id="mealPlanContent1" style="display: none;">
            <div class="border p-3 bg-light mt-2 mb-2">
              <div class="card-title p-1 mb-2 position-relative" style="text-align:center; color: #ffffff; text-shadow: #bebebe; background-color:  #002266; border-bottom-style:solid; border-bottom-color:#facc00; border-width:5px;">
                <h6 class="mt-1 mb-1">Apa Yang Anda Makan Hari Ini ?</h6>
                <button type="button" class="btn-close-header position-absolute top-50 end-0 translate-middle-y me-2" onclick="hideSubmenu('mealPlanContent1')">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              
              <h6><b>PANDUAN NUTRISI</b></h6>
              <p><b>Rekomendasi Meal Plan : </b>Konsumsi makanan bergizi dalam jumlah yang tepat sesuai dengan kebutuhan nutrisi anda</br>
              <button type="button" class="btn btn-primary btn-sm mt-1" id="btnCekDisiniMealPlan">
                <i class="fas fa-utensils"></i> Cek Disini
              </button>
        
              <!-- PDF Viewer untuk Meal Plan -->
              <div class="pdf-viewer" id="pdfViewerMealplan1" style="display: none;">
                <button class="close-pdf" onclick="closePDF('mealplan1')">
                  <i class="fas fa-times"></i>
                </button>
                <div class="pdf-container" id="pdfContainerMealplan1">
                  <!-- PDF akan dimuat di sini -->
                </div>
              </div>
                  
              <div style="border-left-style:solid; border-left-color:#b1b1b1; border-width: 4px; padding-left: 10px; margin-top: 10px;">
                <p><i class="fas far fa-lightbulb mt-2 mb-2" style="color: #fa0000;"></i><b> Tips : </b>Pastikan makanan yang anda konsumsi adalah makanan yang sehat dan seimbang, yang terpenuhi unsur</p>
                <i class="far fa-check-circle"></i> Karbohidrat 40%</br>
                <i class="far fa-check-circle"></i> Protein 30%</br>
                <i class="far fa-check-circle"></i> Lemak 30%</br>
              </div>

              <!-- Jadwal Meal Plan -->
              <div class="mt-3 mb-2" id="jadwalMealplan-container">
                <h6 class="mt-2"><b>JADWAL MEAL PLAN</b></h6>
                <div id="jadwalMealplan-list">
                  <!-- Pilihan jadwal meal dimuat di sini -->  
                </div>
              </div>
             </div>
          </div>
          
          <!-- Workout Content -->
          <div class="submenu-content" id="workoutContent1" style="display: none;">
            <div class="border p-3 bg-light mt-2 mb-2">
              <div class="card-title p-1 mb-2 position-relative" style="text-align:center; color: #ffffff; text-shadow: #bebebe; background-color:  #002266; border-bottom-style:solid; border-bottom-color:#facc00; border-width:5px;">
                <h6 class="mt-1 mb-1">Apa Olahraga Anda Hari Ini ?</h6>
                 <button type="button" class="btn-close-header position-absolute top-50 end-0 translate-middle-y me-2" onclick="hideSubmenu('workoutContent1')">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              
              <h6><b>PANDUAN WORKOUT</b></h6>
              <p><b>Rekomendasi Olahraga : </b>Olahraga 3-5 hari seminggu dengan durasi 20-30 menit setiap harinya, dengan pilihan jenis olahraga yang sesuai dengan kebutuhan tubuh dan kesehatan</br>
              <button type="button" class="btn btn-primary btn-sm mt-1" id="btnCekDisiniWorkout">
                <i class="fas fa-dumbbell"></i> Cek Disini
              </button>
   
              <!-- PDF Viewer untuk Workout -->
              <div class="pdf-viewer" id="pdfViewerWorkout1" style="display: none;">
                <button class="close-pdf" onclick="closePDF('workout1')">
                  <i class="fas fa-times"></i>
                </button>
                <div class="pdf-container" id="pdfContainerWorkout1">
                  <!-- PDF akan dimuat di sini -->
                </div>
              </div>
              
              <div style="border-left-style:solid; border-left-color:#b1b1b1; border-width: 4px; padding-left: 10px; margin-top: 10px;">
                <p><i class="fas far fa-lightbulb mt-2 mb-2" style="color: #fa0000;"></i><b> Tips : </b>Bergabunglah dengan berbagai komunitas olahraga, dimana orang-orangnya saling mendukung dan memotivasi satu sama lain</p>
              </div>

              <h6><b>JENIS WORKOUT</b></h6>  
              <!-- Pilih Jenis Olahraga Kardio -->
              <div class="mt-3 mb-2" id="kardio-container">
                <h6>Olahraga Kardio :</h6>
                <div id="olahragaKardio-list">
                  <!-- Pilihan olahraga kardio dimuat di sini -->
                </div>
              </div>

              <!-- Pilih Jenis Olahraga Resistance -->
              <div class="mt-3 mb-2" id="resistance-container">
                <h6>Olahraga Resistance :</h6>
                <div id="olahragaResisten-list">
                  <!-- Pilihan olahraga resisten dimuat di sini -->
                </div>
              </div>

              <button type="button" class="btn btn-secondary btn-sm" id="btnSelesaiWorkout" data-bs-toggle="tooltip" title="Selesai Workout"><i class="fa fa-check"></i> Selesai</button>
            </div>
          </div>
   
          <!-- Water Reminder Content -->
          <div class="submenu-content" id="waterReminderContent1" style="display: none;">
            <div class="border p-3 bg-light mt-2 mb-2">
              <div class="card-title p-1 mb-2 position-relative" style="text-align:center; color: #ffffff; text-shadow: #bebebe; background-color: #002266; border-bottom-style:solid; border-bottom-color:#facc00; border-width:5px;">
                <h6 class="mt-1 mb-1">Hari Ini Minum Air Putih Berapa ?</h6>
                <button type="button" class="btn-close-header position-absolute top-50 end-0 translate-middle-y me-2" onclick="hideSubmenu('waterReminderContent1')">
                  <i class="fas fa-times"></i>
                </button>
              </div>
             
              <h6><b>PANDUAN WATER REMINDER</b></h6>
              <p><b>Rekomendasi Asupan Air : </b>Minum air putih 8-15 gelas air perhari, dengan jumlah air putih yang cukup untuk mendukung aktivitas tubuh dan kesehatan</br>
              <button type="button" class="btn btn-primary btn-sm mt-1" id="btnCekDisiniAirMinum">
                <i class="fas fa-prescription-bottle"></i> Cek Disini
              </button>
     
              <!-- PDF Viewer untuk Water Reminder -->
              <div class="pdf-viewer" id="pdfViewerWater1" style="display: none;">
                <button class="close-pdf" onclick="closePDF('water1')">
                  <i class="fas fa-times"></i>
                </button>
                <div class="pdf-container" id="pdfContainerWater1">
                  <!-- PDF akan dimuat di sini -->
                </div>
              </div>
          
              <div style="border-left-style:solid; border-left-color:#b1b1b1; border-width: 4px; padding-left: 10px; margin-top: 10px;">
                <p><i class="fas far fa-lightbulb mt-2 mb-2" style="color: #fa0000;"></i><b> Tips : </b>Untuk mencukupi asupan air minum sehari</p>
                <i class="far fa-check-circle"></i> Belilah botol air yang dapat digunakan kembali untuk dibawa kemana-mana</br>
                <i class="far fa-check-circle"></i> Botol yang memiliki tulisan takaran air, untuk mengetahui sudah berapa banyak yang anda minum</br>
                <i class="far fa-check-circle"></i> Minumlah lebih banyak jika iklim cuaca panas dan sering berolahraga</br>
              </div>

              <!-- Asupan Air Putih dalam sehari -->
              <div class="mt-3 mb-2" id="airputih-container">
                <h6><b>ASUPAN AIR PUTIH PERHARI</b></h6> 
                <div id="airputihRadioBtn">
                  <!-- Pilihan jumlah air minum dimuat di sini -->
                </div>
              </div>
            </div>
          </div>
               
          <!-- Istirahat Content -->
          <div class="submenu-content" id="istirahatContent1" style="display: none;">
            <div class="border p-3 bg-light mt-2 mb-2">
              <div class="card-title p-1 mb-2 position-relative" style="text-align:center; color: #ffffff; text-shadow: #bebebe; background-color: #002266; border-bottom-style:solid; border-bottom-color:#facc00; border-width:5px;">
                <h6 class="mt-1 mb-1">Hari Ini Istirahatnya Berapa Lama ?</h6>
                <button type="button" class="btn-close-header position-absolute top-50 end-0 translate-middle-y me-2" onclick="hideSubmenu('istirahatContent1')">
                  <i class="fas fa-times"></i>
                </button>
              </div>

              <h6><b>PANDUAN ISTIRAHAT</b></h6>
              <p><b>Rekomendasi Istirahat : </b>Dapatkan jam istirahat anda antara 6-8 Jam per malam</br>
              <button type="button" class="btn btn-primary btn-sm mt-1" id="btnCekDisiniIstirihat">
                <i class="fas fa-bed"></i> Cek Disini
              </button>
          
              <!-- PDF Viewer untuk Istirahat -->
              <div class="pdf-viewer" id="pdfViewerIstirahat1" style="display: none;">
                <button class="close-pdf" onclick="closePDF('istirahat1')">
                  <i class="fas fa-times"></i>
                </button>
                <div class="pdf-container" id="pdfContainerIstirahat1">
                  <!-- PDF akan dimuat di sini -->
                </div>
              </div>
          
              <div style="border-left-style:solid; border-left-color:#b1b1b1; border-width: 4px; padding-left: 10px; margin-top: 10px;">
                <p><i class="fas far fa-lightbulb mt-2 mb-2" style="color: #fa0000;"></i><b> Tips : </b>Pastikan anda istirahat dalam ruangan yang pencahayaannya redup, hening dan memiliki suhu ruang yang nyaman</p>
              </div>

              <!-- Waktu Istirahat -->
              <div class="mt-3 mb-2" id="istirahat-container">
                <!-- <h6><b>BERAPA JAM ISTIRAHAT</b></h6> --> 
                <div id="istirahatBtn">
                  <!-- Pilihan jadwal istirahat dimuat di sini -->
                </div>
              </div>

            </div>
          </div>
      
          <!-- Data Tracking Content -->
          <div class="submenu-content" id="dataTrackingContent1" style="display: none;">
            <div class="border p-3 bg-light mt-2 mb-2">
              <div class="card-title p-1 mb-2 position-relative" style="text-align:center; color: #ffffff; text-shadow: #bebebe; background-color: #002266; border-bottom-style:solid; border-bottom-color:#facc00; border-width:5px;">
                <h6 class="mt-1 mb-1">Lengkapi Data Anda ! </h6>
                <button type="button" class="btn-close-header position-absolute top-50 end-0 translate-middle-y me-2" onclick="hideSubmenu('dataTrackingContent1')">
                  <i class="fas fa-times"></i>
                </button>
              </div>

              <h6><b>PANDUAN DATA TRACKING</b></h6>
              <p><b>Rekomendasi : </b>Cara melakukan pengukuran dan penimbangan yang benar</br>
              <button type="button" class="btn btn-primary btn-sm mt-1" id="btnCekDisiniDataTubuh">
                <i class="fas fa-bed"></i> Cek Disini
              </button>
              
              <!-- PDF Viewer untuk Data Tracking -->
              <div class="pdf-viewer" id="pdfViewerDatatracking1" style="display: none;">
                <button class="close-pdf" onclick="closePDF('datatracking1')">
                  <i class="fas fa-times"></i>
                </button>
                <div class="pdf-container" id="pdfContainerDatatracking1">
                  <!-- PDF akan dimuat di sini -->
                </div>
              </div>  

              <div style="border-left-style:solid; border-left-color:#b1b1b1; border-width: 4px; padding-left: 10px; margin-top: 10px;">
                <p><i class="fas far fa-lightbulb mt-2 mb-2" style="color: #fa0000;"></i><b> Tips : </b>Pastikan menginput data dengan lengkap dan benar, agar anda bisa mendapatkan hasil analisa yang lebih akurat dari kami</p>
              </div>  

              <!-- Data Kondisi Tubuh -->
              <div class="mt-3 mb-2" id="kondisitubuh-container">
                <h6><b>INPUT DATA ANDA</b></h6> 
                <div id="kondisiTubuh">
                  <!-- Inputan Data Kondisi Tubuh dimuat di sini -->
                </div>
              </div>
            </div>
          </div>
          
          <!-- MODUL HARI KE 2-10 (SAMA FITURE DAN STRUKTURNYA) -->
    
          <!-- TAMPILAN KREASI RESEP -->
          <div class="menu-accordion-item">
            <button class="menu-header collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#healthyRecept">
              <span>
                <i class="fas fa-angle-double-right me-2"></i>Resep Healthy Snacking
                <i class="fas fa-lock status-lock"></i>
              </span>
              <i class="fas fa-angle-down menu-icon"></i>
            </button>
            <div class="collapse" id="healthyRecept" data-bs-parent="#menuAccordion">
              <div class="menu-content">
                <!-- Playlist Link - SIMPLE -->
                <a href="https://www.youtube.com/playlist?list=PLJU0P2EGDp-8Zs3cF6x84nF1wkB66hYvG" 
                  class="menu-item playlist-trigger" data-target="playlistHealthyRecept">
                  <i class="fas fa-play-circle"></i>Playlist Kreasi Resep Sehat
                </a>
                
                <!-- Playlist Container -->
                <div class="playlist-container" id="playlistHealthyRecept" style="display: none;">
                  <!-- Playlist items akan diisi oleh JavaScript -->
                </div>
                
                <!-- Video Player untuk Healthy Recept -->
                <div class="video-container" id="videoContainerHealthyRecept" style="display: none;">
                  <button class="close-video" onclick="closeVideo('healthyRecept')">
                    <i class="fas fa-times"></i>
                  </button>
                  <div class="video-wrapper">
                    <div class="video-placeholder" onclick="playVideo('healthyRecept')">
                      <i class="fas fa-play-circle"></i>
                      <div class="video-placeholder-text">Pilih video dari playlist</div>
                    </div>
                    <div class="video-loading" id="videoLoadingHealthyRecept">
                      <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading video...</span>
                      </div>
                    </div>
                    <div id="videoPlayerHealthyRecept"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- TAMPILAN DASHBOARD FIT TRACK -->
          <div class="menu-accordion-item">
            <button class="menu-header collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dasboardFitTrack">
              <span>
                <i class="fas fa-angle-double-right me-2"></i>Dashboard Fit Track
                <i class="fas fa-lock status-lock"></i>
              </span>
              <i class="fas fa-angle-down menu-icon"></i>
            </button>
            <div class="collapse" id="dasboardFitTrack" data-bs-parent="#menuAccordion">
              <div class="menu-content">
                <a href="#" class="menu-item"><i class="fas fa-chart-line"></i>Fit Track1</a>
                <a href="#" class="menu-item"><i class="fas fa-heartbeat"></i>Fit Track2</a>
                <a href="#" class="menu-item"><i class="fas fa-dumbbell"></i>Fit Track3</a>
             </div>
            </div>
          </div>
        </div>

        <footer class="footer mt-3 text-white text-center p-2 rounded" style="font-size:12pt; background-color: #002266;">
          FIT Challenge Versi 1.0 Â© 2025 Power by:<a href="https://www.beratidealku.com" class="text-white"> www.beratidealku.com</a></br>
          <img src="images/Logo_Herbalife_Independent_Member_white.png" alt="Logo" width="185" height="22">
        </footer>
      </div>
    </div>
  </div>
</div>

<!-- About Overlay -->
<div class="about-overlay" id="aboutOverlay">
  <div class="about-form">
    <h5 class="mb-2">Fat Loss Challenge Versi 1.0</h5>
    <br>Copyright Â© 2025 <a href="https://www.beratidealku.com" class="text-black">www.beratidealku.com</a>
    <br>Allright Reserved
    <br>Hanya digunakan untuk kalangan internal
    <div class="d-grid mt-4">
      <button id="btnCloseAbout" class="btn btn-primary">OK</button>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
<script>

// *************************
// * FUNGSI UTAMA APLIKASI *
// *************************                           

const URL_PROGRAM_APP   = 'https://script.google.com/macros/s/AKfycbx2XbJMMYku921YYqL-XvU0VAVCu-OqY45tJitMBeBzGCzULJsbsMOmsuRtIRUd4FDm/exec';
// Deklarasi Global
const PLAYLIST_JSON_URL = './data/playlist.json';

/******************
* Show About form 
*******************/
function showAbout() {
  document.getElementById('aboutOverlay').style.display = 'flex';
}

/******************
* Hide About form 
*******************/  
function hideAbout() {
  document.getElementById('aboutOverlay').style.display = 'none';
}

/*****************
/ Logout function 
******************/
function logout() {
  localStorage.removeItem('userId');
  localStorage.removeItem('userToken');
  localStorage.removeItem('userLevel');
  sessionStorage.removeItem('aksesList');
  window.location.reload();
}

// ***********************
// ACCORDION TOGGLE FIX 
// ************************
document.addEventListener('DOMContentLoaded', function() {
    let currentOpenMenu = null;
    
    document.querySelectorAll('.menu-header').forEach(header => {
        // Remove Bootstrap's click handler completely
        header.setAttribute('data-bs-toggle', '');
        
        header.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const targetId = this.getAttribute('data-bs-target');
            const targetContent = document.querySelector(targetId);
            
            if (!targetContent) return;
            
            console.log('ðŸ”„ Menu diklik:', targetId);
            console.log('Current open:', currentOpenMenu);
            
            // Jika klik menu yang sama yang sedang terbuka
            if (currentOpenMenu === targetId) {
                // TUTUP menu
                targetContent.style.display = 'none';
                targetContent.classList.remove('show');
                this.classList.add('collapsed');
                currentOpenMenu = null;
                console.log('âœ… Menu DITUTUP');
            } else {
                // BUKA menu baru
                // Tutup menu yang sebelumnya terbuka
                if (currentOpenMenu) {
                    const previousContent = document.querySelector(currentOpenMenu);
                    const previousHeader = document.querySelector(`[data-bs-target="${currentOpenMenu}"]`);
                    if (previousContent && previousHeader) {
                        previousContent.style.display = 'none';
                        previousContent.classList.remove('show');
                        previousHeader.classList.add('collapsed');
                    }
                }
                
                // Buka menu baru
                targetContent.style.display = 'block';
                targetContent.classList.add('show');
                this.classList.remove('collapsed');
                currentOpenMenu = targetId;
                console.log('âœ… Menu DIBUKA');
            }
        });
    });
});

/***********************************
* Event listener di DOMContentLoaded
************************************/
document.addEventListener('DOMContentLoaded', function() {
  // Submenu triggers
  document.querySelectorAll('.submenu-trigger').forEach(trigger => {
    trigger.addEventListener('click', function(e) {
      e.preventDefault();
      const target = this.getAttribute('data-target');
      showSubmenu(target);
    });
  });
  
  // Initialize Bootstrap tooltips
  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });

  // Setup video links
  setupAllLinks();
  
  // Setup PDF links khusus untuk menu Panduan
  setupPanduanPDFLinks();

  // Setup tombol "Cek Disini" untuk Modul Hari Pertama
  setupCekDisiniButtons();
  
  // Setup playlist triggers
  setupPlaylistTriggers();
  
  // Setup Materi Pertemuan
  setupMateriCompletion();
  
  // Setup MealPlan
  setupMealPlanUpload();
  
  console.log('âœ… Program 10 Hari initialized');


  // Load saved resistance data
  setTimeout(() => {
    loadSavedResistanceData();
  }, 1000);
  
  // About overlay
  document.getElementById('btnCloseAbout').addEventListener('click', hideAbout);
  
  // Cek login status
  const userToken = localStorage.getItem('userToken');
  if (userToken) {
    const loginMenuItem = document.getElementById('loginMenuItem');
    loginMenuItem.innerHTML = `
      <a class="nav-link main-menu-link" href="loginFC.html" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i> Logout
      </a>
    `;
  }
  
  // Initialize video players
  initializeAllVideoPlayers();
  console.log('âœ… App initialized successfully');
});

/*************************
* Setup Tombol Cek Disini
**************************/
function setupCekDisiniButtons() {
    console.log('ðŸ”§ Setting up Cek Disini buttons...');
    
    // Meal Plan hari pertama  
    const btnMealPlan = document.getElementById('btnCekDisiniMealPlan');
    if (btnMealPlan) {
        btnMealPlan.addEventListener('click', function() {
            console.log('ðŸ“‹ Meal Plan button clicked');
            loadPDF('mealplan1', 'https://amihaji.github.io/beratideal/pdf/MealPlan_HariKe1.pdf', 'Meal Plan Hari Pertama');
        });
    }
    
    // Workout hari pertama
    const btnWorkout = document.getElementById('btnCekDisiniWorkout');
    if (btnWorkout) {
        btnWorkout.addEventListener('click', function() {
            console.log('ðŸ’ª Workout button clicked');
            loadPDF('workout1', 'https://amihaji.github.io/beratideal/pdf/WorkOut_HariKe1.pdf', 'Workout Hari Pertama');
        });
    }
    
    // WaterReminder hari pertama
    const btnAirMinum = document.getElementById('btnCekDisiniAirMinum');
    if (btnAirMinum) {
        btnAirMinum.addEventListener('click', function() {
            console.log('ðŸ’§ Water Reminder button clicked');
            loadPDF('water1', 'https://amihaji.github.io/beratideal/pdf/WaterReminder_HariKe1.pdf', 'Water Reminder Hari Pertama');
        });
    }
    
    // Istirahat hari pertama
    const btnIstirahat = document.getElementById('btnCekDisiniIstirihat');
    if (btnIstirahat) {
        btnIstirahat.addEventListener('click', function() {
            console.log('ðŸ˜´ Istirahat button clicked');
            loadPDF('istirahat1', 'https://amihaji.github.io/beratideal/pdf/Istirahat_HariKe1.pdf', 'Waktu Istirahat Hari Pertama');
        });
    }
    
    // Data Tracking Hari Pertama - PERBAIKAN: ID yang benar
    const btnDataTubuh = document.getElementById('btnCekDisiniDataTubuh');
    if (btnDataTubuh) {
        btnDataTubuh.addEventListener('click', function() {
            console.log('ðŸ“Š Data Tracking button clicked');
            loadPDF('datatracking1', 'https://amihaji.github.io/beratideal/pdf/DataTracking_HariKe1.pdf', 'Data Tracking Hari Pertama');
        });
    }
    
    console.log('âœ… Cek Disini buttons setup completed');
}

// ********************************
// ***** FUNGSI VIDEO PLAYER ******
// ********************************
let currentVideoData = {};

/***********************************
* Fungsi Initialisasi Seluruh video
************************************/ 
function initializeAllVideoPlayers() {
  console.log('Initializing video players...');

  // Setup video placeholder click events
  document.querySelectorAll('.video-placeholder').forEach(placeholder => {
    const section = placeholder.closest('.video-container').id.replace('videoContainer', '');
    placeholder.addEventListener('click', function() {
      playVideo(section);
    });
  });
  
  // Close video dengan ESC key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && currentVideoData.section) {
      closeVideo(currentVideoData.section);
    }
  });
}

/*******************************
* Setup Semua Link Video dan PDF
********************************/
function setupAllLinks() {
  // Setup video links
  document.querySelectorAll('.video-link').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      
      const section = this.getAttribute('data-section');
      const videoType = this.getAttribute('data-type');
      const videoUrl = this.getAttribute('data-url');
      const title = this.textContent.trim();
      
      // Sembunyikan semua konten lain
      document.querySelectorAll('.submenu-content').forEach(content => {
        content.style.display = 'none';
      });
      document.querySelectorAll('.video-container').forEach(video => {
        video.style.display = 'none';
      });
      document.querySelectorAll('.pdf-viewer').forEach(pdf => {
        pdf.style.display = 'none';
      });
      
      // Load video
      loadVideo(section, videoType, videoUrl, title);
      
      // Tampilkan video player di posisi yang tepat
      const videoContainer = document.getElementById(`videoContainer${capitalizeFirst(section)}`);
      if (videoContainer) {
        videoContainer.style.display = 'block';
        
        // Sisipkan video container setelah link video yang diklik
        this.parentNode.insertBefore(videoContainer, this.nextSibling);
        
        // Auto play video
        setTimeout(() => {
          playVideo(section);
        }, 500);
      }
    });
  });
  
  // Setup PDF links
  setupPDFLinks();
}

/****************************************
* Fungsi Memuat Video Berdasarkan Section
*****************************************/ 
function loadVideo(section, videoType, videoUrl, title = '') {
    console.log('ðŸŽ¬ loadVideo called:', { section, videoType, videoUrl, title });
    
    // Debug proses loading
    debugVideoLoadProcess(section, videoType, videoUrl);
    
    // Untuk Canva, buka di tab baru
    if (videoType === 'canva') {
        window.open(videoUrl, '_blank');
        return;
    }
    
    const videoContainer = document.getElementById(`videoContainer${capitalizeFirst(section)}`);
    if (!videoContainer) {
        console.error('âŒ Video container not found for section:', section);
        return;
    }
    
    const videoPlaceholder = videoContainer.querySelector('.video-placeholder');
    const videoLoading = document.getElementById(`videoLoading${capitalizeFirst(section)}`);
    const videoPlayer = document.getElementById(`videoPlayer${capitalizeFirst(section)}`);
    
    // Validasi URL YouTube
    if (videoType === 'youtube' && !validateYouTubeUrl(videoUrl)) {
        console.error('âŒ Invalid YouTube URL:', videoUrl);
        showToast('URL YouTube tidak valid', 'error');
        return;
    }
    
    // Close video di section lain
    closeAllVideos();
    
    // Reset previous video 
    if (videoPlayer) videoPlayer.innerHTML = '';
    currentVideoData = {
        section: section,
        type: videoType,
        url: videoUrl,
        title: title
    };
    
    // Show video container
    videoContainer.style.display = 'block';
    
    // Update placeholder text
    let placeholderText = 'Klik untuk memuat video';
    if (videoType === 'youtube') {
        const youtubeId = extractYouTubeId(videoUrl);
        placeholderText = youtubeId ? 'Klik untuk memuat video dari YouTube' : 'URL YouTube tidak valid';
    } else if (videoType === 'local') {
        placeholderText = 'Klik untuk memuat video lokal';
    }
    
    if (videoPlaceholder) {
        videoPlaceholder.querySelector('.video-placeholder-text').textContent = placeholderText;
        videoPlaceholder.style.display = 'flex';
    }
    if (videoLoading) videoLoading.style.display = 'none';
    
    // Auto play setelah ditampilkan
    setTimeout(() => {
        playVideo(section);
    }, 500);
}

/*******************************
* Memutar Video yang sudah dimuat
********************************/
function playVideo(section) {
    console.log('playVideo called for section:', section);
    
    const videoContainer   = document.getElementById(`videoContainer${capitalizeFirst(section)}`);
    const videoPlaceholder = videoContainer?.querySelector('.video-placeholder');
    const videoLoading     = document.getElementById(`videoLoading${capitalizeFirst(section)}`);
    const videoPlayer      = document.getElementById(`videoPlayer${capitalizeFirst(section)}`);
    
    if (!videoContainer || !videoPlayer) {
        console.error('Video elements not found for section:', section);
        return;
    }
    
    // Hide placeholder, show loading
    if (videoPlaceholder) videoPlaceholder.style.display = 'none';
    if (videoLoading) videoLoading.style.display = 'flex';
    
    // Load video based on type
    setTimeout(() => {
        if (videoLoading) videoLoading.style.display = 'none';
        
        if (currentVideoData.type === 'youtube') {
            console.log('Loading YouTube video:', currentVideoData.url);
            loadYouTubeVideo(videoPlayer, currentVideoData.url);
        } else if (currentVideoData.type === 'local') {
            console.log('Loading local video:', currentVideoData.url);
            loadLocalVideo(videoPlayer, currentVideoData.url);
        }
    }, 1000);
}

/*********************
* Memuat Video Youtube 
**********************/
function loadYouTubeVideo(videoPlayer, url) {
    const videoId = extractYouTubeId(url);
    console.log('YouTube ID extracted:', videoId);
    
    if (videoId) {
        videoPlayer.innerHTML = `
            <iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
            </iframe>
        `;
        console.log('YouTube iframe created');
    } else {
        console.error('Could not extract YouTube ID from URL:', url);
        // Fallback: buka di tab baru
        window.open(url, '_blank');
        if (currentVideoData.section) {
            closeVideo(currentVideoData.section);
        }
    }
}

/*******************
* Memuat Video Local
********************/
function loadLocalVideo(videoPlayer, url) {
    console.log('Creating local video element for:', url);
    videoPlayer.innerHTML = `
        <video controls autoplay style="width:100%; height:100%">
            <source src="${url}" type="video/mp4">
            Browser Anda tidak mendukung pemutaran video.
        </video>
    `;
    
    // Handle error loading local video
    const videoElement = videoPlayer.querySelector('video');
    if (videoElement) {
        videoElement.onerror = function() {
            console.error('Error loading local video:', url);
            alert('Video tidak dapat dimuat. Pastikan file video ada di folder yang benar.');
            if (currentVideoData.section) {
                closeVideo(currentVideoData.section);
            }
        };
    }
}

/***************************
* Ekstrak ID dari URL YouTube
****************************/
function extractYouTubeId(url) {
    console.log('ðŸ” Extracting YouTube ID from:', url);
    
    if (!url) {
        console.log('âŒ URL is empty');
        return null;
    }
    
    // Support semua format URL YouTube
    const patterns = [
        /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&?#]+)/,
        /youtube\.com\/watch\?.*v=([^&?#]+)/,
        /youtu\.be\/([^&?#]+)/,
        /youtube\.com\/v\/([^&?#]+)/,
        /youtube\.com\/watch\?.*vi?=([^&?#]+)/,
        /youtube\.com\/user\/.*\/[^#]+\?.*v=([^&?#]+)/
    ];
    
    for (const pattern of patterns) {
        const match = url.match(pattern);
        if (match && match[1]) {
            const videoId = match[1];
            console.log('âœ… YouTube ID found:', videoId);
            return videoId;
        }
    }
    
    // Fallback: coba ekstrak dengan metode split
    try {
        if (url.includes('youtube.com/watch?v=')) {
            const videoId = url.split('v=')[1]?.split('&')[0];
            if (videoId && videoId.length === 11) {
                console.log('âœ… YouTube ID found (fallback):', videoId);
                return videoId;
            }
        } else if (url.includes('youtu.be/')) {
            const videoId = url.split('youtu.be/')[1]?.split('?')[0];
            if (videoId && videoId.length === 11) {
                console.log('âœ… YouTube ID found (fallback):', videoId);
                return videoId;
            }
        }
    } catch (error) {
        console.error('Error in fallback extraction:', error);
    }
    
    console.log('âŒ No YouTube ID found in URL:', url);
    return null;
}

/*********************************
* Tutup Video di Section Tertentu
**********************************/
function closeVideo(section) {
    console.log('Closing video for section:', section);
    
    const videoContainer = document.getElementById(`videoContainer${capitalizeFirst(section)}`);
    if (!videoContainer) return;
    
    const videoPlayer = document.getElementById(`videoPlayer${capitalizeFirst(section)}`);
    const videoPlaceholder = videoContainer.querySelector('.video-placeholder');
    const videoLoading = document.getElementById(`videoLoading${capitalizeFirst(section)}`);
    
    // Stop video playback
    const iframe = videoPlayer.querySelector('iframe');
    const localVideo = videoPlayer.querySelector('video');
    
    if (iframe) iframe.src = '';
    if (localVideo) {
        localVideo.pause();
        localVideo.currentTime = 0;
    }
    
    videoPlayer.innerHTML = '';
    videoContainer.style.display = 'none';
    if (videoPlaceholder) videoPlaceholder.style.display = 'flex';
    if (videoLoading) videoLoading.style.display = 'none';
    
    currentVideoData = {};
}

/***************************************
* Tutup Semua Video yang sedang diputar
***************************************/
function closeAllVideos() {
    console.log('Closing all videos');
    const videoContainers = document.querySelectorAll('.video-container');
    videoContainers.forEach(container => {
        const section = container.id.replace('videoContainer', '');
        if (section) {
            closeVideo(section);
        }
    });
    // Close all PDFs
    closeAllPDFs();
}

/*******************************
* Validasi URL YouTube - FUNGSI BARU
********************************/
function validateYouTubeUrl(url) {
    console.log('ðŸ” Validating YouTube URL:', url);
    
    const youtubeRegex = /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+/;
    const isValid = youtubeRegex.test(url);
    
    console.log('âœ… YouTube URL validation:', isValid);
    return isValid;
}

/*******************************
* Debug Video Load Process - FUNGSI BARU
********************************/
function debugVideoLoadProcess(section, videoType, videoUrl) {
    console.log('ðŸ”§ DEBUG VIDEO LOAD PROCESS:');
    console.log('Section:', section);
    console.log('Video Type:', videoType);
    console.log('Video URL:', videoUrl);
    console.log('Is YouTube URL:', validateYouTubeUrl(videoUrl));
    console.log('YouTube ID:', extractYouTubeId(videoUrl));
    console.log('Video Container exists:', !!document.getElementById(`videoContainer${capitalizeFirst(section)}`));
}

// ****************************
// ***** FUNGSI PLAYLIST ******
/******************************
 
/************************************
* Memuat data playlist dari File JSon
*************************************/
async function loadPlaylistData() {
    try {
        console.log('ðŸ“¥ Loading playlist data from JSON...');
        const response = await fetch(PLAYLIST_JSON_URL);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log(`âœ… Loaded ${data.length} videos from JSON`);
        return data;
        
    } catch (error) {
        console.error('âŒ Error loading playlist data:', error);
        // Fallback ke proven videos
        return getProvenVideos();
    }
}

/********************************
* Fallback Video Jika JSon Error
*********************************/
function getProvenVideos() {
    return [
        {
            id: '1',
            videoId: '9DoHhx9jlGM',
            title: 'Alasan Mengapa Herbalife',
            thumbnail: 'https://i.ytimg.com/vi/9DoHhx9jlGM/mqdefault.jpg',
            duration: '15:30',
            position: 1
        },
        {
            id: '2', 
            videoId: 'Zg_badTE2Ec',
            title: 'Dari Mana Saja Sumber Protein Bisa Didapatkan?',
            thumbnail: 'https://i.ytimg.com/vi/Zg_badTE2Ec/mqdefault.jpg',
            duration: '12:45',
            position: 2
        }
    ];
}

/***********************
* Setup Trigger Playlist 
************************/
function setupPlaylistTriggers() {
  document.querySelectorAll('.playlist-trigger').forEach(trigger => {
    trigger.addEventListener('click', function(e) {
      e.preventDefault();
      const target = this.getAttribute('data-target');
      const playlistUrl = this.getAttribute('href');
      showPlaylistInSection(target, playlistUrl, this);
    });
  });
}

/******************************
* Tampilkan Playlist di Section 
*******************************/
async function showPlaylistInSection(targetId, playlistUrl, triggerElement) {
  const playlistContainer = document.getElementById(targetId);
  if (!playlistContainer) {
    console.error('Playlist container not found:', targetId);
    return;
  }
  
  // Sembunyikan semua konten lain
  document.querySelectorAll('.submenu-content').forEach(content => {
    content.style.display = 'none';
  });
  document.querySelectorAll('.video-container').forEach(video => {
    video.style.display = 'none';
  });
  document.querySelectorAll('.pdf-viewer').forEach(pdf => {
    pdf.style.display = 'none';
  });
  document.querySelectorAll('.playlist-container').forEach(playlist => {
    playlist.style.display = 'none';
  });
  
  // Tampilkan loading
  playlistContainer.innerHTML = `
    <div class="playlist-loading">
      <div class="spinner-border spinner-border-sm" role="status"></div>
      <div class="mt-2">Memuat daftar video...</div>
    </div>
  `;
  playlistContainer.style.display = 'block';
  
  // Tempatkan playlist container setelah trigger element
  if (triggerElement && triggerElement.parentNode) {
    triggerElement.parentNode.insertBefore(playlistContainer, triggerElement.nextSibling);
  }
  
  try {
    const playlistItems = await loadPlaylistData();
    
    if (!playlistItems || playlistItems.length === 0) {
      throw new Error('Tidak ada data video');
    }
    
    renderPlaylist(playlistContainer, playlistItems, 'healthyRecept');
    
  } catch (error) {
    console.error('Error showing playlist:', error);
    // Fallback ke proven videos
    const provenVideos = getProvenVideos();
    renderPlaylist(playlistContainer, provenVideos, 'healthyRecept');
    showToast('âš ï¸ Menggunakan data lokal', 'info');
  }
}

/******************************************
* Render Playlist items dengan tombol close
*******************************************/
function renderPlaylist(container, items, section) {
  container.innerHTML = '';
  
  // Header dengan tombol close
  const header = document.createElement('div');
  header.className = 'playlist-header position-relative';
  header.style.padding = '12px 15px';
  header.style.borderBottom = '1px solid #dee2e6';
  header.style.background = '#f8f9fa';
  header.style.fontWeight = '600';
  header.innerHTML = `
    <div>
      <i class="fas fa-list-ul me-2"></i>Playlist Healthy Snacking
      <div style="font-size: 12px; color: #666; font-weight: normal; margin-top: 2px;">
        ${items.length} video tersedia
      </div>
    </div>
    <button type="button" class="btn-close-header position-absolute top-50 end-0 translate-middle-y me-2" 
            onclick="hidePlaylist('${container.id}')">
      <i class="fas fa-times"></i>
    </button>
  `;
  container.appendChild(header);
  
  // Render playlist items
  items.forEach((item, index) => {
    const playlistItem = document.createElement('div');
    playlistItem.className = 'playlist-item';
    playlistItem.style.cursor = 'pointer';
    playlistItem.innerHTML = `
      <div class="playlist-thumbnail">
        <img src="${item.thumbnail}" alt="${item.title}" 
             loading="lazy"
             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjY4IiB2aWV3Qm94PSIwIDAgMTIwIDY4IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iNjgiIGZpbGw9IiNlZGVkZWQiLz48dGV4dCB4PSI2MCIgeT0iMzQiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMCIgZmlsbD0iIzk5OTk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+VGh1bWJuYWlsPC90ZXh0Pjwvc3ZnPg=='">
        <div class="position-badge">${index + 1}</div>
      </div>
      <div class="playlist-info">
        <div class="playlist-title">${item.title}</div>
        <div class="playlist-meta">
          ${item.duration ? `<span class="playlist-duration"><i class="fas fa-clock me-1"></i>${item.duration}</span>` : ''}
          <span class="playlist-position">Video ${index + 1}</span>
        </div>
      </div>
    `;
    
    playlistItem.onclick = function() {
      playVideoFromPlaylist(section, item.videoId, item.title);
    };
    
    container.appendChild(playlistItem);
  });
  
  // Footer
  const footer = document.createElement('div');
  footer.className = 'playlist-footer';
  footer.style.padding = '10px 15px';
  footer.style.borderTop = '1px solid #dee2e6';
  footer.style.fontSize = '12px';
  footer.style.color = '#666';
  footer.style.textAlign = 'center';
  footer.style.background = '#f8f9fa';
  footer.innerHTML = `
    <div><i class="fas fa-database me-1"></i>Data update â€¢ ${new Date().toLocaleDateString('id-ID')}</div>
  `;
  container.appendChild(footer);
}

/************************************************
* Update fungsi showPlaylist untuk compatibility
*************************************************/
async function showPlaylist(section, playlistUrl) {
  const playlistContainer = document.getElementById(`playlist${capitalizeFirst(section)}`);
  const triggerElement = document.querySelector(`[data-target="playlist${capitalizeFirst(section)}"]`);
  
  if (playlistContainer && triggerElement) {
    await showPlaylistInSection(`playlist${capitalizeFirst(section)}`, playlistUrl, triggerElement);
  }
}

/**********************
* Fungsi Hide Playlist
***********************/
function hidePlaylist(playlistId) {
  const playlistContainer = document.getElementById(playlistId);
  
  if (playlistContainer) {
    playlistContainer.style.display = 'none';
  }
  
  // Kembalikan ke posisi semula jika perlu
  const healthyReceptContent = document.getElementById('healthyRecept');
  if (healthyReceptContent && playlistId === 'playlistHealthyRecept') {
    const menuContent = healthyReceptContent.querySelector('.menu-content');
    if (menuContent) {
      menuContent.appendChild(playlistContainer);
    }
  }
}

/**************************
* Putar Video dari Playlist
***************************/
function playVideoFromPlaylist(section, videoId, title) {
    console.log('ðŸŽ¬ Playing video from playlist:', { section, videoId, title });
    
    const videoContainer = document.getElementById(`videoContainer${capitalizeFirst(section)}`);
    if (!videoContainer) {
        console.error('Video container not found for section:', section);
        return;
    }
    
    // Sembunyikan playlist
    const playlistContainer = document.getElementById(`playlist${capitalizeFirst(section)}`);
    if (playlistContainer) {
        playlistContainer.style.display = 'none';
    }
    
    // Show video container
    videoContainer.style.display = 'block';
    
    // Set current video data
    currentVideoData = {
        section: section,
        type: 'youtube',
        url: `https://www.youtube.com/watch?v=${videoId}`,
        title: title
    };
    
    // Auto play video setelah delay
    setTimeout(() => {
        playVideo(section);
    }, 500);
    
    // Scroll ke video player
    setTimeout(() => {
        videoContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }, 600);
}

// *****************************
// ***** FUNGSI PDF VIEWER *****
// *****************************
let currentPDFData = {};

/**********************
* Fungsi Setup PDF Link
***********************/
function setupPDFLinks() {
  document.querySelectorAll('.pdf-link').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      
      const section = this.getAttribute('data-section');
      const pdfUrl = this.getAttribute('data-url');
      const title = this.textContent.trim();
      
      // Sembunyikan semua video container
      document.querySelectorAll('.video-container').forEach(video => {
        video.style.display = 'none';
      });
      
      // Sembunyikan semua submenu content
      document.querySelectorAll('.submenu-content').forEach(content => {
        content.style.display = 'none';
      });
      
      // Sembunyikan semua PDF viewer terlebih dahulu
      document.querySelectorAll('.pdf-viewer').forEach(pdf => {
        pdf.style.display = 'none';
      });
      
      // Load PDF
      loadPDF(section, pdfUrl, title);
      
      // Tampilkan PDF viewer di posisi yang tepat
      const pdfViewer = document.getElementById(`pdfViewer${capitalizeFirst(section)}`);
      if (pdfViewer) {
        pdfViewer.style.display = 'block';
        
        // Sisipkan PDF viewer setelah link PDF yang diklik
        this.parentNode.insertBefore(pdfViewer, this.nextSibling);
      }
    });
  });
}

/****************************
* Memuat dan Menampilkan PDF
****************************/ 
function loadPDF(section, pdfUrl, title = '') {
    console.log('loadPDF called:', { section, pdfUrl, title });
    
    const pdfViewer = document.getElementById(`pdfViewer${capitalizeFirst(section)}`);
    const pdfContainer = document.getElementById(`pdfContainer${capitalizeFirst(section)}`);
    
    if (!pdfViewer || !pdfContainer) {
        console.error('âŒ PDF Viewer or Container not found for section:', section);
        return;
    }
    
    // Close video dan PDF lain
    closeAllVideos();
    closeAllPDFs();
    
    // Reset previous PDF
    pdfContainer.innerHTML = '';
    currentPDFData = {
        section: section,
        url: pdfUrl,
        title: title
    };
    
    // Show loading
    pdfContainer.innerHTML = `
        <div class="pdf-loading">
            <div class="spinner-border spinner-border-sm" role="status"></div>
            <div class="mt-2">Memuat PDF, tunggu...</div>
        </div>
    `;
    
    // Show PDF viewer
    pdfViewer.style.display = 'block';
    
    // **PERBAIKAN: Tempatkan PDF viewer di posisi yang tepat**
    if (section === 'panduan') {
        // Untuk menu Panduan: tempatkan setelah link PDF yang diklik
        const pdfLink = document.getElementById('pdfPanduanLink');
        if (pdfLink && pdfLink.parentNode) {
            pdfLink.parentNode.insertBefore(pdfViewer, pdfLink.nextSibling);
            console.log('âœ… PDF Panduan placed after link');
        }
    } else {
        // Untuk tombol "Cek Disini": tempatkan setelah tombol yang diklik
        const cekDisiniBtn = document.getElementById(`btnCekDisini${capitalizeFirst(section)}`);
        if (cekDisiniBtn && cekDisiniBtn.parentNode) {
            // Tempatkan PDF viewer setelah parent paragraph dari tombol
            const parentParagraph = cekDisiniBtn.closest('p');
            if (parentParagraph && parentParagraph.parentNode) {
                parentParagraph.parentNode.insertBefore(pdfViewer, parentParagraph.nextSibling);
                console.log('âœ… PDF placed after button paragraph');
            } else {
                // Fallback: tempatkan setelah tombol langsung
                cekDisiniBtn.parentNode.insertBefore(pdfViewer, cekDisiniBtn.nextSibling);
                console.log('âœ… PDF placed after button');
            }
        } else {
            console.error('âŒ Cek Disini button not found for section:', section);
        }
    }
    
    // Load PDF setelah ditampilkan
    setTimeout(() => {
        displayPDF(section, pdfUrl, title);
    }, 500);
}

/*************************************
* Setup link PDF - khusus Menu Panduan
**************************************/
function setupPanduanPDFLinks() {
    const panduanPDFLink = document.getElementById('pdfPanduanLink');
    if (panduanPDFLink) {
        // Hapus href yang menyebabkan navigasi
        panduanPDFLink.href = "#";
        
        // Tambahkan event listener baru
        panduanPDFLink.addEventListener('click', function(e) {
            e.preventDefault();
            loadPDF('panduan', 'pdf/Panduan_Penggunaan_Aplikasi.pdf', 'PDF Panduan Penggunaan Aplikasi');
        });
        
        console.log('âœ… PDF Panduan link setup completed');
    } else {
        console.error('âŒ PDF Panduan link not found');
    }
}

/****************
* Menampilkan PDF
*****************/
function displayPDF(section, pdfUrl, title) {
    console.log('Displaying PDF with PDF.js:', pdfUrl);
    
    const pdfContainer = document.getElementById(`pdfContainer${capitalizeFirst(section)}`);
    
    if (!pdfContainer) return;
    
    // Set up PDF.js
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
    
    let pdfDoc = null;
    let pageNum = 1;
    let pageRendering = false;
    let pageNumPending = null;
    const scale = 1.5;
    
    function renderPage(num) {
        pageRendering = true;
        
        pdfDoc.getPage(num).then(function(page) {
            const viewport = page.getViewport({ scale: scale });
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            
            canvas.className = 'pdfjs-canvas';
            
            const renderContext = {
                canvasContext: ctx,
                viewport: viewport
            };
            
            const renderTask = page.render(renderContext);
            
            renderTask.promise.then(function() {
                pageRendering = false;
                
                if (pageNumPending !== null) {
                    renderPage(pageNumPending);
                    pageNumPending = null;
                }
            });
            
            // Clear container dan tambahkan canvas DULUAN
            const viewer = document.getElementById(`pdfjsViewer${capitalizeFirst(section)}`);
            viewer.innerHTML = '';
            viewer.appendChild(canvas);
            
            // Update page info
            document.getElementById(`pdfjsPageInfo${capitalizeFirst(section)}`).textContent = 
                `Halaman ${num} dari ${pdfDoc.numPages}`;
                
        }).catch(function(error) {
            console.error('Error rendering page:', error);
            handlePDFError(section);
        });
    }
    
    function queueRenderPage(num) {
        if (pageRendering) {
            pageNumPending = num;
        } else {
            renderPage(num);
        }
    }
    
    function onPrevPage() {
        if (pageNum <= 1) return;
        pageNum--;
        queueRenderPage(pageNum);
    }
    
    function onNextPage() {
        if (pageNum >= pdfDoc.numPages) return;
        pageNum++;
        queueRenderPage(pageNum);
    }
    
    // Load the PDF
    pdfjsLib.getDocument(pdfUrl).promise.then(function(pdfDoc_) {
        pdfDoc = pdfDoc_;
        
        // Update container - CONTROLS DIBAWAH SETELAH CANVAS
        pdfContainer.innerHTML = `
            <div class="pdfjs-viewer" id="pdfjsViewer${capitalizeFirst(section)}"></div>
            <div class="pdfjs-controls">
                <button class="btn btn-sm btn-outline-primary" onclick="onPrevPage${capitalizeFirst(section)}()">
                    <i class="fas fa-chevron-left"></i> Sebelumnya
                </button>
                <span class="pdfjs-page-info" id="pdfjsPageInfo${capitalizeFirst(section)}">
                    Halaman 1 dari ${pdfDoc.numPages}
                </span>
                <button class="btn btn-sm btn-outline-primary" onclick="onNextPage${capitalizeFirst(section)}()">
                    Berikutnya <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        `;
        
        // Render first page
        renderPage(1);
        
        // Store functions globally for button access
        window[`onPrevPage${capitalizeFirst(section)}`] = onPrevPage;
        window[`onNextPage${capitalizeFirst(section)}`] = onNextPage;
        
    }).catch(function(error) {
        console.error('Error loading PDF with PDF.js:', error);
        // Fallback ke iframe
        fallbackToIframe(section, pdfUrl);
    });
}

/******************************
* Menampilkan PDF dengan PDF.js
*******************************/
function displayPDFWithPDFJS(section, pdfUrl, title) {
    const pdfContainer = document.getElementById(`pdfContainer${capitalizeFirst(section)}`);
    
    // Show loading
    pdfContainer.innerHTML = `
        <div class="pdf-loading">
            <div class="spinner-border spinner-border-sm" role="status"></div>
            <div class="mt-2">Memuat PDF, tunggu...</div>
        </div>
    `;
    
    // Set up PDF.js
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
    
    let pdfDoc = null;
    let pageNum = 1;
    let pageRendering = false;
    let pageNumPending = null;
    const scale = 1.5;
    
    function renderPage(num) {
        pageRendering = true;
        
        pdfDoc.getPage(num).then(function(page) {
            const viewport = page.getViewport({ scale: scale });
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            
            canvas.className = 'pdfjs-canvas';
            
            const renderContext = {
                canvasContext: ctx,
                viewport: viewport
            };
            
            const renderTask = page.render(renderContext);
            
            renderTask.promise.then(function() {
                pageRendering = false;
                
                if (pageNumPending !== null) {
                    renderPage(pageNumPending);
                    pageNumPending = null;
                }
            });
            
            // Clear container and add canvas
            const viewer = document.getElementById(`pdfjsViewer${capitalizeFirst(section)}`);
            viewer.innerHTML = '';
            viewer.appendChild(canvas);
            
            // Update page info
            document.getElementById(`pdfjsPageInfo${capitalizeFirst(section)}`).textContent = 
                `Halaman ${num} dari ${pdfDoc.numPages}`;
                
        }).catch(function(error) {
            console.error('Error rendering page:', error);
            handlePDFError(section);
        });
    }
    
    function queueRenderPage(num) {
        if (pageRendering) {
            pageNumPending = num;
        } else {
            renderPage(num);
        }
    }
    
    function onPrevPage() {
        if (pageNum <= 1) return;
        pageNum--;
        queueRenderPage(pageNum);
    }
    
    function onNextPage() {
        if (pageNum >= pdfDoc.numPages) return;
        pageNum++;
        queueRenderPage(pageNum);
    }
    
    // Load the PDF
    pdfjsLib.getDocument(pdfUrl).promise.then(function(pdfDoc_) {
        pdfDoc = pdfDoc_;
        
        // Update container with PDF.js viewer
        pdfContainer.innerHTML = `
            <div class="pdfjs-controls">
                <button class="btn btn-sm btn-outline-primary" onclick="onPrevPage${capitalizeFirst(section)}()">
                    <i class="fas fa-chevron-left"></i> Sebelumnya
                </button>
                <span class="pdfjs-page-info" id="pdfjsPageInfo${capitalizeFirst(section)}">
                    Halaman 1 dari ${pdfDoc.numPages}
                </span>
                <button class="btn btn-sm btn-outline-primary" onclick="onNextPage${capitalizeFirst(section)}()">
                    Berikutnya <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="pdfjs-viewer" id="pdfjsViewer${capitalizeFirst(section)}"></div>
        `;
        
        // Render first page
        renderPage(1);
        
        // Store functions globally for button access
        window[`onPrevPage${capitalizeFirst(section)}`] = onPrevPage;
        window[`onNextPage${capitalizeFirst(section)}`] = onNextPage;
        
    }).catch(function(error) {
        console.error('Error loading PDF with PDF.js:', error);
        // Fallback ke metode sebelumnya
        fallbackToIframe(section, pdfUrl);
    });
}

/*********************************
* Tampilkan Opsi PDF untuk Mobile
*********************************/
function showMobilePDFOptions(section, pdfUrl, title) {
    const pdfContainer = document.getElementById(`pdfContainer${capitalizeFirst(section)}`);
    
    pdfContainer.innerHTML = `
        <div style="padding: 20px; text-align: center;">
            <div class="mb-4">
                <i class="fas fa-file-pdf fa-3x text-danger mb-3"></i>
                <h5>${title}</h5>
                <p class="text-muted">Pilih cara untuk melihat PDF:</p>
            </div>
            
            <div class="d-grid gap-2">
                <button class="btn btn-primary btn-lg" onclick="displayPDFWithPDFJS('${section}', '${pdfUrl}', '${title}')">
                    <i class="fas fa-eye me-2"></i>Lihat di Aplikasi (PDF.js)
                </button>
                
                <button class="btn btn-outline-primary btn-lg" onclick="openPDFInNewTab('${section}')">
                    <i class="fas fa-external-link-alt me-2"></i>Buka di Browser
                </button>
            </div>
            
            <div class="mt-4 p-3 bg-light rounded">
                <small class="text-muted">
                    <i class="fas fa-info-circle me-1"></i>
                    <strong>File PDF</strong> mungkin membutuhkan waktu lebih lama untuk memuat, 
                    tetapi dapat menampilkan PDF langsung di aplikasi.
                </small>
            </div>
        </div>
    `;
}

/*************************************
* Fallback ke Iframe Jika PDF.js Gagal
**************************************/
function fallbackToIframe(section, pdfUrl) {
    const pdfContainer = document.getElementById(`pdfContainer${capitalizeFirst(section)}`);
    
    pdfContainer.innerHTML = `
        <iframe 
            src="${pdfUrl}#toolbar=0&navpanes=0&scrollbar=1&view=FitH" 
            width="100%" 
            height="500" 
            style="border: none;"
            onerror="handlePDFError('${section}')"
        >
        </iframe>
    `;
}

/*********************
* Buka PDF di Tab Baru
**********************/
function openPDFInNewTab(section) {
    if (currentPDFData.url) {
        window.open(currentPDFData.url, '_blank');
    }
}

/******************
* Tutup PDF Viewer
*******************/
function closePDF(section) {
    console.log('Closing PDF for section:', section);
    
    const pdfViewer = document.getElementById(`pdfViewer${capitalizeFirst(section)}`);
    const pdfContainer = document.getElementById(`pdfContainer${capitalizeFirst(section)}`);
    
    if (!pdfViewer || !pdfContainer) return;
    
    // Clear PDF content
    pdfContainer.innerHTML = '';
    pdfViewer.style.display = 'none';
    
    currentPDFData = {};
}

/************************
* Tutup Semua PDF Viewer
*************************/
function closeAllPDFs() {
    console.log('Closing all PDFs');
    const pdfViewers = document.querySelectorAll('.pdf-viewer');
    pdfViewers.forEach(viewer => {
        const section = viewer.id.replace('pdfViewer', '');
        if (section) {
            closePDF(section.toLowerCase());
        }
    });
    
    // Untuk panaduan kembalikan pdf viewer ke posisi semula
    const panduanPDFViewer = document.getElementById('pdfViewerPanduan');
    const panduanContent = document.getElementById('panduanContent');
    if (panduanPDFViewer && panduanContent) {
        const menuContent = panduanContent.querySelector('.menu-content');
        if (menuContent) {
            // Tempatkan sebelum "Selesai Panduan"
            const selesaiLink = menuContent.querySelector('a[href="#"]:last-child');
            if (selesaiLink) {
                menuContent.insertBefore(panduanPDFViewer, selesaiLink);
            } else {
                menuContent.appendChild(panduanPDFViewer);
            }
        }
    }
    
    // Untuk submenu lainnya, kembalikan ke submenu content masing-masing
    const submenuSections = ['mealplan1', 'workout1', 'water1', 'istirahat1', 'datatracking1'];
    submenuSections.forEach(section => {
        const pdfViewer = document.getElementById(`pdfViewer${capitalizeFirst(section)}`);
        const submenuContent = document.getElementById(`${section}Content1`);
        if (pdfViewer && submenuContent) {
            submenuContent.appendChild(pdfViewer);
        }
    });
}

// ********************************
// ***** FUNGSI SUMNEU DAN UI *****
/**********************************

/*******************
* Tampilkan Submenu
*******************/
function showSubmenu(targetId) {
  // Sembunyikan semua submenu content dan video player
  document.querySelectorAll('.submenu-content').forEach(content => {
    content.style.display = 'none';
  });
  document.querySelectorAll('.video-container').forEach(video => {
    video.style.display = 'none';
  });
  
  // Tampilkan submenu yang dipilih
  const targetContent = document.getElementById(targetId);
  if (targetContent) {
    targetContent.style.display = 'block';
    
    // Cari posisi yang tepat untuk menampilkan konten
    const triggerElement = document.querySelector(`[data-target="${targetId}"]`);
    if (triggerElement) {
      // Sisipkan konten setelah trigger element
      triggerElement.parentNode.insertBefore(targetContent, triggerElement.nextSibling);
    }
    
    // Scroll ke konten yang ditampilkan
    setTimeout(() => {
      targetContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
  }
}

/**********************
* Sembunyikan Submenu
***********************/
function hideSubmenu(targetId) {
  const targetContent = document.getElementById(targetId);
  if (targetContent) {
    targetContent.style.display = 'none';
    // Kembalikan ke posisi semula (setelah accordion)
    const menuAccordion = document.getElementById('menuAccordion');
    if (menuAccordion) {
      menuAccordion.parentNode.insertBefore(targetContent, menuAccordion.nextSibling);
    }
  }
}

// *****************************
// ***** UTILITY FUNCTIONS *****
// *****************************

/*******************************************************
/*          PROGRAM 10 HARI - FRONTEND SIMPLE        *
/*******************************************************/

// 1.1 MATERI VIDEO - Tombol Centang
function setupMateriCompletion() {
  // Tambah tombol centang di setiap video container
  document.querySelectorAll('.video-container').forEach(container => {
    const completeBtn = document.createElement('button');
    completeBtn.innerHTML = '<i class="fas fa-check"></i>';
    completeBtn.className = 'btn btn-success btn-sm';
    completeBtn.style.cssText = `
      position: absolute; top: 10px; left: 10px; z-index: 25;
      width: 35px; height: 35px; border-radius: 50%; padding: 0;
    `;
    
    completeBtn.onclick = function() {
      const section = container.id.replace('videoContainer', '');
      const hariKe = getHariKeFromSection(section);
      simpanMateri(hariKe);
    };
    
    const videoWrapper = container.querySelector('.video-wrapper');
    if (videoWrapper) {
      videoWrapper.style.position = 'relative';
      videoWrapper.appendChild(completeBtn);
    }
  });
}

// Ganti fungsi simpanMateri dengan ini:
async function simpanMateri(hariKe) {
  const userId = localStorage.getItem('userId');
  if (!userId) {
    alert('Silakan login terlebih dahulu');
    return;
  }

  console.log('ðŸ”§ simpanMateri called:', { userId, hariKe });

  try {
    const response = await fetch(URL_PROGRAM_APP, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: new URLSearchParams({
        action: 'updateMateri',
        userId: userId,
        hariKe: hariKe
      })
    });

    const result = await response.text();
    console.log('ðŸ“¥ Response:', result);

    if (result === "OK") {
      showNotification('success', 'Materi berhasil disimpan!');
      updateMateriStatusUI(hariKe);
    } else {
      showNotification('error', 'Gagal: ' + result);
    }
  } catch (error) {
    console.error('âŒ Fetch error:', error);
    showNotification('error', 'Gagal terhubung: ' + error.message);
  }
}

function Backup_simpanMateri(hariKe) {
  const userId = localStorage.getItem('userId');
  if (!userId) {
    alert('Silakan login terlebih dahulu');
    return;
  }

  console.log('ðŸ”§ simpanMateri called:', { userId, hariKe });
  console.log('ðŸ“¤ URL:', URL_PROGRAM_APP);

  const callbackName = 'cb_materi_' + Date.now();
  const url = `${URL_PROGRAM_APP}?action=updateMateri&userId=${encodeURIComponent(userId)}&hariKe=${hariKe}&callback=${callbackName}`;
  
  console.log('ðŸ“¤ Full URL:', url);

  const script = document.createElement('script');
  script.src = url;

  window[callbackName] = function(response) {
    console.log('ðŸ“¥ Response received:', response);
    if (response === "OK") {
      showNotification('success', 'Materi berhasil disimpan!');
      updateMateriStatusUI(hariKe);
    } else {
      showNotification('error', 'Gagal menyimpan materi: ' + response);
    }
    document.body.removeChild(script);
    delete window[callbackName];
  };

  script.onerror = function(error) {
    console.error('âŒ Script error:', error);
    showNotification('error', 'Gagal terhubung ke server');
    document.body.removeChild(script);
    delete window[callbackName];
  };

  document.body.appendChild(script);
  console.log('ðŸ“¤ Script element appended');
}

// 1.2 MEAL PLAN - Upload Foto
function setupMealPlanUpload() {
  // Setup tombol upload
  const uploadConfig = {
    'btnUploadSarapan': 'sarapan',
    'btnUploadCemilanPagi': 'cemilanPagi',
    'btnUploadMakanSiang': 'makanSiang',
    'btnUploadCemilanSore': 'cemilanSore',
    'btnUploadMakanMalam': 'makanMalam'
  };

  Object.entries(uploadConfig).forEach(([btnId, mealType]) => {
    const btn = document.getElementById(btnId);
    if (btn) {
      btn.onclick = function() {
        uploadMealPhoto(mealType);
      };
    }
  });

  // Setup tombol simpan
  const simpanConfig = {
    'btnSimpanSarapan': 'sarapan',
    'btnSimpanCemilanPagi': 'cemilanPagi',
    'btnSimpanMakanSiang': 'makanSiang',
    'btnSimpanCemilanSore': 'cemilanSore',
    'btnSimpanMakanMalam': 'makanMalam'
  };

  Object.entries(simpanConfig).forEach(([btnId, mealType]) => {
    const btn = document.getElementById(btnId);
    if (btn) {
      btn.onclick = function() {
        simpanMealItem(mealType);
      };
    }
  });

  // Tombol selesai meal plan
  const btnSelesai = document.getElementById('btnSelesaiMealPlan');
  if (btnSelesai) {
    btnSelesai.onclick = function() {
      selesaiMealPlan();
    };
  }
}

function uploadMealPhoto(mealType) {
  const fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.accept = 'image/*';
  fileInput.capture = 'environment';

  fileInput.onchange = function(e) {
    const file = e.target.files[0];
    if (!file) return;

    // Validasi file
    if (file.size > 5 * 1024 * 1024) {
      showNotification('error', 'File terlalu besar (maks 5MB)');
      return;
    }

    if (!file.type.startsWith('image/')) {
      showNotification('error', 'File harus berupa gambar');
      return;
    }

    // Convert to base64
    const reader = new FileReader();
    reader.onload = function(e) {
      const base64Data = e.target.result.split(',')[1];
      uploadMealPlanWithFile(mealType, base64Data);
    };
    reader.onerror = function() {
      showNotification('error', 'Gagal membaca file');
    };
    reader.readAsDataURL(file);
  };

  fileInput.click();
}

function uploadMealPlanWithFile(mealType, fileData) {
  const userId = localStorage.getItem('userId');
  if (!userId) {
    showNotification('error', 'Silakan login terlebih dahulu');
    return;
  }

  const callbackName = 'cb_upload_' + Date.now();
  const script = document.createElement('script');
  script.src = `${URL_PROGRAM_APP}?action=uploadMealPlan&userId=${encodeURIComponent(userId)}&hariKe=1&mealType=${mealType}&file=${encodeURIComponent(fileData)}&callback=${callbackName}`;

  window[callbackName] = function(response) {
    try {
      const result = typeof response === 'string' ? JSON.parse(response) : response;
      
      if (result.success) {
        showNotification('success', result.message);
        // Update input field
        const inputField = document.getElementById(mealType);
        if (inputField) {
          inputField.value = 'âœ“ Foto terupload';
        }
        // Enable tombol simpan
        const simpanBtn = document.getElementById(`btnSimpan${capitalizeFirst(mealType)}`);
        if (simpanBtn) {
          simpanBtn.classList.remove('disabled');
        }
      } else {
        showNotification('error', result.message || 'Upload gagal');
      }
    } catch (e) {
      showNotification('error', 'Response tidak valid');
    }
    
    document.body.removeChild(script);
    delete window[callbackName];
  };

  script.onerror = function() {
    showNotification('error', 'Gagal terhubung ke server');
    document.body.removeChild(script);
    delete window[callbackName];
  };

  document.body.appendChild(script);
}

function simpanMealItem(mealType) {
  const userId = localStorage.getItem('userId');
  if (!userId) {
    showNotification('error', 'Silakan login terlebih dahulu');
    return;
  }

  const callbackName = 'cb_mealitem_' + Date.now();
  const script = document.createElement('script');
  script.src = `${URL_PROGRAM_APP}?action=updateMealItem&userId=${encodeURIComponent(userId)}&hariKe=1&mealType=${mealType}&callback=${callbackName}`;

  window[callbackName] = function(response) {
    if (response === "OK") {
      showNotification('success', `Status ${mealType} berhasil disimpan`);
    } else {
      showNotification('error', `Gagal menyimpan status ${mealType}`);
    }
    document.body.removeChild(script);
    delete window[callbackName];
  };

  script.onerror = function() {
    showNotification('error', 'Gagal terhubung ke server');
    document.body.removeChild(script);
    delete window[callbackName];
  };

  document.body.appendChild(script);
}

function selesaiMealPlan() {
  const userId = localStorage.getItem('userId');
  if (!userId) {
    showNotification('error', 'Silakan login terlebih dahulu');
    return;
  }

  const callbackName = 'cb_selesai_' + Date.now();
  const script = document.createElement('script');
  script.src = `${URL_PROGRAM_APP}?action=updateMealPlan&userId=${encodeURIComponent(userId)}&hariKe=1&callback=${callbackName}`;

  window[callbackName] = function(response) {
    if (response === "OK") {
      showNotification('success', 'Meal Plan selesai!');
    } else {
      showNotification('error', 'Gagal menyelesaikan meal plan');
    }
    document.body.removeChild(script);
    delete window[callbackName];
  };

  script.onerror = function() {
    showNotification('error', 'Gagal terhubung ke server');
    document.body.removeChild(script);
    delete window[callbackName];
  };

  document.body.appendChild(script);
}

/**********************************
/* FUNGSI BANTU                  *
/**********************************/
function getHariKeFromSection(section) {
  const map = {
    'Pertemuan1': 1, 'Pertemuan2': 2, 'Pertemuan3': 3,
    'Pertemuan4': 4, 'Pertemuan5': 5, 'Pertemuan6': 6,
    'Pertemuan7': 7, 'Pertemuan8': 8, 'Pertemuan9': 9,
    'Pertemuan10': 10
  };
  return map[section] || 1;
}

function updateMateriStatusUI(hariKe) {
  const header = document.querySelector(`[data-hari="${hariKe}"]`);
  if (header) {
    const lockIcon = header.querySelector('.status-lock');
    if (lockIcon) {
      lockIcon.className = 'status-unlock';
      lockIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
    }
  }
}

function capitalizeFirst(string) {
  return string.charAt(0).toUpperCase() + string.slice(1);
}

function showNotification(type, message) {
  // Gunakan notifikasi yang sudah ada di loginFC.txt
  const notificationBox = document.getElementById('notificationBox');
  const icon = document.getElementById('pesanNotifIcon');
  const text = document.getElementById('pesanNotifText');
  
  if (notificationBox && icon && text) {
    notificationBox.className = 'notification-message w-100 mb-2';
    icon.className = 'pesan-notif-icon me-2';
    
    if (type === 'error') {
      notificationBox.classList.add('notification-error');
      icon.classList.add('fas', 'fa-times-circle');
    } else if (type === 'success') {
      notificationBox.classList.add('notification-success');
      icon.classList.add('fas', 'fa-check-circle');
    }
    
    text.textContent = message;
    notificationBox.style.display = 'flex';
    setTimeout(() => { notificationBox.style.display = 'none'; }, 3000);
  } else {
    // Fallback simple alert
    alert(message);
  }
}

function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => resolve(reader.result.split(',')[1]);
    reader.onerror = error => reject(error);
  });
}

async function simpanMealPlan(mealType, fileData = null) {
  const userId = localStorage.getItem('userId');
  
  const data = {
    action: 'uploadMealPlan',
    userId: userId,
    hariKe: 1,
    mealType: mealType
  };
  
  if (fileData) {
    data.file = fileData;
  }
  
  try {
    const response = await fetch(PROGRAM_APP_URL, {
      method: 'POST',
      headers: {'Content-Type': 'application/x-www-form-urlencoded'},
      body: new URLSearchParams(data)
    });
    
    const result = await response.json();
    
    if (result.success) {
      showToast(`${mealType} berhasil disimpan!`, 'success');
    } else {
      showToast('Gagal: ' + result.message, 'error');
    }
  } catch (error) {
    showToast('Error: ' + error.message, 'error');
  }
}


function updateLockIcon(hariKe, type) {
  const header = document.querySelector(`[data-hari="${hariKe}"]`);
  if (header) {
    const lockIcon = header.querySelector('.status-lock');
    if (lockIcon) {
      lockIcon.className = 'status-unlock';
      lockIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
    }
  }
}

function showToast(message, type = 'info') {
  // Simple toast notification
  const toast = document.createElement('div');
  toast.style.cssText = `
    position: fixed; top: 20px; right: 20px; padding: 12px 20px;
    background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8'};
    color: white; border-radius: 4px; z-index: 10000;
  `;
  toast.textContent = message;
  document.body.appendChild(toast);
  
  setTimeout(() => toast.remove(), 3000);
}

// INITIALIZE
document.addEventListener('DOMContentLoaded', function() {
  setupMateriCompletion();
  setupMealPlanUpload();
  console.log('âœ… Program 10 Hari initialized');
});


/*****************************
* Ekstrak ID Playlist dari URL
******************************/ 
function extractPlaylistId(url) {
    const match = url.match(/[&?]list=([^&]+)/);
    return match ? match[1] : null;
}

/************************
* Fungsi tampilkan pesan
*************************/ 

// *********************************
// ***** FUNGSI - FUNGSI FORM  *****
// *********************************

/******************
* Jadwal Meal Plan
*******************/   
const jadwalMealplan = document.getElementById("jadwalMealplan-list");
if (jadwalMealplan) {
  const wrapper = document.createElement("div");
  wrapper.className = "mb-1";
  wrapper.innerHTML = `
    <div><label class="form-label">Sarapan (07:00 - 09:00)</label></div>
    <div class="input-group mt-0 mb-2">
      <input class="form-control" type="text" id="sarapan" placeholder="Upload Sarapan" style="max-width: 100%;" readonly>
        <button type="button" class="btn btn-outline-secondary btn-sm" id="btnUploadSarapan" data-bs-toggle="tooltip" title="upload"><i class="fa fa-cloud-upload"></i></button>
        <button type="button" class="btn btn-primary btn-sm disabled" id="btnSimpanSarapan" data-bs-toggle="tooltip" title="simpan"><i class="fa fa-pencil-square-o"></i></button>
      </input>
    </div>

    <div><label class="form-label">Cemilan Pagi (10:00 - 10:30)</label></div>
    <div class="input-group mt-0 mb-2">
      <input class="form-control" type="text" id="cemilanPagi" placeholder="Upload Cemilan Pagi" style="max-width: 100%;" readonly>
        <button type="button" class="btn btn-outline-secondary btn-sm" id="btnUploadCemilanPagi" data-bs-toggle="tooltip" title="upload"><i class="fa fa-cloud-upload"></i></button>
        <button type="button" class="btn btn-primary btn-sm disabled" id="btnSimpanCemilanPagi" data-bs-toggle="tooltip" title="simpan"><i class="fa fa-pencil-square-o"></i></button>
      </input>
    </div>

    <div><label class="form-label">Makan Siang (12:00 - 14:00)</label></div>
    <div class="input-group mt-0 mb-2">
      <input class="form-control" type="text" id="makanSiang" placeholder="Upload Makan Siang" style="max-width: 100%;" readonly>
        <button type="button" class="btn btn-outline-secondary btn-sm" id="btnUploadMakanSiang" data-bs-toggle="tooltip" title="upload"><i class="fa fa-cloud-upload"></i></button>
        <button type="button" class="btn btn-primary btn-sm disabled" id="btnSimpanMakanSiang" data-bs-toggle="tooltip" title="simpan"><i class="fa fa-pencil-square-o"></i></button>
      </input>
    </div>

    <div><label class="form-label">Cemilan Sore (16:00 - 16:30)</label></div>
    <div class="input-group mt-0 mb-2">
      <input class="form-control" type="text" id="cemilanSore" placeholder="Upload Cemilan Sore" style="max-width: 100%;" readonly>
        <button type="button" class="btn btn-outline-secondary btn-sm" id="btnUploadCemilanSore" data-bs-toggle="tooltip" title="upload"><i class="fa fa-cloud-upload"></i></button>
        <button type="button" class="btn btn-primary btn-sm disabled" id="btnSimpanCemilanSore" data-bs-toggle="tooltip" title="simpan"><i class="fa fa-pencil-square-o"></i></button>
      </input>
    </div>

    <div><label class="form-label">Makan Malam (18:00 - 20:00)</label></div>
    <div class="input-group mt-0 mb-2">
      <input class="form-control" type="text" id="makanMalam" placeholder="Upload Makan Malam" style="max-width: 100%;" readonly>
        <button type="button" class="btn btn-outline-secondary btn-sm" id="btnUploadMakanMalam" data-bs-toggle="tooltip" title="upload"><i class="fa fa-cloud-upload"></i></button>
        <button type="button" class="btn btn-primary btn-sm disabled" id="btnSimpanMakanMalam" data-bs-toggle="tooltip" title="simpan"><i class="fa fa-pencil-square-o"></i></button>
      </input>
    </div>
    <div>
      <button type="button" class="btn btn-secondary btn-sm" id="btnSelesaiMealPlan" data-bs-toggle="tooltip" title="Selesai Mealplan"><i class="fa fa-check"></i> Selesai</button>
    </div>  
  `;
  jadwalMealplan.appendChild(wrapper);
} 

/************************
* Daftar Olahraga Kardio
*************************/   
const kardioExercises = document.getElementById("olahragaKardio-list");
if (kardioExercises) {
  const wrapper = document.createElement("div");
  wrapper.className = "mb-1";
  wrapper.innerHTML = `
    <div class="form-group mb-2"> 
      <select class="form-select" id="olahragaKardio" style="max-width: 100%;" required>
        <option value="">Pilihan...</option>
        <option value="Lari">Lari</option>
        <option value="Sepeda">Sepeda</option>
        <option value="Renang">Renang</option>
        <option value="Aerobic">Aerobic</option>
        <option value="Zumba">Zumba</option>
        <option value="Jalan Cepat">Jalan Cepat</option>
      </select>
    </div> 

    <div class="form-label mt-2 mb-2">Kegiatan Olahraga :</div>
    <div class="input-group mb-2">
      <input class="form-control" type="text" id="kegiatanKardio" placeholder="Upload" style="max-width: 100%;" readonly>
        <button type="button" class="btn btn-outline-secondary btn-sm" id="btnUploadKardio" data-bs-toggle="tooltip" title="upload"><i class="fa fa-cloud-upload"></i></button>
        <button type="button" class="btn btn-primary btn-sm disabled" id="btnSimpanKardio" data-bs-toggle="tooltip" title="simpan"><i class="fa fa-pencil-square-o"></i></button>
      </input>
    </div>
    
    <div class="form-label mt-1 mb-0">Durasi Olahraga :</div>
    <div class="input-group mt-0 mb-2">
      <button type="button" class="btn btn-primary btn-sm" id="btnStartOlahraga" data-bs-toggle="tooltip" title="Waktu Mulai">Start</button>
        <input class="form-control" type="time" id="startOlahraga" style="max-width: 100%;" disabled>  
      <button type="button" class="btn btn-primary btn-sm  disabled" id="btnSimpanStartOlahraga" data-bs-toggle="tooltip" title="simpan"><i class="fa fa-pencil-square-o"></i></button>
    </div>

    <div class="input-group mt-0 mb-2">
      <button type="button" class="btn btn-danger btn-sm" id="btnStopOlahraga" data-bs-toggle="tooltip" title="Waktu Berhenti">Stop</button>
        <input class="form-control" type="time" id="stoptOlahraga" style="max-width: 100%;" disabled>  
      <button type="button" class="btn btn-primary btn-sm  disabled" id="btnSimpanStopOlahraga" data-bs-toggle="tooltip" title="simpan"><i class="fa fa-pencil-square-o"></i></button>
    </div>
`;
  kardioExercises.appendChild(wrapper);
} 

/*********************************************
* Daftar Olahraga Resisten - DROPDOWN VERSION
*********************************************/   
const resistanceExercises = ["Squat", "Lunge", "Push Up", "Sit Up", "Plank", "Pilates", "Yoga"];
const listEl = document.getElementById("olahragaResisten-list");

if (listEl) {
  const wrapper = document.createElement("div");
  wrapper.className = "mb-3";
  wrapper.innerHTML = `  
    <div class="mb-3">
      <select class="form-select" id="resistanceDropdown" style="max-width: 100%;">
        <option value="">Pilihan...</option>
        ${resistanceExercises.map(exercise => 
          `<option value="${exercise}">${exercise}</option>`
        ).join('')}
      </select>
    </div>
    
    <div id="selectedResistanceContainer">
      <!-- Selected exercises will appear here -->
    </div>
  `;
  
  listEl.appendChild(wrapper);
  
  // Event listener untuk dropdown
  const dropdown = document.getElementById('resistanceDropdown');
  dropdown.addEventListener('change', function() {
    const selectedValue = this.value;
    if (selectedValue) {
      addResistanceExercise(selectedValue);
      this.value = ''; // Reset dropdown
    }
  });
}

/************************************
* Fungsi Tambah Olahraga Resistance
*************************************/
function addResistanceExercise(exerciseName) {
  const container = document.getElementById('selectedResistanceContainer');
  const exerciseId = exerciseName.toLowerCase().replace(/\s+/g, '-');
  
  // Cek apakah exercise sudah dipilih
  if (document.getElementById(`resistance-${exerciseId}`)) {
    showFormMessage('Olahraga ini sudah terpilih', 'warning', 'resistance-message');
    return;
  }
  
  const exerciseElement = document.createElement("div");
  exerciseElement.id = `resistance-${exerciseId}`;
  exerciseElement.className = "resistance-exercise-item card mb-3";
  exerciseElement.innerHTML = `  
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h6 class="card-title mb-0 text-primary">${exerciseName}</h6>
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-primary btn-sm" 
                  onclick="simpanResistanceData('${exerciseId}')"
                  data-bs-toggle="tooltip" title="Simpan">
            <i class="fa fa-pencil-square-o"></i>
          </button>
          <button type="button" class="btn btn-danger btn-sm" 
                  onclick="removeResistanceExercise('${exerciseId}')"
                  data-bs-toggle="tooltip" title="Hapus"> 
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
      
      <div class="row g-2">
        <div class="col-12 col-md-4">
          <div class="input-group input-group-sm">	
            <span class="input-group-text"><i class="fas fa-user-cog"></i></span>
            <input type="number" min="0" id="jmlSet-${exerciseId}" class="form-control" 
                   placeholder="Jumlah set" data-exercise="${exerciseId}" data-type="set">
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="input-group input-group-sm">
            <span class="input-group-text"><i class="fas fa-user-plus"></i></span>
            <input type="number" min="0" id="jmlRepetisi-${exerciseId}" class="form-control" 
                   placeholder="Jumlah Repetisi" data-exercise="${exerciseId}" data-type="repetisi">
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="input-group input-group-sm">
            <span class="input-group-text"><i class="fas fa-user-clock"></i></span>
            <input type="number" min="0" id="jmlDurasi-${exerciseId}" class="form-control" 
                   placeholder="Durasi (Menit)" data-exercise="${exerciseId}" data-type="durasi">
          </div>
        </div>
      </div>
    </div>
  `;
  
  container.appendChild(exerciseElement);
  
  // Auto-save ketika input berubah
  const inputs = exerciseElement.querySelectorAll('input[type="number"]');
  inputs.forEach(input => {
    input.addEventListener('change', function() {
      const exerciseId = this.getAttribute('data-exercise');
      simpanResistanceData(exerciseId);
    });
  });
}

/*********************************
* Fungsi Hapus Olahraga Resistance
**********************************/
function removeResistanceExercise(exerciseId) {
  const exerciseElement = document.getElementById(`resistance-${exerciseId}`);
  if (exerciseElement) {
    exerciseElement.remove();
    showFormMessage('Batalkan pilihan...', 'danger', 'resistance-message');
    localStorage.removeItem(`resistance-${exerciseId}`);
  }
}

/******************************
* Fungsi Simpan Data Resistance
*******************************/
function simpanResistanceData(exerciseId) {
  const setValue = document.getElementById(`jmlSet-${exerciseId}`)?.value;
  const repetisiValue = document.getElementById(`jmlRepetisi-${exerciseId}`)?.value;
  const durasiValue = document.getElementById(`jmlDurasi-${exerciseId}`)?.value;
  
  // Validasi: minimal satu field harus diisi
  if (!setValue && !repetisiValue && !durasiValue) {
    showFormMessage('Isi minimal satu field data', 'warning', 'resistance-message');
    return;
  }
  
  const exerciseData = {
    name: document.querySelector(`#resistance-${exerciseId} .card-title`).textContent,
    set: setValue,
    repetisi: repetisiValue,
    durasi: durasiValue,
    timestamp: new Date().toISOString()
  };
  
  localStorage.setItem(`resistance-${exerciseId}`, JSON.stringify(exerciseData));
  showFormMessage('Data resistance berhasil disimpan', 'primary', 'resistance-message');
}

/***********************************************
* Fungsi Reset Data Resistance (untuk hari baru)
************************************************/
function resetResistanceData() {
  const container = document.getElementById('selectedResistanceContainer');
  if (container) {
    container.innerHTML = '';
  }
  
  // Hapus pesan
  clearFormMessage('resistance-message');
  
  // Hapus semua data resistance dari localStorage
  const resistanceExercises = ["squat", "lunge", "push-up", "sit-up", "plank", "pilates", "yoga"];
  resistanceExercises.forEach(exercise => {
    localStorage.removeItem(`resistance-${exercise}`);
  });
  
  showFormMessage('Data resistance berhasil direset', 'info', 'resistance-message');
}

/******************************************
* Fungsi Load Data Resistance yang Tersimpan
*******************************************/
function loadSavedResistanceData() {
  const resistanceExercises = ["squat", "lunge", "push-up", "sit-up", "plank", "pilates", "yoga"];
  
  resistanceExercises.forEach(exercise => {
    const savedData = localStorage.getItem(`resistance-${exercise}`);
    if (savedData) {
      addResistanceExercise(exercise.replace(/-/g, ' '));
      
      // Set values setelah element dibuat
      setTimeout(() => {
        const data = JSON.parse(savedData);
        const setInput = document.getElementById(`jmlSet-${exercise}`);
        const repetisiInput = document.getElementById(`jmlRepetisi-${exercise}`);
        const durasiInput = document.getElementById(`jmlDurasi-${exercise}`);
        
        if (setInput && data.set) setInput.value = data.set;
        if (repetisiInput && data.repetisi) repetisiInput.value = data.repetisi;
        if (durasiInput && data.durasi) durasiInput.value = data.durasi;
      }, 100);
    }
  });
}

/**************************
* Minum Air Putih per hari
***************************/   
const minumAirPutih = document.getElementById("airputihRadioBtn");
if (minumAirPutih) {
  const wrapper = document.createElement("div");
  wrapper.className = "mb-1"; /* "input-group mb-1 align-items-start"; */
  wrapper.innerHTML = `
    <div class="input-group mb-3">
      <div class="input-group-text">
        <input type="radio">
      </div>
      <input type="text" class="form-control" id="kurang1LtrAir" placeholder="Kurang dari 1 ltr air putih" readonly>
    </div>  
    
    <div class="input-group mb-3">
      <div class="input-group-text">
        <input type="radio">
      </div>
      <input type="text" class="form-control" id="pas1LtrAir" placeholder="1 ltr air putih" readonly>
    </div>  
    
    <div class="input-group mb-3">
      <div class="input-group-text">
        <input type="radio">
      </div>
      <input type="text" class="form-control" id="pas2LtrAir" placeholder="2 ltr air putih" readonly>
    </div>  
    
    <div class="input-group mb-3">
      <div class="input-group-text">
        <input type="radio"> 
      </div>
      <input type="text" class="form-control" id="lebih2LtrAir" placeholder="Lebih dari 2 ltr air putih" readonly>
    </div>

    <div>
      <button type="button" class="btn btn-primary btn-sm" id="btnSimpanMinumAir" data-bs-toggle="tooltip" title="Simpan Minum"><i class="fa fa-pencil-square-o"></i> Simpan</button>
      <button type="button" class="btn btn-secondary btn-sm" id="btnSelesaiMinumAir" data-bs-toggle="tooltip" title="Selesai Minum"><i class="fa fa-check"></i> Selesai</button>
    </div>  
`;
  minumAirPutih.appendChild(wrapper);
}    

/***********************
* Jadwal Waktu Istrihat
************************/   
const radioIstirahat = document.getElementById("istirahatBtn");
if (radioIstirahat) {
  const wrapper = document.createElement("div");
  wrapper.className = "mb-1"; /* "input-group mb-1 align-items-start"; */
  wrapper.innerHTML = `  
    <h6><b>WAKTU ISTIRAHAT</b></h6>
    <b>Mulai Istirahat Jam</b>
    <div class="input-group mb-3">
      <button type="button" class="btn btn-outline-primary btn-sm" id="btnStartIstirahat" data-bs-toggle="tooltip" title="Mulai Istirahat">
        <i class="far fa-clock mt-2 mb-2"></i>  
      </button>
      <input class="form-control" type="time" id="mulaiIstirahat" style="max-width: 100%;" disabled>  
    </div>

    <b>Berapa Jam Istirahat</b></h6>
    <div class="input-group mb-3">
      <div class="input-group-text">
        <input type="radio">
      </div>
      <input type="text" class="form-control" id="tidurKurang6Jam" placeholder="Kurang dari 6jam per malam" readonly>
    </div>  
    
    <div class="input-group mb-3">
      <div class="input-group-text">
        <input type="radio">
      </div>
      <input type="text" class="form-control" id="tidurAntara6_8Jam" placeholder="6jam-8jam per malam" readonly>
    </div>  
    
    <div class="input-group mb-3">
      <div class="input-group-text">
        <input type="radio">
      </div>
      <input type="text" class="form-control" id="tidurLebih8Jam" placeholder="Lebih 8jam per malam" readonly>
    </div>  
    <div class="container p-0">
      <button type="button" class="btn btn-primary btn-sm" id="btnSimpanIstirahat" data-bs-toggle="tooltip" title="Simpan Istirahat"><i class="fa fa-pencil-square-o"></i> Simpan</button>
      <button type="button" class="btn btn-secondary btn-sm" id="btnSelesaiIstirahat" data-bs-toggle="tooltip" title="Selesai Istirahat"><i class="fa fa-check"></i> Selesai</button>
    </div>
  `;
    radioIstirahat.appendChild(wrapper);
} 

/**************************
* Input Data Kondisi Tubuh
***************************/   
const inputKondisiTubuh = document.getElementById("kondisiTubuh");
if (inputKondisiTubuh) {
  const wrapper = document.createElement("div");
  wrapper.className = "mb-1"; /* "input-group mb-1 align-items-start"; */
  wrapper.innerHTML = `  
    <!-- Pilih Jenis Kelamin -->
    <div class="input-group mt-3 mb-3">  
      <div class="input-group-text">
        <i class="fas fa-venus-mars"></i> 
      </div>
      <select class="form-select" id="jenisKelamin1" required>
        <option value="">Pilihan Jenis Kelamin...</option>
        <option value="Pria">Pria</option>
        <option value="Wanita">Wanita</option>
      </select>
    </div> 

    <!-- Input Data Umur -->
    <div class="input-group mb-3">
      <div class="input-group-text">
        <i class="far fa-calendar-alt" style="padding-left: 3px; padding-right:4px;"></i>
      </div>
      <div class="input-group-text">
        <label>Input Tgl Lahir</label>
      </div>
      <input type="date" class="form-control" id="tglLahir">
    </div>  
                  
    <!-- Input Berat Badan -->
    <div class="input-group mb-3">
      <div class="input-group-text">
        <i class="fas fa-weight" style="padding-left: 2px; padding-right:3px;"></i>
      </div>
      <input type="number" class="form-control" id="beratBadan" placeholder="Input Berat badan (kg)">
    </div>  

    <!-- Input Tinggi Badan -->
    <div class="input-group mb-3">
      <div class="input-group-text">
        <i class="fas fa-ruler-vertical" style="padding-left: 5px; padding-right: 6px;"></i>
      </div>
      <input type="number" class="form-control" id="tinggiBadan" placeholder="Input Tinggi badan (cm)">
    </div>  
                  
    <!-- Input Lingkar Pinggang -->
    <div class="input-group mb-3">
      <div class="input-group-text">
        <i class="fas fa-ribbon" style="padding-left: 3px; padding-right: 4px;"></i>
      </div>
      <input type="number" class="form-control" id="lngkarPinggang" placeholder="Input Lingkar Pinggang (cm)">
    </div>

    <!-- Input Aktivitas Olahraga -->
    <div class="input-group mt-3 mb-3">
      <div class="input-group-text">
        <i class="fas fa-dumbbell"></i> 
      </div>
      <select class="form-select" id="aktivitasOlahraga" style="max-width: 100%;" required>
        <option value="">Pilihan Aktivitas Olahraga...</option>
        <option value="Sedikit/Tidak Olahraga">Sedikit/Tidak Olahraga</option>
        <option value="Olahraga ringan 1-3 hari/minggu">Olahraga ringan 1-3 hari/minggu</option>
        <option value="Olahraga moderat 3-5 hari/minggu">Olahraga moderat 3-5 hari/minggu</option>
        <option value="Olahraga berat 6-7 hari per minggu">Olahraga berat 6-7 hari/minggu</option>
        <option value="Olahraga sangat aktif + Kegiatan fisik">Olahraga aktif + Kegiatan fisik</option>           
      </select>
    </div>

    <div>
      <button type="button" class="btn btn-primary btn-sm" id="btnSimpanDataTubuh" data-bs-toggle="tooltip" title="Simpan Data Fisik"><i class="fa fa-pencil-square-o"></i> Simpan</button>
      <button type="button" class="btn btn-secondary btn-sm" id="btnSelesaiDataTubuh" data-bs-toggle="tooltip" title="Selesai Input Data"><i class="fa fa-check"></i> Selesai</button>
    </div>
  `;
  inputKondisiTubuh.appendChild(wrapper);
}                 

// ******************************
// *** FUNGSI PESAN FLEKSIBEL ***
// ******************************

/******************************************
* Tampilkan Pesan dalam Form (Simple Fixed)
*******************************************/
function showFormMessage(message, type = 'info', containerId = 'form-message') {
    // Cari atau buat container pesan
    let messageContainer = document.getElementById(containerId);
    
    if (!messageContainer) {
        messageContainer = document.createElement('div');
        messageContainer.id = containerId;
        messageContainer.className = 'mt-2';
        
        const selesaiButton = document.querySelector('#btnSelesaiWorkout');
        if (selesaiButton && selesaiButton.parentNode) {
            selesaiButton.parentNode.insertBefore(messageContainer, selesaiButton);
        } else {
            const resistanceContainer = document.getElementById('selectedResistanceContainer');
            if (resistanceContainer) {
                resistanceContainer.parentNode.appendChild(messageContainer);
            }
        }
    }
    
    // Buat alert Bootstrap
    const messageElement = document.createElement('div');
    messageElement.className = `alert alert-${type} alert-dismissible py-2 px-3 fade show`;
    messageElement.style.fontSize = '0.9rem';
    messageElement.style.lineHeight = '1.5';
    messageElement.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"
          style="transform: scale(0.7); align-items:end; margin-top:1px; padding-top:10px ; padding-bottom:10px">
        </button>
    `;

    // Hapus pesan sebelumnya dan tambahkan yang baru
    messageContainer.innerHTML = '';
    messageContainer.appendChild(messageElement);
    
    // Auto-hide setelah 5 detik
    if (type === 'success' || type === 'info') {
        setTimeout(() => {
            if (messageElement.parentNode) {
                const bsAlert = new bootstrap.Alert(messageElement);
                bsAlert.close();
            }
        }, 5000);
    }
}

/***********************
* Hapus Pesan dari Form
************************/
function clearFormMessage(containerId = 'form-message') {
    const messageContainer = document.getElementById(containerId);
    if (messageContainer) {
        messageContainer.innerHTML = '';
    }
}

/****************************************
* Pesan Toast Global (Bootstrap Standard)
****************************************/
function showToast(message, type = 'info') {
    // Buat toast container jika belum ada
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
        toastContainer.style.zIndex = '1100';
        document.body.appendChild(toastContainer);
    }
    
    // Buat toast element
    const toastId = 'toast-' + Date.now();
    const toastElement = document.createElement('div');
    toastElement.id = toastId;
    toastElement.className = `toast align-items-center text-bg-${type} border-0`;
    toastElement.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">
                ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    `;
    
    toastContainer.appendChild(toastElement);
    
    // Inisialisasi dan tampilkan toast
    const toast = new bootstrap.Toast(toastElement, {
        autohide: true,
        delay: 3000
    });
    toast.show();
    
    // Hapus element setelah toast disembunyikan
    toastElement.addEventListener('hidden.bs.toast', function () {
        toastElement.remove();
    });
}

/************************************
* Fungsi untuk simpan status materi
*************************************/
function simpanStatusMateri(hariKe, status) {
    const userToken = localStorage.getItem('userToken');
    const userId = localStorage.getItem('userId');
    
    console.log('ðŸ”§ DEBUG simpanStatusMateri:', { userId, hariKe, status, userToken });
    
    if (!userToken || !userId) {
        showToast('Silakan login terlebih dahulu', 'error');
        console.log('âŒ User not logged in');
        return;
    }

    const data = {
        action: 'updateMateri',
        userId: userId,
        hariKe: hariKe,
        statusMateri: status,
        timestamp: new Date().toISOString()
    };

    console.log('ðŸ“¤ Sending data to server:', data);
    console.log('ðŸ“¤ URL:', URL_APPS_SCRIPT_PROGRAM);

    fetch(URL_APPS_SCRIPT_PROGRAM, {
        method: 'POST',
        headers: { 
            'Content-Type': 'application/x-www-form-urlencoded',
            'Accept': 'application/json'
        },
        body: new URLSearchParams(data)
    })
    .then(response => {
        console.log('ðŸ“¥ Response status:', response.status);
        console.log('ðŸ“¥ Response ok:', response.ok);
        return response.text();
    })
    .then(result => {
        console.log('ðŸ“¥ Raw response:', result);
        
        try {
            const jsonResult = JSON.parse(result);
            console.log('ðŸ“¥ Parsed JSON:', jsonResult);
            
            if (jsonResult.success) {
                showToast('Status materi berhasil disimpan', 'success');
                updateMateriStatusUI(hariKe, status);
            } else {
                showToast('Gagal menyimpan status materi: ' + (jsonResult.message || 'Unknown error'), 'error');
            }
        } catch (e) {
            // Jika response bukan JSON
            if (result === 'OK') {
                showToast('Status materi berhasil disimpan', 'success');
                updateMateriStatusUI(hariKe, status);
            } else {
                console.log('âŒ Unexpected response:', result);
                showToast('Response tidak dikenali: ' + result, 'error');
            }
        }
    })
    .catch(error => {
        console.error('âŒ Fetch error:', error);
        showToast('Terjadi kesalahan jaringan: ' + error.message, 'error');
    });
}

/************************************
* Fungsi untuk update UI status materi
*************************************/

/********************************************************
* Tambahkan event listener untuk tombol centang di video
*********************************************************/

/********************************************************
* Helper function untuk menentukan hari ke dari section
/********************************************************/


/**************************************
* Fungsi untuk handle upload meal plan
**************************************/


/***********************************
* Fungsi untuk trigger upload file
***********************************/
function triggerMealPlanUpload(mealType) {
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = 'image/*';
    fileInput.capture = 'environment'; // Untuk mobile camera
    
    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            uploadMealPlanImage(file, mealType);
        }
    });
    
    fileInput.click();
}

/*************************************************
* Fungsi untuk upload image ke Google Apps Script
/*************************************************/
// Fungsi untuk upload image yang sebenarnya
function uploadMealPlanImage(file, mealType) {
    const userToken = localStorage.getItem('userToken');
    if (!userToken) {
        showToast('Silakan login terlebih dahulu', 'error');
        return;
    }

    const userId = localStorage.getItem('userId');
    const hariKe = 1;
    
    // Generate nama file sesuai format: UserID_MP1MealType.jpg
    const fileName = `${userId}_MP${hariKe}${capitalizeFirst(mealType)}.jpg`;
    
    // Convert file to base64
    const reader = new FileReader();
    
    reader.onload = function(e) {
        const base64Data = e.target.result.split(',')[1]; // Remove data:image/jpeg;base64,
        
        const data = {
            action: 'uploadMealPlan',
            userId: userId,
            hariKe: hariKe,
            mealType: mealType,
            file: base64Data,
            fileName: fileName
        };

        showToast('Mengupload foto ' + mealType + '...', 'info');

        fetch(URL_APPS_SCRIPT_PROGRAM, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams(data)
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                showToast(result.message, 'success');
                // Update input field dengan nama file
                const inputField = document.getElementById(mealType);
                if (inputField) {
                    inputField.value = fileName + ' âœ“';
                }
                // Enable tombol simpan
                const simpanBtn = document.getElementById(`btnSimpan${capitalizeFirst(mealType)}`);
                if (simpanBtn) {
                    simpanBtn.classList.remove('disabled');
                }
                
                console.log('âœ… Upload berhasil. File URL:', result.fileLink);
            } else {
                showToast('Gagal: ' + result.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showToast('Terjadi kesalahan upload', 'error');
        });
    };
    
    reader.onerror = function(error) {
        console.error('Error reading file:', error);
        showToast('Gagal membaca file', 'error');
    };
    
    reader.readAsDataURL(file);
}

// Perbaiki setupMealPlanUpload untuk pilih file

/*************************************************
* Fungsi untuk simpan status meal item individual
**************************************************/
function simpanStatusMealItem(hariKe, mealType, status) {
    const userToken = localStorage.getItem('userToken');
    if (!userToken) {
        showToast('Silakan login terlebih dahulu', 'error');
        return;
    }

    const data = {
        action: 'updateMealItem',
        userId: localStorage.getItem('userId'),
        hariKe: hariKe,
        mealType: mealType,
        status: status,
        timestamp: new Date().toISOString()
    };

    fetch(URL_APPS_SCRIPT_PROGRAM, {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams(data)
    })
    .then(response => response.text())
    .then(result => {
        if (result === 'OK') {
            showToast(`Status ${mealType} berhasil disimpan`, 'success');
        } else {
            showToast(`Gagal menyimpan status ${mealType}`, 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('Terjadi kesalahan saat menyimpan', 'error');
    });
}

/***********************************************
* Fungsi untuk simpan status meal plan lengkap
************************************************/
function simpanStatusMealPlan(hariKe, status) {
    const userToken = localStorage.getItem('userToken');
    if (!userToken) {
        showToast('Silakan login terlebih dahulu', 'error');
        return;
    }

    const data = {
        action: 'updateMealPlan',
        userId: localStorage.getItem('userId'),
        hariKe: hariKe,
        status: status,
        timestamp: new Date().toISOString()
    };

    fetch(URL_APPS_SCRIPT_PROGRAM, {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams(data)
    })
    .then(response => response.text())
    .then(result => {
        if (result === 'OK') {
            showToast('Meal Plan hari ini selesai!', 'success');
        } else {
            showToast('Gagal menyimpan status meal plan', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('Terjadi kesalahan saat menyimpan', 'error');
    });
}

// Fungsi test koneksi
function testConnection() {
  const callbackName = 'cb_test_' + Date.now();
  const script = document.createElement('script');
  script.src = `${URL_PROGRAM_APP}?action=test&callback=${callbackName}`;

  window[callbackName] = function(response) {
    console.log('Test connection response:', response);
    if (response.status === "success") {
      showNotification('success', 'âœ… Koneksi berhasil! Server aktif.');
    } else {
      showNotification('error', 'âŒ Koneksi gagal: ' + response.message);
    }
    document.body.removeChild(script);
    delete window[callbackName];
  };

  script.onerror = function() {
    showNotification('error', 'âŒ Gagal terhubung ke server. Periksa URL.');
    document.body.removeChild(script);
    delete window[callbackName];
  };

  document.body.appendChild(script);
}

// Panggil test connection saat load
document.addEventListener('DOMContentLoaded', function() {
  // Test koneksi dulu
  setTimeout(() => {
    testConnection();
  }, 1000);
  
  // Setup lainnya
  setupMateriCompletion();
  setupMealPlanUpload();
});

</script>
</body>
</html>